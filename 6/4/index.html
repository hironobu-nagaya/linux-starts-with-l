<html lang="ja">
<head>
<title>Lから始まるLinux - 6章4話 メモリ</title>
<base href="../..">
<meta charset="utf-8">
<meta name="author" content="Hironobu Nagaya">
<meta name="robots" content="all">
<meta name="keywords" content="Lから始まるLinux,Linux starts with L,linux,memory,free,vmstat">
<meta name="description" content="兄妹の対話を通してLinuxへの理解を深めていくお話です">
<meta name="viewport" content="width=device-width, initial-scale=0.5" />
<meta name="format-detection" content="telephone=no, email=no, address=no" />
<link rel="prev" href="6/3/" />
<link rel="next" href="6/5/" />
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link rel="stylesheet" href="css/normalize.css" type="text/css">
<link rel="stylesheet" href="css/common.css" type="text/css">
<link rel="stylesheet" href="css/story.css" type="text/css">
</head>
<body>
<header>
<h1>Lから始まるLinux</h1>
<div class="relation">
<div>
<div>前</div>
<div>6章3話</div>
<div><a href="6/3/">CPU</a></div>
</div>
<div>
<div>今</div>
<div>6章4話 メモリ</div>
<div><a href=".">もくじ</a></div>
</div>
<div>
<div>次</div>
<div>6章5話</div>
<div><a href="6/5/">ストレージ</a></div>
</div>
</div>
</header>
<main>
<section>
<article class="header1"><span>メモリ</span></article>
<article class="talk">
<div><img src="img/midori.svg" alt="若木 みどり" /></div>
<div>
<span><span>前回は CPU リソースの</span></span>
<span><span>調べ方を教えてもらったよ！</span></span>
</div>
</article>
<article class="talk">
<div><img src="img/shigeru.svg" alt="若木 しげる" /></div>
<div>
<span><span>今回はメモリリソースの</span></span>
<span><span>見方を学んでいこう</span></span>
</div>
</article>
<article class="header2"><code>free</code><span> コマンド</span></article>
<article class="talk">
<div><img src="img/shigeru.svg" alt="若木 しげる" /></div>
<div>
<span><code>free</code><span> は</span></span>
<span><span>メモリの利用状況を</span></span>
<span><span>表示するよ</span></span>
</div>
</article>
<article class="code"><pre><code class="bash">free <wbr>[オプション]...
</code></pre></article><article class="table"><table><thead><tr><th><span>オプション</span></th><th><span>役割</span></th></tr></thead><tbody><tr><td><code>-h</code><span>, <wbr></span><code>--human</code></td><td><span>数値を人間に読みやすい形式で表示</span></td></tr></tbody></table></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span><wbr>「人間に読みやすい形式」<wbr>って？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span><wbr>「人間に読みやすい(human-readable)形式」<wbr>は</span></span><span><span>数値に接尾辞(</span><code>K</code><span>, <wbr></span><code>M</code><span>, <wbr></span><code>G</code><span> など)を付けて</span></span><span><span>短い値を表示をするよ</span></span><span><span>例えば </span><code>20000000000</code><span> を</span></span><span><code>20G</code><span> のように表示するんだ</span></span><span><span>大きな数値を扱うコマンドには</span></span><span><span>たいていこのオプションがあるよ</span></span></div></article><article class="talk"><div><img src="img/midori-surprised.svg" alt="若木 みどり(驚き)" /></div><div><span><span>おおっ！</span></span><span><span>これは親切！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>では </span><code>free</code><span> を</span></span><span><code>-h</code><span> オプションと一緒に</span></span><span><span>実行してみよう！</span></span></div></article><article class="code"><pre><code class="bash">free <wbr>-h
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>うん！</span></span></div></article><article class="code"><pre><code class="console">               <wbr>total        <wbr>used        <wbr>free      <wbr>shared  <wbr>buff/cache   <wbr>available
Mem:           <wbr>7.9Gi       <wbr>1.3Gi       <wbr>5.3Gi       <wbr>7.0Mi       <wbr>1.3Gi       <wbr>6.5Gi
Swap:          <wbr>199Mi          <wbr>0B       <wbr>199Mi
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><code>Mem:</code><span> と</span></span><span><code>Swap:</code><span> の</span></span><span><span>2行があるね？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>Mem:</code><span> は<wbr>「実メモリ」<wbr></span></span><span><code>Swap:</code><span> は<wbr>「スワップ領域」<wbr>を表すよ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span><wbr>「実メモリ」<wbr>はわかるとして</span></span><span><span><wbr>「スワップ領域」<wbr>ってなんなのかな？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>ストレージ上の領域で</span></span><span><span>メモリ上のデータを退避する場所なんだ</span></span><span><span>メモリに十分な空きが無い場合に使われるので</span></span><span><span>スワップ領域が使われるのは</span></span><span><span>メモリ不足のサインだよ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>へぇ…</span></span><span><span>この行だけでも</span></span><span><span>メモリの状況がわかるんだね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>次は個々の項目を</span></span><span><span>説明していくよ</span></span></div></article><article class="table"><table><thead><tr><th><span>項目</span></th><th><span>意味</span></th></tr></thead><tbody><tr><td><span>total</span></td><td><span>総メモリ容量</span></td></tr><tr><td><span>used</span></td><td><span>利用中のメモリ容量(= total - free - buff/cache)</span></td></tr><tr><td><span>free</span></td><td><span>プロセスなどで利用されいる容量</span></td></tr><tr><td><span>shared</span></td><td><span>主に tmpfs で使用されているメモリ容量</span></td></tr><tr><td><span>buff/cache</span></td><td><span>バッファやキャッシュに使われているメモリ容量</span></td></tr><tr><td><span>available</span></td><td><span>必要があればすぐに空けられるメモリ容量</span></td></tr></tbody></table></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>tmpfs って何かな？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>メモリ領域をファイルシステムとして</span></span><span><span>扱う仕組みのことなんだ</span></span><span><code>/run</code><span> で使われている場合が多いよ</span></span><span><span>能動的に使っていなければ</span></span><span><span>ほとんど影響ないので</span></span><span><span>あまり気にしなくてもいい項目だよ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>バッファやキャッシュとは？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>作業などで使ったデータだけど</span></span><span><span><wbr>「再利用の可能性がある」<wbr>などの理由で</span></span><span><span>メモリ上に残されているデータだよ</span></span><span><span>キャッシュを使い回すことで</span></span><span><span>同様の処理を省いて</span></span><span><span>高速化できる場合があるんだ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>used の値が total にかなり近いね</span></span><span><span>メモリに空きがあまり無いのかな？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>メモリに空きがあると</span></span><span><span>効率を上げるために</span></span><span><span>バッファやキャッシュとして</span></span><span><span>積極的に使われるんだ</span></span><span><span>メモリに余裕があっても</span></span><span><span>used と total が近いことはよくあるよ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>メモリの空きに余裕があるかどうかは</span></span><span><span>available が十分あるかどうかで</span></span><span><span>判断するといいよ</span></span></div></article><article class="header2"><code>vmstat</code><span> コマンド</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>vmstat</code><span> は</span></span><span><span>より詳細な</span></span><span><span>メモリ使用状況を</span></span><span><span>表示するよ</span></span></div></article><article class="code"><pre><code class="bash">vmstat <wbr>[オプション]... <wbr>[間隔[回数]]
</code></pre></article><article class="code"><pre><code class="console">procs <wbr>-----------memory---------- <wbr>---swap-- <wbr>-----io---- <wbr>-system-- <wbr>------cpu-----
 <wbr>r  <wbr>b   <wbr>swpd   <wbr>free   <wbr>buff  <wbr>cache   <wbr>si   <wbr>so    <wbr>bi    <wbr>bo   <wbr>in   <wbr>cs <wbr>us <wbr>sy <wbr>id <wbr>wa <wbr>st
 <wbr>5  <wbr>0      <wbr>0 <wbr>5545200 <wbr>131408 <wbr>1277248    <wbr>0    <wbr>0     <wbr>0     <wbr>5  <wbr>189   <wbr>58 <wbr>59  <wbr>0 <wbr>41  <wbr>0  <wbr>0
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>ただ通常はここまで詳細な情報が</span></span><span><span>必要になることはないよ</span></span><span><span>こういうコマンドがあると</span></span><span><span>いうことだけ覚えておこう</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>使う必要が出たら</span></span><span><code>man</code><span> で調べるね！</span></span></div></article><article class="code"><pre><code class="bash">man <wbr>vmstat
</code></pre></article><article class="header2"><code>watch</code><span> コマンド</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>watch</code><span> は</span></span><span><span>指定されたコマンドを定期実行して</span></span><span><span>出力をフルスクリーン表示するよ</span></span><span><code>free</code><span> や </span><code>vmstat</code><span> と一緒に</span></span><span><span>使われることが多いんだ</span></span></div></article><article class="code"><pre><code class="bash">watch <wbr>[オプション]... <wbr>コマンド
</code></pre></article><article class="table"><table><thead><tr><th><span>オプション</span></th><th><span>役割</span></th></tr></thead><tbody><tr><td><code>-n 秒数</code><span>, <wbr></span><code>--interval 秒数</code></td><td><span>指定された秒数ごとに更新(デフォルトは2秒)</span></td></tr></tbody></table></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>へぇ…</span></span><span><span>どんなものだろう？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>これは動かして見たほうが早いよ</span></span><span><code>free</code><span> と一緒に使ってみよう！</span></span></div></article><article class="code"><pre><code class="bash">watch <wbr>-n <wbr>1 <wbr>free <wbr>-h
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>うん！</span></span></div></article><article class="code"><pre><code class="console">Every <wbr>1.0s: <wbr>free <wbr>-h                             <wbr>carter: <wbr>Mon <wbr>Jan <wbr>13 <wbr>18:33:40 <wbr>2025

               <wbr>total        <wbr>used        <wbr>free      <wbr>shared  <wbr>buff/cache   <wbr>available
Mem:           <wbr>7.9Gi       <wbr>758Mi       <wbr>5.9Gi       <wbr>7.0Mi       <wbr>1.4Gi       <wbr>7.1Gi
Swap:          <wbr>199Mi          <wbr>0B       <wbr>199Mi
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>おお！</span></span><span><span>出力内容が定期的に更新されて</span></span><span><code>top</code><span> と似たような</span></span><span><span>感じになるんだね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>終了は Ctrl + C だよ！</span></span></div></article><article class="header2"><span>まとめ</span></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>今回はメモリリソースを</span></span><span><span>確認する方法を学んだよ！</span></span><span><code>free</code><span> や </span><code>vmstat</code><span> で状況を知れるよ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>メモリ不足は以下の状況から</span></span><span><span>読み取れるんだね！</span></span></div></article><article class="ordered-list"><ol><li><span>available の不足</span></li><li><span>スワップ領域の利用</span></li></ol></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>メモリが不足するとシステムの動作が大幅に遅くなるよ</span></span><span><span>また<wbr>「OOM Killer(out-of-memory killer)」<wbr>という</span></span><span><span>プロセスを止めてメモリを空ける仕組みが動き出すんだ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>メモリが不足したら</span></span><span><span>メモリを消費しているプロセスを</span></span><span><span>停止させるのが一般的な対応だよ</span></span></div></article></section></main><footer><div class="relation"><div><div>前</div><div>6章3話</div><div><a href="6/3/">CPU</a></div></div><div><div>今</div><div>6章4話 メモリ</div><div><a href=".">もくじ</a></div></div><div><div>次</div><div>6章5話</div><div><a href="6/5/">ストレージ</a></div></div></div></footer><script src="js/jquery.js"></script><script src="js/common.js"></script></body></html>
