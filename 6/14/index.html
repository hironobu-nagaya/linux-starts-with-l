<html lang="ja">
<head>
<title>Lから始まるLinux - 6章14話 Samba</title>
<base href="../..">
<meta charset="utf-8">
<meta name="author" content="Hironobu Nagaya">
<meta name="robots" content="all">
<meta name="keywords" content="Lから始まるLinux,Linux starts with L,linux,daemon,Samba">
<meta name="description" content="兄妹の対話を通してLinuxへの理解を深めていくお話です">
<meta name="viewport" content="width=device-width, initial-scale=0.5" />
<meta name="format-detection" content="telephone=no, email=no, address=no" />
<link rel="prev" href="6/13/" />
<link rel="next" href="6/15/" />
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link rel="stylesheet" href="css/normalize.css" type="text/css">
<link rel="stylesheet" href="css/common.css" type="text/css">
<link rel="stylesheet" href="css/story.css" type="text/css">
</head>
<body>
<header>
<h1>Lから始まるLinux</h1>
<div class="relation">
<div>
<div>前</div>
<div>6章13話</div>
<div><a href="6/13/">smartmontools</a></div>
</div>
<div>
<div>今</div>
<div>6章14話 Samba</div>
<div><a href=".">もくじ</a></div>
</div>
<div>
<div>次</div>
<div>6章15話</div>
<div><a href="6/15/">ClamAV</a></div>
</div>
</div>
</header>
<main>
<section>
<article class="header1"><span>Samba</span></article>
<article class="talk">
<div><img src="img/midori.svg" alt="若木 みどり" /></div>
<div>
<span><span>お兄ちゃん！</span></span>
<span><span>Windows の<wbr>「ワークグループ」<wbr>に</span></span>
<span><span>Linux を入れてあげられないかな？</span></span>
</div>
</article>
<article class="talk">
<div><img src="img/shigeru.svg" alt="若木 しげる" /></div>
<div>
<span><span>Windows 同士がお互いを認識して</span></span>
<span><span>ファイルをやりとりしたり</span></span>
<span><span>ネットワーク内のプリンタなどを</span></span>
<span><span>使えるようにする仕組みだね</span></span>
</div>
</article>
<article class="talk">
<div><img src="img/shigeru.svg" alt="若木 しげる" /></div>
<div>
<span><a href="https://www.samba.org/" target="_blank" rel="noopener noreferrer">Samba</a><span> は</span></span>
<span><span>Windows の作法で</span></span>
<span><span>対話してくれるツールなんだ</span></span>
<span><span>これを使えば Linux を</span></span>
<span><span>Windows ワークグループに</span></span>
<span><span>参加させられるよ</span></span>
</div>
</article>
<article class="talk">
<div><img src="img/midori.svg" alt="若木 みどり" /></div>
<div>
<span><span>へぇ！</span></span>
<span><span>試してみたい！</span></span>
</div>
</article>
<article class="header2"><span>インストール</span></article>
<article class="talk">
<div><img src="img/shigeru.svg" alt="若木 しげる" /></div>
<div>
<span><span>Samba のパッケージ名は </span><code>samba</code><span> だよ</span></span>
<span><span>パッケージ管理システムから</span></span>
<span><span>インストールしよう</span></span>
</div>
</article>
<article class="code"><pre><code class="bash">sudo <wbr>apt <wbr>install <wbr>-y <wbr>samba
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>うん！</span></span><span><span>準備完了だよ！</span></span></div></article><article class="header2"><span>設定</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>今回はゲストに共有する方法で設定するよ</span></span><span><span>Samba サーバにアクセスできれば</span></span><span><span>誰でも読み書きができるんだ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>自宅内なら良さそうな方法だね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>最初にゲスト用アカウントを確認しよう</span></span><span><code>samba</code><span> や </span><code>nobody</code><span> のようなユーザ名だよ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>以下でユーザ名一覧を表示できるよ</span></span></div></article><article class="code"><pre><code class="bash">awk <wbr>-F: <wbr>'{ <wbr>print <wbr>$1 <wbr>}' <wbr>/etc/passwd
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>うん！</span></span><span><code>samba</code><span> ユーザが</span></span><span><span>新しく追加されている！</span></span><span><span>このユーザが Samba の</span></span><span><span>ゲスト用アカウントになるんだね</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>同様にグループも確認してみよう</span></span><span><code>samba</code><span> や </span><code>nobody</code><span>, <wbr></span><code>nogroup</code></span><span><span>のようなグループ名なんだ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>以下でグループ名一覧を表示できるよ</span></span></div></article><article class="code"><pre><code class="bash">awk <wbr>-F: <wbr>'{ <wbr>print <wbr>$1 <wbr>}' <wbr>/etc/group
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>グループ名も</span></span><span><code>samba</code><span> だったよ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>ここまでで</span></span><span><span>必要なアカウントの準備は</span></span><span><span>大丈夫だね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>次はワークグループで</span></span><span><span>共有するディレクトリを作ろう</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>mkdir <wbr>-pv <wbr>/srv/samba/share
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>ここに共有ファイルが</span></span><span><span>置かれるのね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>そういうことだね</span></span><span><span>でも </span><code>sudo</code><span> で作ったので</span></span><span><code>root</code><span> ユーザの持ち物なんだ</span></span><span><code>chown</code><span> で</span><code> share</code><span> ディレクトリの</span></span><span><span>所有権を変更しよう</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>chown <wbr>-c <wbr>samba:samba <wbr>/srv/samba/share
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>所有権を変更したよ！</span></span><span><span>ということはパーミッションも</span></span><span><span>確認だよね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>そう！</span></span><span><span>所有権とパーミッションはセットだったね！</span></span><span><span>同じくパーミッションも変更しよう</span></span><span><span>全てを許可する </span><code>777</code><span> にするよ</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>chmod <wbr>-c <wbr>777 <wbr>/srv/samba/share
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>これでディレクトリの</span></span><span><span>準備は OK かな？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>うん</span></span><span><span>大丈夫だよ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>最後に設定ファイルを編集しよう</span></span><span><span>Samba の設定ファイルは多くの場合</span></span><span><code>/etc/samba/smb.conf</code><span> だよ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>まずは設定ファイルの</span></span><span><span>バックアップを取ろう</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>mv <wbr>-v <wbr>/etc/samba/smb.conf{,.dist}
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>これで期待どおりに</span></span><span><span>動かなくても</span></span><span><span>元に戻せて安心だね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>では設定ファイルを作成しよう！</span></span><span><span>今回は紹介なので</span></span><span><span>最低限の設定のみ行うよ</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>bash <wbr>-c <wbr>'cat <wbr>&gt; <wbr>/etc/samba/smb.conf <wbr>&lt;&lt; <wbr>\EOF
[global]                  <wbr><span class="silver"># <wbr>全体設定</span>
  <wbr>guest <wbr>account <wbr>= <wbr>samba   <wbr><span class="silver"># <wbr>ゲストアクセスで使用されるアカウント</span>
  <wbr>workgroup <wbr>= <wbr>WORKGROUP   <wbr><span class="silver"># <wbr>Windows <wbr>のデフォルトワークグループ名</span>
  <wbr>security <wbr>= <wbr>user         <wbr><span class="silver"># <wbr>認証方式</span>

[share]                   <wbr><span class="silver"># <wbr>share <wbr>設定</span>
  <wbr>path <wbr>= <wbr>/srv/samba/share <wbr><span class="silver"># <wbr>共有ディレクトリのパス</span>
  <wbr>writable <wbr>= <wbr>yes          <wbr><span class="silver"># <wbr>書き込みを許可</span>
  <wbr>guest <wbr>only <wbr>= <wbr>yes        <wbr><span class="silver"># <wbr>ゲストアクセスのみ許可</span>
  <wbr>guest <wbr>ok <wbr>= <wbr>yes          <wbr><span class="silver"># <wbr>ゲストアクセスを許可</span>
  <wbr>create <wbr>mask <wbr>= <wbr>0777      <wbr><span class="silver"># <wbr>ファイル作成時のデフォルト権限</span>
  <wbr>directory <wbr>mask <wbr>= <wbr>0777   <wbr><span class="silver"># <wbr>ディレクトリ作成時のデフォルト権限</span>
EOF'
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>意外と設定項目が</span></span><span><span>少ないんだね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>testparm</code><span> は</span></span><span><span>Samba 設定ファイルの</span></span><span><span>書式確認をするよ</span></span><span><span>これを実行してエラーが</span></span><span><span>出ないことを確認しよう！</span></span></div></article><article class="code"><pre><code class="bash">testparm
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>これも大丈夫だったよ</span></span><span><span>共有するのが楽しみ！</span></span></div></article><article class="header2"><span>起動</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>では </span><code>systemctl</code><span> で</span></span><span><span>Samba を起動して</span></span><span><span>自動起動も有効にしよう！</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>systemctl <wbr>enable <wbr>--now <wbr>samba
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>Samba は </span><code>smbd</code><span> と </span><code>nmbd</code><span> の</span></span><span><span>2つのデーモンで成り立っているんだ</span></span><span><span>ディストリビューションによっては</span></span><span><span>以下のように指定する</span></span><span><span>必要があるかもしれないよ</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>systemctl <wbr>enable <wbr>--now <wbr>smbd <wbr>nmbd
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>実行後は</span></span><span><span>ちゃんと起動したかどうか</span></span><span><span>確認しよう！</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>systemctl <wbr>status <wbr>samba
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>うん！</span></span><span><span>ちゃんと動いてくれている！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>多くの場合 Windows ネットワークにすぐに認識されるよ</span></span><span><span>Windows の<wbr>「ネットワーク」<wbr>から確認してみよう！</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>あっ！</span></span><span><span>Windows のネットワークに</span></span><span><span>新しいホスト </span><code>carter</code><span> が</span></span><span><span>表示されているよ！</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span><wbr>「share」<wbr>という</span></span><span><span>ディレクトリがあって…</span></span><span><span>ファイルも自由に置けるね！</span></span></div></article><article class="header2"><span>まとめ</span></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>今回は Linux を</span></span><span><span>Windows ワークグループに</span></span><span><span>参加させられる Samba を扱ったよ！</span></span><span><span>Windows とファイル共有などが</span></span><span><span>できるようになるんだ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>これも最も基本的な設定のみの紹介だよ</span></span><span><span>例えば認証しないとアクセスできないなどの</span></span><span><span>設定もできるんだ</span></span><span><span>詳しくは今回の内容を基に検索してみよう！</span></span></div></article></section></main><footer><div class="relation"><div><div>前</div><div>6章13話</div><div><a href="6/13/">smartmontools</a></div></div><div><div>今</div><div>6章14話 Samba</div><div><a href=".">もくじ</a></div></div><div><div>次</div><div>6章15話</div><div><a href="6/15/">ClamAV</a></div></div></div></footer><script src="js/jquery.js"></script><script src="js/common.js"></script></body></html>
