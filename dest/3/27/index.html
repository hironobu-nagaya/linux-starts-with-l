<!DOCTYPE html>
<html lang="ja"><head><title>Lから始まるLinux - 3章27話 ジョブ管理</title><base href="../.."><meta charset="utf-8"><meta name="author" content="Hironobu Nagaya"><meta name="robots" content="all"><meta name="keywords" content="Lから始まるLinux,Linux starts with L,linux,shell script,wait"><meta name="description" content="兄妹の対話を通してLinuxへの理解を深めていくお話です"><meta name="viewport" content="width=device-width, initial-scale=0.5" /><meta name="format-detection" content="telephone=no, email=no, address=no" /><link rel="prev" href="3/26/" /><link rel="next" href="3/28/" /><link rel="icon" href="favicon.svg" type="image/svg+xml"><link rel="stylesheet" href="css/normalize.css" type="text/css"><link rel="stylesheet" href="css/common.css" type="text/css"><link rel="stylesheet" href="css/story.css" type="text/css"></head><body><header><h1>Lから始まるLinux</h1><div class="relation"><div><div>前</div><div>3章26話</div><div><a href="3/26/">シグナル処理</a></div></div><div><div>今</div><div>3章27話 ジョブ管理</div><div><a href=".">もくじ</a></div></div><div><div>次</div><div>3章28話</div><div><a href="3/28/">execコマンド</a></div></div></div></header><main><section><article class="header1"><span>ジョブ管理</span></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>お兄ちゃん！</span></span><span><span>シェルスクリプトの中でも</span></span><span><span>バックグラウンド実行できるんだね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>そうだね</span></span><span><span>スクリプトの記述と</span></span><span><span>ジョブが並列に動けば</span></span><span><span>効率よく処理できる場合があるんだ</span></span><span><span>特に時間のかかる処理を</span></span><span><span>ジョブにすると有効だよ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>でもシェルスクリプトが終了しても</span></span><span><span>ジョブはまだ動いている場合があるんだ</span></span><span><span>スクリプト実行が終わっているのに</span></span><span><span>実際はまだ処理が続いているというのは</span></span><span><span>なんだか落ち着かないよ…</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>今回はシェルスクリプトでの</span></span><span><span>ジョブ管理を学ぼう！</span></span></div></article><article class="header2"><code>!</code><span> 変数</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>!</code><span> 変数には</span></span><span><span><wbr>「直前に動かしたジョブのPID」<wbr></span></span><span><span>が入っているよ！</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>シェル上でバックグラウンド実行すると</span></span><span><span><wbr>「ジョブ番号」<wbr><wbr>「PID」<wbr>が</span></span><span><span>表示されていたよね</span></span><span><code>!</code><span> 変数でも PID を知れるんだ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>こんなふうに使うよ</span></span></div></article><article class="code"><pre><code class="bash">sleep <wbr>60 <wbr>&amp;
PID=&quot;$!&quot;
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>ジョブの PID を </span><code>PID</code><span> 変数に</span></span><span><span>代入しているんだね！</span></span><span><span>PID さえ知れたら</span></span><span><code>kill</code><span> などで操作ができるよ！</span></span></div></article><article class="header2"><code>wait</code><span> コマンド</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>wait</code><span> は</span></span><span><span>指定された PID のプロセスが</span></span><span><span>全て終了するまで待機するよ</span></span></div></article><article class="code"><pre><code class="bash">wait <wbr>[オプション]... <wbr>PID...
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>つまり </span><code>wait</code><span> をスクリプト内で使えば</span></span><span><span>ジョブが完了するまで待機できるんだね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>そういうことだね</span></span><span><span>ではバックグランド実行と</span></span><span><code>wait</code><span> を使った例を見てみよう！</span></span></div></article><article class="code"><pre><code class="bash">#!/bin/bash

<span class="silver"># <wbr>時間のかかる処理の代わりをする関数</span>
function <wbr>heavy-task() <wbr>{
  <wbr>sleep <wbr>&quot;$((10 <wbr>+ <wbr>(RANDOM <wbr>% <wbr>10)))&quot;
}

for <wbr>COUNT <wbr>in <wbr>{1..10}
do
  <wbr>heavy-task <wbr>&amp;
  <wbr>PIDS=&quot;$PIDS${PIDS:+ <wbr>}$!&quot;
done

wait <wbr>$PIDS
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><code>PIDS</code><span> の値で</span></span><span><span>変数展開を使っているね</span></span><span><span>読み解くと </span><code>PIDS</code><span> の値は</span></span><span><span>ジョブの PID がスペース区切りで</span></span><span><span>並ぶことになるんだね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>そのとおり！</span></span><span><span>最後に </span><code>wait $PIDS</code><span> で</span></span><span><span>指定された PID を持つプロセス全てが</span></span><span><span>終わるまで待機してから</span></span><span><span>スクリプトを終了するんだ</span></span></div></article><article class="header2"><span>まとめ</span></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>今回はシェルスクリプトでの</span></span><span><span>バックグラウンド実行を学んだよ！</span></span><span><code>!</code><span> 変数と </span><code>wait</code><span> を使って</span></span><span><span>ジョブが終わるまで待機できるんだ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>最近は CPU のコアが</span></span><span><span>複数ある場合がほとんどだよ</span></span><span><span>バックグラウンド実行を使って</span></span><span><span>効率良く処理を進めよう！</span></span></div></article></section></main><footer><div class="relation"><div><div>前</div><div>3章26話</div><div><a href="3/26/">シグナル処理</a></div></div><div><div>今</div><div>3章27話 ジョブ管理</div><div><a href=".">もくじ</a></div></div><div><div>次</div><div>3章28話</div><div><a href="3/28/">execコマンド</a></div></div></div></footer><script src="js/jquery.js"></script><script src="js/common.js"></script></body></html>