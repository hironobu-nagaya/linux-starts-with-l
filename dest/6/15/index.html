<!DOCTYPE html>
<html lang="ja"><head><title>Lから始まるLinux - 6章15話 ClamAV</title><base href="../.."><meta charset="utf-8"><meta name="author" content="Hironobu Nagaya"><meta name="robots" content="all"><meta name="keywords" content="Lから始まるLinux,Linux starts with L,linux,daemon,ClamAV,clamd,freshclam,clamdscan,clamscan,Eicar"><meta name="description" content="兄妹の対話を通してLinuxへの理解を深めていくお話です"><meta name="viewport" content="width=device-width, initial-scale=0.5" /><meta name="format-detection" content="telephone=no, email=no, address=no" /><link rel="prev" href="6/14/" /><link rel="next" href="6/16/" /><link rel="icon" href="favicon.svg" type="image/svg+xml"><link rel="stylesheet" href="css/normalize.css" type="text/css"><link rel="stylesheet" href="css/common.css" type="text/css"><link rel="stylesheet" href="css/story.css" type="text/css"></head><body><header><h1>Lから始まるLinux</h1><div class="relation"><div><div>前</div><div>6章14話</div><div><a href="6/14/">Samba</a></div></div><div><div>今</div><div>6章15話 ClamAV</div><div><a href=".">もくじ</a></div></div><div><div>次</div><div>6章16話</div><div><a href="6/16/">Apache HTTP Server</a></div></div></div></header><main><section><article class="header1"><span>ClamAV</span></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>お兄ちゃん！</span></span><span><span>Linux にはアンチウイルスソフトは無いのかな？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>もちろんあるよ！</span></span><span><span>今回はオープンソースの</span></span><span><span>アンチウイルスソフト </span><a href="https://www.clamav.net" target="_blank" rel="noopener noreferrer">ClamAV</a><span> を紹介しよう</span></span></div></article><article class="header2"><span>インストール</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>ClamAV のパッケージ名は </span><code>clamav</code><span> だよ</span></span><span><span>パッケージ管理システムから</span></span><span><span>インストールしよう</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>apt <wbr>install <wbr>-y <wbr>clamav
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>うん！</span></span><span><span>もう </span><code>apt</code><span> でのインストールは</span></span><span><span>慣れっこだね！</span></span></div></article><article class="header2"><span>設定</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>ClamAV の設定ファイルは</span></span><span><code>/etc/clamd.d/scan.conf</code><span> だよ</span></span><span><span>まずはオリジナルのバックアップを作成しよう</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>cp <wbr>-v <wbr>/etc/clamd.d/scan.conf{,.dist}
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>うん！</span></span><span><span>オリジナルの設定を</span></span><span><span>バックアップしたよ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>次はエディタで</span></span><span><span>設定ファイルを開こう！</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>vim <wbr>/etc/clamd.d/scan.conf
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>いつでも編集できるよ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>設定ファイル中の </span><code>Example</code><span> を</span></span><span><span>コメントアウトすることで</span></span><span><span>ClamAV が使えるようになるんだ</span></span></div></article><article class="code"><pre><code class="scan.conf">Example
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>こうかな？</span></span></div></article><article class="code"><pre><code class="scan.conf"><span class="silver">#Example</span>
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>そう</span></span><span><span>それで大丈夫だよ！</span></span><span><span>保存して終了しよう！</span></span></div></article><article class="header2"><span>起動</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>freshclam</code><span> は</span></span><span><span>ウイルス定義ファイルを更新するよ</span></span></div></article><article class="code"><pre><code class="bash">freshclam <wbr>[オプション]...
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>オプションなしで実行しよう</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>freshclam
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>できたよ！</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>でも毎回手動で</span></span><span><span>更新するのは面倒だね</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>定義ファイル自動更新サービス</span></span><span><code>clamav-freshclam</code><span> が用意されているよ</span></span><span><span>サービスを起動し自動起動も有効にしよう</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>systemctl <wbr>enable <wbr>--now <wbr>clamav-freshclam
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>起動したら正常に動作しているか確認しよう！</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>systemctl <wbr>status <wbr>clamav-freshclam
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>無事動いたよ！</span></span><span><span>これで定義ファイルは</span></span><span><span>自動更新されるんだね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>次は ClamAV デーモン </span><code>clamd</code><span> を起動しよう！</span></span><span><span>ディストリビューションによっては</span></span><span><code>@設定ファイル名</code><span> を続けて</span></span><span><code>clamd@scan</code><span> とする必要があるんだ</span></span><span><span>以下のコマンドで </span><code>clamd</code><span> を起動し</span></span><span><span>自動起動を有効にしよう</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>systemctl <wbr>enable <wbr>--now <wbr>clamd@scan
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>これも起動したら</span></span><span><span>動作確認をしよう</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>systemctl <wbr>status <wbr>clamd@scan
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>こっちも OK だよ！</span></span><span><span>これでウイルススキャンの</span></span><span><span>準備ができたんだね！</span></span></div></article><article class="header2"><span>実行</span></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>いよいよ実行だね！</span></span><span><span>ウイルスってどこで</span></span><span><span>手に入れたらいいのかな？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>本物のウイルスを</span></span><span><span>手元に置くのは危ないよ！</span></span><span><span>別の方法で動作確認をしよう</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>ここでは Eicar を用意するよ</span></span><span><span>これは無害だけど</span></span><span><span>ウイルスとして検知されると</span></span><span><span>決められているファイルなんだ</span></span><span><span>ウイルス検出の動作テストなどで</span></span><span><span>使われるよ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>へぇ…</span></span><span><span>そんなファイルがあるんだ！</span></span><span><span>どうやって用意するの？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>ファイルの内容が</span></span><span><span>特定の文字列であるだけでいいんだ</span></span><span><span>以下のコマンドで</span></span><span><span>Eicar ファイル </span><code>/tmp/eicar</code><span> を</span></span><span><span>作成するよ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>ダミーといえども本当に</span></span><span><span>ウイルスとして検知されるものだよ</span></span><span><span>会社や学校などの場で試すと</span></span><span><span>誤解を招く可能性があるんだ</span></span><span><span>必ず個人の環境などで実行してね</span></span></div></article><article class="code"><pre><code class="bash">echo <wbr>-n <wbr>'P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*' <wbr>&gt; <wbr>/tmp/eicar
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>これでウイルスの代わりが</span></span><span><span>用意できたんだね</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>ClamAV のスキャンは</span></span><span><span>2種類のコマンドが用意されているんだ</span></span></div></article><article class="table"><table><thead><tr><th><span>コマンド</span></th><th><span>役割</span></th></tr></thead><tbody><tr><td><code>clamscan</code></td><td><code>clamd</code><span> を使わないスキャン</span></td></tr><tr><td><code>clamdscan</code></td><td><code>clamd</code><span> を使うスキャン、<wbr>高速で並列スキャン対応</span></td></tr></tbody></table></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>clamd</code><span> を起動しているので</span></span><span><code>clamdscan</code><span> を実行してみよう</span></span></div></article><article class="code"><pre><code class="bash">clamdscan <wbr>/tmp/eicar
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>うまく見つけてくれるかな？</span></span></div></article><article class="code"><pre><code class="console">/tmp/eicar: <wbr>Win.Test.EICAR_HDB-1 <wbr>FOUND

----------- <wbr>SCAN <wbr>SUMMARY <wbr>-----------
Infected <wbr>files: <wbr>1
Time: <wbr>0.004 <wbr>sec <wbr>(0 <wbr>m <wbr>0 <wbr>s)
Start <wbr>Date: <wbr>2024:12:25 <wbr>10:00:00
End <wbr>Date:   <wbr>2024:12:25 <wbr>10:00:00
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><code>FOUND</code><span> ということは検出できているね！</span></span><span><span>結果に</span></span><span><span><wbr>「感染ファイル: 1(Infected files: 1)」<wbr></span></span><span><span>と出ているよ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>上手く行ったようだね！</span></span><span><span>確認ができたら Eicar は削除しよう！</span></span></div></article><article class="code"><pre><code class="bash">rm <wbr>/tmp/eicar
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>後片付けも完了だよ！</span></span></div></article><article class="header2"><span>まとめ</span></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>今回は Linux で使えるオープンソースの</span></span><span><span>アンチウイルスソフト ClamAV を学んだよ！</span></span><span><span>これでウイルスも怖くないね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>インストールしただけで安心せず</span></span><span><span>今後の運用も考えよう！</span></span><span><span>スキャンを定期的に実行する</span></span><span><span>検出されたファイルの扱いを</span></span><span><span>決めておくなどを考えておき</span></span><span><span>悪意のあるプログラムを</span></span><span><span>検出できる体制を作っておこう！</span></span></div></article></section></main><footer><div class="relation"><div><div>前</div><div>6章14話</div><div><a href="6/14/">Samba</a></div></div><div><div>今</div><div>6章15話 ClamAV</div><div><a href=".">もくじ</a></div></div><div><div>次</div><div>6章16話</div><div><a href="6/16/">Apache HTTP Server</a></div></div></div></footer><script src="js/jquery.js"></script><script src="js/common.js"></script></body></html>