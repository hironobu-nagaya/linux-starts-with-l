<!DOCTYPE html>
<html lang="ja"><head><title>Lから始まるLinux - 6章11話 systemd-timesyncd</title><base href="../.."><meta charset="utf-8"><meta name="author" content="Hironobu Nagaya"><meta name="robots" content="all"><meta name="keywords" content="Lから始まるLinux,Linux starts with L,linux,daemon,systemd-timesyncd,timedatectl"><meta name="description" content="兄妹の対話を通してLinuxへの理解を深めていくお話です"><meta name="viewport" content="width=device-width, initial-scale=0.5" /><meta name="format-detection" content="telephone=no, email=no, address=no" /><link rel="prev" href="6/10/" /><link rel="next" href="6/12/" /><link rel="icon" href="favicon.svg" type="image/svg+xml"><link rel="stylesheet" href="css/normalize.css" type="text/css"><link rel="stylesheet" href="css/common.css" type="text/css"><link rel="stylesheet" href="css/story.css" type="text/css"></head><body><header><h1>Lから始まるLinux</h1><div class="relation"><div><div>前</div><div>6章10話</div><div><a href="6/10/">/runディレクトリ</a></div></div><div><div>今</div><div>6章11話 systemd-timesyncd</div><div><a href=".">もくじ</a></div></div><div><div>次</div><div>6章12話</div><div><a href="6/12/">sysstat</a></div></div></div></header><main><section><article class="header1"><code>systemd-timesyncd</code></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>お兄ちゃん！</span></span><span><span>最初はどんなデーモンから</span></span><span><span>手をつけたらいいかな？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>それなら </span><code>systemd-timesyncd</code><span> がいいと思うよ</span></span><span><span>NTP(Network Time Protocol) を使って</span></span><span><span>システム時刻を正確に合わせてくれているんだ</span></span><span><span>名前のとおり </span><code>systemd</code><span> と統合されている</span></span><span><span>標準的なデーモンなんだよ</span></span><span><span>以降、<wbr>単に </span><code>timesyncd</code><span> と呼ぶね</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>へぇ…</span></span><span><span>そんなデーモンが動いていたんだね</span></span><span><span>早速時刻合わせをしてみようよ！</span></span></div></article><article class="header2"><span>確認</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>その前にまず </span><code>timesyncd</code><span> が</span></span><span><span>動いているか確認してみよう！</span></span></div></article><article class="code"><pre><code class="bash">systemctl <wbr>is-active <wbr>systemd-timesyncd
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>そっか…</span></span><span><span>まずは確認だね！</span></span></div></article><article class="code"><pre><code class="console">active
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><code>timesyncd</code><span> が動いていたよ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>もし </span><code>inactive</code><span> と表示されたら</span></span><span><code>timesyncd</code><span> は動いていないよ</span></span><span><span>代わりに別の時刻合わせデーモン</span></span><span><code>chronyd</code><span> や </span><code>ntpd</code><span> が</span></span><span><span>動いている可能性が高いんだ</span></span><span><span>ここでは </span><code>timesyncd</code><span> の</span></span><span><span>解説だけをするよ</span></span></div></article><article class="header2"><span>設定</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>timesyncd</code><span> の設定ファイルは</span></span><span><code>/etc/systemd/timesync.conf</code><span> だよ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>さっそく編集しようよ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>設定ファイルは編集する前に</span></span><span><span>バックアップを取ろうね</span></span><span><span>設定を間違えて動かなくなっても</span></span><span><span>簡単に元に戻せるんだ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>確かにバックアップは重要だね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>ここでは拡張子 </span><code>.dist</code><span> を付けよう</span></span><span><span><wbr>「ディストリビューションのデフォルト」<wbr></span></span><span><span>という意味の拡張子だよ</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>cp <wbr>-v <wbr>/etc/systemd/timesync.conf{,.dist}
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>バックアップを作ったよ！</span></span><span><span>これで仮に動かなくなっても</span></span><span><span>元の設定に戻せるね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>今度はエディタで</span></span><span><span>設定ファイルを開こう</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>vim <wbr>/etc/systemd/timesync.conf
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>うん！</span></span><span><span>いつでも編集できるよ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>今回は、<wbr>以下の2つを設定してみよう</span></span></div></article><article class="table"><table><thead><tr><th><span>項目</span></th><th><span>意味</span></th></tr></thead><tbody><tr><td><span>NTP</span></td><td><span>使用する NTP サーバ</span></td></tr><tr><td><span>FallbackNTP</span></td><td><span>指定された NTP サーバが使えない場合の代用 NTP サーバ</span></td></tr></tbody></table></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>ここでは以下のように</span></span><span><span>設定してみてね</span></span></div></article><article class="code"><pre><code class="timesync.conf">NTP=ntp.nict.jp
FallbackNTP=ntp1.jst.mfeed.ad.jp <wbr>ntp2.jst.mfeed.ad.jp <wbr>ntp3.jst.mfeed.ad.jp
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>設定した値はどういうものなの？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>両者とも日本国内の信頼できる</span></span><span><span>NTP サーバを指定しているよ</span></span></div></article><article class="table"><table><thead><tr><th><span>指定値</span></th><th><span>意味</span></th></tr></thead><tbody><tr><td><span>ntp.nict.jp</span></td><td><a href="https://nict.go.jp/" target="_blank" rel="noopener noreferrer">情報通信研究機構(NICT)</a><span> が提供する NTP サーバ</span></td></tr><tr><td><span>ntp1.jst.mfeed.ad.jp ntp2.jst.mfeed.ad.jp ntp3.jst.mfeed.ad.jp</span></td><td><a href="https://jst.go.jp/" target="_blank" rel="noopener noreferrer">科学技術振興機構(JST)</a><span> が提供する NTP サーバ</span></td></tr></tbody></table></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>なるほど！</span></span><span><span>これを保存すれば日本国内の</span></span><span><span>NTP サーバを使ってくれるんだ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>timesyncd</code><span> には</span></span><span><span>設定ファイルの書式チェックコマンド</span></span><span><code>systemd-timesyncd-parser</code><span> があるよ</span></span><span><span>以下を実行してみよう！</span></span></div></article><article class="code"><pre><code class="bash">systemd-timesyncd-parser <wbr>/etc/systemd/timesyncd.conf
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>何も表示されなかったよ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>問題があった場合は</span></span><span><span>その内容が出力されるよ</span></span><span><span>出力されたらその内容に従って</span></span><span><span>設定ファイルを書き直そう！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>ほとんどのデーモンは</span></span><span><span>起動中に設定を変更しても</span></span><span><span>再読み込みはしてくれないんだ</span></span><span><span>設定を反映させるためには</span></span><span><span>デーモンの再起動が必要だよ</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>systemctl <wbr>restart <wbr>systemd-timesyncd
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>再起動できたよ！</span></span><span><span>確認はどうすればいいのかな？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>デーモンの起動状態は</span></span><span><span>以下で確認しよう</span></span></div></article><article class="code"><pre><code class="bash">systemctl <wbr>status <wbr>systemd-timesyncd
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>システム時刻との同期は</span></span><span><code>timedatectl</code><span> で確認しよう</span></span><span><code>timedatectl</code><span> は</span></span><span><span>システム時刻管理ツールだよ</span></span></div></article><article class="code"><pre><code class="bash">timedatectl <wbr>[オプション]... <wbr>[timedatectlコマンド]
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>確認だけなら</span></span><span><span>オプションや引数は不要だよ</span></span><span><span>以下を実行しよう！</span></span></div></article><article class="code"><pre><code class="bash">timedatectl
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>うん！</span></span></div></article><article class="code"><pre><code class="console">               <wbr>Local <wbr>time: <wbr><span class="jst-time">Sun <wbr>2025-01-05 <wbr>10:50:40</span> <wbr>JST
           <wbr>Universal <wbr>time: <wbr><span class="utc-time">Sun <wbr>2025-01-05 <wbr>01:50:40</span> <wbr>UTC
                 <wbr>RTC <wbr>time: <wbr><span class="utc-time">Sun <wbr>2025-01-05 <wbr>01:50:40</span>
                <wbr>Time <wbr>zone: <wbr>Asia/Tokyo <wbr>(JST, <wbr>+0900)
System <wbr>clock <wbr>synchronized: <wbr>yes
              <wbr>NTP <wbr>service: <wbr>active
          <wbr>RTC <wbr>in <wbr>local <wbr>TZ: <wbr>no
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span><wbr>「System clock synchronized: yes」<wbr>と</span></span><span><span><wbr>「NTP service: active」<wbr>って表示があるね</span></span><span><span>時刻合わせがうまく行ったみたい！</span></span></div></article><article class="header2"><span>まとめ</span></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>今回は時刻合わせデーモン </span><code>timesyncd</code><span> を扱ったよ！</span></span><span><span>確認は </span><code>timedatectl</code><span> から行えるんだ!</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>時刻がずれているとログの時刻を追えなくなったり</span></span><span><span>証明書が正しく使えなくなることがあるんだ</span></span><span><span>正しい時刻を設定した状態で他のデーモンを動かそう！</span></span></div></article></section></main><footer><div class="relation"><div><div>前</div><div>6章10話</div><div><a href="6/10/">/runディレクトリ</a></div></div><div><div>今</div><div>6章11話 systemd-timesyncd</div><div><a href=".">もくじ</a></div></div><div><div>次</div><div>6章12話</div><div><a href="6/12/">sysstat</a></div></div></div></footer><script src="js/jquery.js"></script><script src="js/common.js"></script></body></html>