<html lang="ja">
<head>
<title>Lから始まるLinux - 4章4話 sudoとリダイレクト</title>
<base href="../..">
<meta charset="utf-8">
<meta name="author" content="Hironobu Nagaya">
<meta name="robots" content="all">
<meta name="keywords" content="Lから始まるLinux,Linux starts with L,linux,super user,root,sudo,tee,redirect">
<meta name="description" content="兄妹の対話を通してLinuxへの理解を深めていくお話です">
<meta name="viewport" content="width=device-width, initial-scale=0.5" />
<meta name="format-detection" content="telephone=no, email=no, address=no" />
<link rel="prev" href="4/3/" />
<link rel="next" href="4/5/" />
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link rel="stylesheet" href="css/normalize.css" type="text/css">
<link rel="stylesheet" href="css/common.css" type="text/css">
<link rel="stylesheet" href="css/story.css" type="text/css">
</head>
<body>
<header>
<h1>Lから始まるLinux</h1>
<div class="relation">
<div>
<div>前</div>
<div>4章3話</div>
<div><a href="4/3/">sudoコマンド</a></div>
</div>
<div>
<div>今</div>
<div>4章4話 sudoとリダイレクト</div>
<div><a href=".">もくじ</a></div>
</div>
<div>
<div>次</div>
<div>4章5話</div>
<div><a href="4/5/">電源管理</a></div>
</div>
</div>
</header>
<main>
<section>
<article class="header1"><code>sudo</code><span> とリダイレクト</span></article>
<article class="talk">
<div><img src="img/midori.svg" alt="若木 みどり" /></div>
<div>
<span><span>お兄ちゃん！</span></span>
<span><code>sudo</code><span> とリダイレクトを</span></span>
<span><span>組み合わせると</span></span>
<span><span>上手くいかないことがあるんだ</span></span>
<span><span>原因わかるかな？</span></span>
</div>
</article>
<article class="talk">
<div><img src="img/shigeru.svg" alt="若木 しげる" /></div>
<div>
<span><span>それは </span><code>sudo</code><span> を使い始めの頃に</span></span>
<span><span>多くの人がつまずくポイントだよ</span></span>
<span><span>今回は </span><code>sudo</code><span> と</span></span>
<span><span>リダイレクトの仕組みと</span></span>
<span><span>その解決方法を</span></span>
<span><span>詳しく見てみよう</span></span>
</div>
</article>
<article class="header1"><code>sudo</code><span> とリダイレクトの問題</span></article>
<article class="talk">
<div><img src="img/midori.svg" alt="若木 みどり" /></div>
<div>
<span><span>このコマンドを試したら</span></span>
<span><span>失敗しちゃったんだ…</span></span>
</div>
</article>
<article class="code"><pre><code class="bash">sudo <wbr>cat <wbr>&gt; <wbr>/etc/my-setting <wbr>&lt;&lt; <wbr>EOF
USERNAME=midori
PASSWORD=irodim
EOF
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>実行結果は</span></span><span><span>こうだったよ</span></span></div></article><article class="code"><pre><code class="console">-bash: <wbr>/etc/my-setting: <wbr>Permission <wbr>denied
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>このエラーの</span></span><span><span>理由を説明するね</span></span><span><code>sudo cat</code><span> は </span><code>cat</code><span> を</span></span><span><span>スーパユーザ権限で</span></span><span><span>実行しているんだ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>うん！</span></span><span><span>そうだよね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>でもその後に続く部分</span></span><span><code>&gt; /etc/my-setting</code><span> は</span></span><span><code>sudo</code><span> の管理外だって</span></span><span><span>気づいたかな？</span></span></div></article><article class="talk"><div><img src="img/midori-surprised.svg" alt="若木 みどり(驚き)" /></div><div><span><span>えっ…</span></span><span><span>そうなの？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>実はそうなんだ</span></span><span><span>リダイレクトは</span></span><span><span>シェルが処理しているんだ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>このシェルはみどりの権限で動いているから</span></span><span><span>みどりが書き込めない場所へのリダイレクトは</span></span><span><span><wbr>「permission denied」<wbr>に</span></span><span><span>なっちゃうというわけだね</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>へぇ…</span></span><span><span>勉強になるなぁ…</span></span><span><span>でもこういう場合は</span></span><span><span>どうすればいいのかな？</span></span></div></article><article class="header2"><code>tee</code><span> を使う</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>tee</code><span> を使えば</span></span><span><span>この問題を回避できるよ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span><wbr>「同一ファイルへの入出力」<wbr>のときに</span></span><span><span>扱ったコマンドだね</span></span><span><span>出力を<wbr>「ファイル」<wbr>と<wbr>「標準出力」<wbr>の</span></span><span><span>両方に送るコマンドだったね</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>この </span><code>tee</code><span> に </span><code>sudo</code><span> をつけると</span></span><span><span>書き込み権限が必要な場所に</span></span><span><span>ファイルを出力できるよ</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>tee <wbr>/etc/my-setting <wbr>&lt;&lt; <wbr>EOF
USERNAME=midori
PASSWORD=irodim
EOF
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>なるほど！</span></span><span><code>tee</code><span> がファイル出力を行うので</span></span><span><code>tee</code><span> に </span><code>sudo</code><span> を付けると</span></span><span><span>ファイル出力がスーパユーザ権限で行われて</span></span><span><span>書き込めるというわけなんだね！</span></span></div></article><article class="talk"><div><img src="img/shigeru-smile.svg" alt="若木 しげる(笑顔)" /></div><div><span><span>標準出力に内容が表示されるけど</span></span><span><span>どうしても気になるなら出力を</span></span><span><code>/dev/null</code><span> へリダイレクトしよう！</span></span></div></article><article class="header2"><code>bash</code><span> を使う</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>もう一つはシェル全体を</span></span><span><span>管理者権限で実行する方法だよ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>bash</code><span> の </span><code>-c</code><span> オプションは</span></span><span><span>指定された文字列を</span></span><span><span>コマンドとして実行するよ</span></span></div></article><article class="code"><pre><code class="bash">bash <wbr>-c <wbr>文字列
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>へぇ…</span></span><span><span>でも指定する文字列がコマンドなら</span></span><span><code>bach -c</code><span> は無くても</span></span><span><span>いいんじゃないかな？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>普通ならそうだね</span></span><span><span>でもリダイレクトを使うと</span></span><span><span>事情が変わってくるんだ</span></span></div></article><article class="code"><pre><code class="bash">bash <wbr>-c <wbr>'echo <wbr>hello <wbr>&gt; <wbr>/tmp/my-hello'
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>現行のシェルではなく</span></span><span><span>コマンドで指定したシェル </span><code>bash</code><span> が</span></span><span><span>リダイレクトをしてくれるんだね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>そういうことだよ！</span></span><span><span>その </span><code>bash</code><span> に </span><code>sudo</code><span> を付けると</span></span><span><span>管理者権限でリダイレクトも含めた</span></span><span><span>処理ができるんだ</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>bash <wbr>-c <wbr>'echo <wbr>hello <wbr>&gt; <wbr>/etc/my-hello'
</code></pre></article><article class="talk"><div><img src="img/midori-surprised.svg" alt="若木 みどり(驚き)" /></div><div><span><span>そっか！</span></span><span><span>出力リダイレクトの処理も</span></span><span><span>スーパユーザ権限で行われるので</span></span><span><span>書き込めるというわけなんだね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>みどりの場合は</span></span><span><span>このようにすれば動作するよ</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>bash <wbr>-c <wbr>'cat <wbr>&gt; <wbr>/etc/my-setting <wbr>&lt;&lt; <wbr>EOF
USERNAME=midori
PASSWORD=irodim
EOF'
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>ちゃんとリダイレクトを使っていて</span></span><span><span>理にかなっている書き方だね</span></span><span><span>でもこの方法は理解して慣れるまで</span></span><span><span>少し時間がかかるかも…</span></span></div></article><article class="header2"><span>まとめ</span></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>今回は </span><code>sudo</code><span> と</span></span><span><span>リダイレクトを組み合わせても</span></span><span><span>自分の権限の範囲しか</span></span><span><span>読み書きできないことを学んだよ</span></span><span><span>この問題を回避するには</span></span><span><code>tee</code><span> や </span><code>bash -c</code><span> が使えるよ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>一見理解できない挙動も</span></span><span><span>ちゃんと原理に則って動いているんだ</span></span><span><span>そういったものを紐解くことで</span></span><span><span>Linux の理解は進んでいくよ！</span></span></div></article></section></main><footer><div class="relation"><div><div>前</div><div>4章3話</div><div><a href="4/3/">sudoコマンド</a></div></div><div><div>今</div><div>4章4話 sudoとリダイレクト</div><div><a href=".">もくじ</a></div></div><div><div>次</div><div>4章5話</div><div><a href="4/5/">電源管理</a></div></div></div></footer><script src="js/jquery.js"></script><script src="js/common.js"></script></body></html>
