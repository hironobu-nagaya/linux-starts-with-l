chapter=2
story=44
title=差分
prev=2/43/
prev-title=evalコマンド
next=2/45/
next-title=パッチ
stylesheets=diff.css

# 差分

みどり（通常）：
  お兄ちゃん！
  少しだけ内容が違う
  二つのファイルがあるんだ
  どこが違っているか
  調べられないかな？
しげる（通常）：
  もちろんできるよ！
  今回はファイルの差分を
  確認する方法を覚えよう！

## `diff` コマンド

しげる（通常）：
  `diff` は
  ファイルの差分を表示するよ
  difference の略なんだ

```bash
diff [オプション]... ファイル...
```
オプション        | 役割
----------------- | ----
`-u`, `--unified` | unified diff 形式で出力する(後述)

しげる（通常）：
  `diff` の基本的な使い方は
  二つのファイルの比較だよ
  なので `ファイル` の箇所は
  通常は二つ指定すると覚えよう
みどり（通常）：
  「比較元」「比較先」の
  二つのファイルになるんだね！
しげる（通常）：
  ここでは差分を出力するために
  比較する二つのファイル
  `a.txt` と `b.txt` を作成しよう！

```bash
cat > a.txt << EOF
111
222
333
444
555
666
777
888
999
EOF
```

```bash
cat > b.txt << EOF
111
333
444
555
656
777
888
999
000
EOF
```

みどり（通常）：
  ヒアドキュメントで
  ファイルを作っているんだね
  `a.txt` と `b.txt` …
  微妙に内容が違うみたいだよ
しげる（通常）：
  その違いを `diff` に
  判定させてみよう！

```bash
diff a.txt b.txt
```

みどり（通常）：
  うん！
  実行するね！

```console
2d1
< 222
6c5
< 666
---
> 656
9a9
> 000
```

みどり（通常）：
  複数の行が出力されたよ！
  二つのファイルの違いを
  表しているようだけど…

## diff 形式

しげる（通常）：
  `diff` がデフォルトで
  出力する形式を
  `diff` 形式と呼ぶよ
みどり（笑顔）：
  そのまんまだね！
しげる（通常）：
  `2d1` や `6c5` などが
  差分のある位置を
  示しているよ
しげる（通常）：
  左の数字が1番目のファイルの行数
  右の数字が2番目のファイルの行数
  真ん中の英字がどのような差分かを
  示しているんだ

英字 | 意味
---- | ----
`a`  | 追加(**a**ppend)
`d`  | 削除(**d**elete)
`c`  | 変更(**c**hange)

しげる（通常）：
  その位置の表す行の下に続いて
  差分の内容が示されているんだ

記号 | 意味
---- | ----
`<`  | 1番目のファイルにあり2番目のファイルにない行
`>`  | 2番目のファイルにあり1番目のファイルにない行

みどり（通常）：
  さっきの `diff` の出力は
  差分の位置を表す行が三つあるね！
  ということはこれらを区切りにして
  以下の三つの差分を表しているんだ！

```console
2d1
< 222
```

```console
6c5
< 666
---
> 656
```

```console
9a9
> 000
```

しげる（通常）：
  そういうことだね
  一つずつ差分の出力内容を
  見ていこう！

----

```console
2d1
< 222
```

みどり（通常）：
  `d` は delete だったよね
  2番目のファイルと比較すると
  1番目のファイルから
  行がなくなっているんだ！

しげる（通常）：
  そうだね
  1番目のファイルの2行目から
  `222` という行が
  なくなっていることを
  表しているよ！
  2番目のファイルでは
  その位置は1行目ということだね

----

```console
6c5
< 666
---
> 656
```

みどり（通常）：
  `c` は change で
  「変更」だったよね！
しげる（通常）：
  `---` は見やすくするための区切りだよ
  1番目のファイル6行目の `666` が
  2番目のファイル5行目の `656` が
  それぞれ変わっていることを表しているよ

----

```console
9a9
> 000
```

みどり（通常）：
  `a` は append ね
  1番目のファイルには無いけど
  2番目のファイルに
  行が追加されているんだ！
しげる（通常）：
  そのとおり！
  1番目のファイルの9行目の位置に
  2番目のファイルの9行目の `000` が
  追加されていることを表しているよ
みどり（通常）：
  読み方さえ分かれば
  テキストだけでシンプルに
  差分を表現してくれていると
  わかるね！

# まとめ

みどり（通常）：
  今回は `diff` で
  二つのファイルの差分を
  確認できると学んだよ！
しげる（笑顔）：
  最初にみどりが困っていたように
  2つファイルの違いを調べる用途なら
  大抵どんなことにも使えるよ！
しげる（通常）：
  よく使われる場面は
  設定変更の確認だよ
  オリジナルの設定から
  どんな変更をしたかを
  調べるのに便利なんだ！

