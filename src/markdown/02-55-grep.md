chapter=2
story=55
title=grepコマンド
keyword=grep
prev=2/54/
prev-title=正規表現
next=2/56/
next-title=sedコマンド

# `grep` コマンド

みどり（通常）：
  お兄ちゃん！
  今回は正規表現を
  使ったコマンドを
  教えてくれるんだよね？
しげる（通常）：
  そうだよ！
  今回は `grep` を学ぼう！

## 使い方

しげる（通常）：
  `grep` はファイルの内容から
  指定された正規表現を検索して
  マッチした行を表示してくれるよ！

```bash
grep [オプション]... 正規表現 [ファイル]
```

オプション                    | 役割
----------------------------- | ----
`-E`, `--extended-regexp`     | 拡張正規表現を使って検索(`+` や `?` などが使える)
`-F`, `--fixed-strings`       | 正規表現を使わず指定された文字列で検索
`-o`, `--only-matching`       | 「マッチした行」の代わりに「正規表現にマッチした箇所」を表示
`-c`, `--count`               | 「マッチした行」の代わりに「正規表現にマッチした件数」を表示
`-l`, `--files-with-matches`  | 「マッチした行」の代わりに「正規表現にマッチする内容を持つファイル」を表示
`-L`, `--files-without-match` | 「マッチした行」の代わりに「正規表現にマッチしない内容を持つファイル」を表示
`-m 回数`, `--max-count=回数` | ファイル内で指定された回数マッチした時点で終了
`-q`, `--quiet`, `--silent`   | 結果を表示しない
`-s`, `--no-messages`         | エラーメッセージを表示しない

みどり（驚き）：
  ファイルの内容を
  自分の目で調べなくても
  良くなるね！
しげる（通常）：
  正規表現はシェルで
  特殊な意味を持つ記号を多く使うよ
  なので正規表現は
  「シングルクォート(`'`)」で
  囲うことが多いんだ
みどり（通常）：
  わかった！
  正規表現はなるべく
  シングルクォートで囲うね
しげる（通常）：
  `grep` は指定された正規表現が
  見つかったら「成功」を
  見つからなかったら「失敗」を返すよ
  このことを利用して
  条件判定にも使えるんだ
みどり（笑顔）：
  面白そうな
  コマンドだね！

## 実践

しげる（通常）：
  `/etc/passwd` ファイルを
  検索してみよう
  ユーザ情報が保管されている
  設定ファイルなんだ
しげる（通常）：
  「コロン(`:`)」区切りで
  情報が格納されていて
  最初がユーザ名になっているよ

```bash
cat /etc/passwd
```

みどり（通常）：
  実際に見るのが
  理解しやすいよね！

```console
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
...
shigeru:x:1000:1000:Shigeru Wakagi:/home/shigeru:/bin/bash
midori:x:1001:1001:Midori Wakagi:/home/midori:/bin/bash
```

みどり（通常）：
  確かに「コロン(`:`)」区切りで
  色々な情報があって
  最初がユーザ名のようだね！
しげる（通常）：
  この中から `midori` ユーザの
  情報だけを表示したい場合には
  どうすればいいだろう？
みどり（通常）：
  これではどうかな？

```bash
grep 'midori' /etc/passwd
```

しげる（通常）：
  確かに見つかるね
  だけど最初のユーザ名以外の場所に
  `midori` という文字列が入っていると
  その行も一緒に表示されてしまうよ
しげる（通常）：
  ユーザ名が先頭に
  書かれていることを
  利用しよう！
みどり（通常）：
  それならこれで
  どうかな？

```bash
grep '^midori' /etc/passwd
```

しげる（通常）：
  さっきよりもいいね！
  でも `midoriiro` ユーザのように
  `midori` から始まっている
  ユーザの行も引っかかって
  表示されてしまうんだ
  こうのような場合を避けるには
  どうしたらいいんだろう？
しげる（通常）：
  ヒントは
  「情報はコロン(`:`)で区切られている」
  だよ
みどり（驚き）：
  あっ！
  それならこうだよね！

```bash
grep '^midori:' /etc/passwd
```

しげる（笑顔）：
  よくできました！
しげる（通常）：
  `grep` はこのように
  正規表現を指定して
  調べたい文字列を
  探すことができるよ

## まとめ

みどり（通常）：
  今回は文字列検索コマンド
  `grep` を学んだよ！
しげる（通常）：
  `grep` で見つけた内容を
  パイプで別コマンド渡して加工するなど
  さらに高度な使い方もできるんだ
  まずは文字列を探すコマンドとして
  慣れていこう！

