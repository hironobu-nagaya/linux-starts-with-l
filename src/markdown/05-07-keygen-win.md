chapter=5
story=7
title=SSH鍵生成(Windows)
keyword=SSH
keyword=Windows
keyword=PuTTY
keyword=PuTTYgen
prev=5/6/
prev-title=公開鍵認証
next=5/8/
next-title=SSH鍵生成(macOS,Linux)

# SSH鍵生成(Windows)

みどり（通常）：
  お兄ちゃん！
  Windows から
  SSH 公開鍵認証で
  接続してみようよ！
しげる（通常）：
  そのためには
  「公開鍵」「秘密鍵」を
  作る必要があるね
  今回は Windows での
  鍵の作り方を説明するよ

## PuTTY

しげる（通常）：
  Windows の場合
  「ターミナル」や「Windows PowerShell」のかわりに
  「ターミナルエミュレータ」を使うと便利だよ
  リモート接続先の端末画面を
  再現してくれるソフトウェアなんだ
みどり（通常）：
  へぇ…
  便利そうね！
しげる（通常）：
  ここでは Windows の
  代表的なターミナルエミュレータ
  [PuTTY](https://putty.org) を使うよ
  [公式](https://www.chiark.greenend.org.uk/~sgtatham/putty/) からダウンロードして
  インストールしよう
みどり（通常）：
  うん！
  インストールするから
  ちょっとまっててね！

## PuTTYgen

しげる（通常）：
  PuTTY には
  様々な関連ツールが
  付属しているんだ
  その中の SSH 鍵生成ツール
  「PuTTYgen」を起動しよう！
みどり（通常）：
  うん！

[PuTTY Key Generator(起動直後)](img/puttygen-1.png)

## 鍵生成

しげる（通常）：
  Actions の中に
  Generate a public/private key pair とあって
  そこに「Generate」ボタンがあるよね？
  ここを押せば鍵が生成されるよ
みどり（通常）：
  それだけで
  作ってくれるんだ！
  簡単だね！

[PuTTY Key Generator(鍵生成中)](img/puttygen-2.png)

しげる（通常）：
  鍵はランダムな値から作られるんだ
  マウスのランダムな動きから取られるよ
  なのでマウスをランダムに動かそう！
みどり（笑顔）：
  マウスを動かすと
  プログレスバーが進むね！
  ちょっと楽しいかも！

[PuTTY Key Generator(鍵生成後)](img/puttygen-3.png)

みどり（通常）：
  鍵生成が
  終わったみたいだね！

## 鍵設定

しげる（通常）：
  あと少しで
  鍵を使えるようになるよ
  その前に少し設定があるんだ
しげる（通常）：
  最初は「コメント」だよ
  複数の鍵を作ると
  どの鍵が何の鍵か
  分からなくなっちゃうよ
  鍵の目的を区別するために
  鍵にはコメントを付けよう
  「Key」にある
  「Key comment:」入力欄で
  設定できるんだ
みどり（通常）：
  ここを自分の好きなように
  書けばいいんだね！
  どんな内容を
  書けばよいのかな？
しげる（通常）：
  「接続先」と「接続ユーザ名」の
  2つの情報は含めたほうがいいね
  内容は自由だけど
  僕は `接続ユーザ名@接続先`
  としているよ
みどり（通常）：
  じゃあ私もそうする！
  この場合は `midori@carter` だね！
しげる（通常）：
  次に「パスフレーズ」だよ
  設定すると鍵を使うたびに
  このパスフレーズが求められるんだ
  設定されたパスフレーズを
  入力しないと鍵が使えないんだ
みどり（通常）：
  パスフレーズを設定していれば
  鍵が漏洩してもすぐに
  危険が及ばなくなるんだね
しげる（通常）：
  安全思考で行くなら
  パスフレーズを設定しよう
  「Key」にある
  「Key passphrase:」と
  「Confirm passphrase:」に
  自分だけのパスフレーズを設定しよう！
みどり（通常）：
  毎回パスフレーズの入力を
  求められるのは面倒だなぁ
  家の中で使う想定だから
  パスフレーズは
  設定しないでおくよ

## 鍵保存

しげる（通常）：
  最後に鍵を保存しよう！
  「秘密鍵」と「公開鍵」が
  そろって使うことができるからね
  2つの鍵がちゃんと保存されるまでは
  PuTTYgen を閉じないでね
しげる（通常）：
  最初は「秘密鍵」からだよ
  「Actions」にある
  Save the generated key の
  「Save private key」ボタンを押そう！
みどり（通常）：
  保存ダイアログが出てきたね！
  PuTTY で生成した SSH 秘密鍵の
  拡張子は `.ppk` なんだ！
みどり（通常）：
  名前を決めて…
  うん、保存したよ！
しげる（通常）：
  次は「公開鍵」を
  保存するよ！
みどり（通常）：
  「Save public key」ボタンかな？
しげる（通常）：
  これでも保存できるけど
  PuTTY 独自形式で保存されるんだ
  後で変換処理をしないといけなくなるから
  別の方法で保存するよ
しげる（通常）：
  「Key」の
  Public key for pasting into OpenSSH authorized_key file:
  の下にテキストが表示されているよね
みどり（通常）：
  うん！
  スクロールバーが表示されていて
  結構長めのテキストだね
しげる（通常）：
  これが一般的に使われる
  OpenSSH 形式の公開鍵の内容なんだ
  このテキストをコピーして
  テキストファイルとして保存しよう！
みどり（通常）：
  コピーの選択範囲漏れがないように
  先頭から末尾まで慎重に…っと
しげる（通常）：
  ファイル名はペアとなっている
  「秘密鍵」と同じ名前にするといいよ
  拡張子は `.pub` が使われることが多いね
みどり（通常）：
  よし！
  「公開鍵」と「秘密鍵」の
  両方を保存したよ！
しげる（通常）：
  そうして PuTTYgen を安心して閉じられるよ
  もし片方しか保存せずに閉じてしまった場合
  鍵の作り直しになるから気をつけよう！

## まとめ

みどり（通常）：
  今回は PuTTY 付属の
  PuTTYgen を使って
  SSH 鍵を生成したよ！
  公開鍵認証でリモート接続するための
  第一歩なんだ！
しげる（通常）：
  PuTTY は日本語に対応していないけど
  有志がカスタマイズして日本語対応した
  [PuTTY-ranvis](https://www.ranvis.com/putty) があるよ
  また [TeraTerm](https://teratermproject.github.io/) を使うユーザも多いよ
  こちらは国産で日本語対応が
  しっかりしているのが強みなんだ
  他にも[Poderosa](https://sourceforge.net/projects/poderosa/)などもあるよ

