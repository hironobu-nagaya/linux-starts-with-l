chapter=3
story=24
title=setコマンド
keyword=shell script
keyword=set
prev=3/23/
prev-title=ドットコマンド
next=3/25/
next-title=一時ファイル作成

# `set` コマンド

みどり（通常）：
  お兄ちゃん！
  シェルスクリプト途中の
  コマンドが失敗したら
  後続のコマンドも同様に
  失敗しちゃったんだ
  まるで失敗のドミノ倒しだよ！
  こういうのって
  なんとかならないかな？
しげる（通常）：
  もちろん対処できるよ！
  今回はシェルオプションを学ぼう！

## `-e` オプション

しげる（通常）：
  `set` は
  シェルにオプション変更を伝えるよ

```bash
set -オプション
set +オプション
```

みどり（驚き）：
  へぇ…
  シェルにもオプションがあったんだ！
  しかも動作している途中で
  オプションを切り替えられるんだね！
しげる（通常）：
  `bash` の `-e` オプションは
  コマンドが失敗したら
  スクリプト実行をそこで停止するよ
しげる（通常）：
  ただし成否を評価に
  使っている部分の失敗は例外だよ
  AND 演算子 `&&` や OR 演算子 `||`
  `if`文や`while`文のような場合だね
みどり（通常）：
  まさに私が欲しかった機能だよ！
  どうやって指定するのかな？
しげる（通常）：
  `set` に `-e` オプションを
  指定してあげればいいよ
  シェルスクリプトでは
  冒頭に書くことが多いね

```bash
set -e
```

みどり（通常）：
  失敗する可能性のあるコマンドを
  一時的に許容してあげたい場合は
  どうすればいいのかな？
しげる（通常）：
  オプションの
  `-` を `+` にすると
  そのオプションを
  解除する意味になるんだ
  そのようなコマンドの直前で
  `set +e` とするといいよ
しげる（通常）：
  これらを組み合わせて
  このように書くよ

```bash
#!/bin/bash

!start-class-silver!# 通常は失敗したら停止!end!
set -e

...

!start-class-silver!# ここだけ失敗を許したい!end!
set +e
失敗の可能性があるコマンド
set -e

...
```

みどり（通常）：
  `-` で指定
  `+` で解除…
  ちょっと混乱しそう
しげる（通常）：
  通常のコマンドと同じように
  まずは `-` を「オプション指定」と覚え
  次に `+` は `-` の反対と覚えると
  混乱しないと思うよ

## `-v`, `-x` オプション

しげる（通常）：
  せっかく `set` の話をしたので
  他の便利なオプションも紹介しよう！
みどり（驚き）：
  えっ！
  興味ある！
しげる（通常）：
  内容が複雑になったとき
  処理を頭の中だけで
  追うのは大変だよね
  以下のオプションを指定すると
  シェルスクリプト実行時に
  その実行内容が表示されるんだ

オプション | 役割
---------- | ----
`-v`       | 実行内容を表示
`-x`       | 実行内容の途中経過を表示

しげる（通常）：
  詳しく見たい所の
  始まりに `set -vx`
  終わりに `set +vx` を
  指定してあげると
  内容を理解しやすくなるよ

```bash
#!/bin/bash

...

set -vx
詳しく見たい処理
set +vx

...
```

## まとめ

みどり（通常）：
  今回は `set` で
  シェルのオプションを
  変更できることを学んだよ
  `bash` のオプションのうち
  `-e`, `-v`, `-x` オプションを
  覚えたよ！
しげる（通常）：
  他にも様々な
  オプションがあるので
  興味があれば
  `man bash` を
  読んでみよう！

