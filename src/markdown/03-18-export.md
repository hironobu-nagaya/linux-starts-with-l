chapter=3
story=18
title=exportコマンド
keyword=shell script
keyword=export
prev=3/17/
prev-title=readonlyコマンド
next=3/19/
next-title=envコマンド

# `export` コマンド

みどり（通常）：
  お兄ちゃん！
  シェルで宣言した変数が
  シェルスクリプトで使えないんだ！
  `PATH` 変数とかは使えるのにどうして？
しげる（通常）：
  `PATH` のような変数を
  「環境変数(environment variable)」と呼ぶよ
  変数と環境変数は役割は同じだけど
  影響範囲が違っているんだ
みどり（通常）：
  環境変数を知れば
  `PATH` 変数のような
  使い方ができる
  ということなんだね？
しげる（通常）：
  そういうことだね
  今回は環境変数の
  使い方を学ぼう！

## 使い方

しげる（通常）：
  `export` は
  環境変数を
  宣言するよ

```bash
export [オプション]... [変数名[=値]]...
```

しげる（通常）：
  変数は宣言されたシェルでのみ有効だけど
  環境変数は宣言されたシェルと
  その子プロセスで有効だよ！
みどり（通常）：
  シェルで「変数」を宣言したから
  シェルの子プロセスである
  シェルスクリプトでは
  その変数が使えなかったんだね
みどり（通常）：
  一方、シェルで「環境変数」を宣言すれば
  そこで実行したコマンドやシェルスクリプトは
  その環境変数を読み取れるんだね！
しげる（通常）：
  そのとおり！

## 実践

みどり（通常）：
  自分で定義する環境変数が
  設定されている前提で
  動くスクリプトはなんか嫌だなぁ…
  いざ使おうとすると
  どう使ってよいか迷うね
しげる（通常）：
  みどりの感覚は正しいよ
  環境変数が無くても動くけど
  あるとそれに従うような
  内容がいいね
みどり（通常）：
  以前作った `greet` スクリプトで
  環境変数を使うようにしてみたよ
  こんなのはどうだろう？

```bash
#!/bin/bash

if [ -z "$NAME" ]
then
  echo -n "名前を入力して下さい: "
  read NAME
fi
echo "こんにちは、$NAMEさん！"
```

しげる（笑顔）：
  いい内容だね！
しげる（通常）：
  `NAME` 環境変数が
  設定されていなければ
  名前の入力を求めて
  `NAME` 変数に代入して
  名前を表示し
  `NAME` 環境変数が
  設定されていれば
  名前の入力を求めず
  その名前を表示するんだね
みどり（笑顔）：
  えへへ…
  そういうことです
しげる（通常）：
  では変数と環境変数の
  違いを見るために
  最初は普通の変数を
  宣言して実行してみよう！
みどり（通常）：
  うん！

```bash
NAME=みどり
```

みどり（通常）：
  この状態で
  `greet` スクリプトを実行するね！

```bash
./greet
```

```console
名前を入力して下さい: !cursor!
```

みどり（通常）：
  名前の入力が求められたね
  `NAME` 変数は
  `greet` スクリプトでは
  使われていないね

```console
名前を入力して下さい: みどり
こんにちは、みどりさん！
```

しげる（通常）：
  次は `NAME` 変数を
  環境変数にしよう！

```bash
export NAME
```

みどり（通常）：
  今度は環境変数が
  設定されている状態で
  実行してみるね

```bash
./greet
```

```console
こんにちは、みどりさん！
```

みどり（通常）：
  予想どおり！
  名前をたずねられずに
  挨拶されたよ！

## 確認

しげる（通常）：
  `export` を
  引数なしで実行すると
  現在定義されている
  環境変数一覧を
  表示してくれるよ

```bash
export
```

みどり（通常）：
  「環境変数」だけを
  表示してくれるんだね！
  確認したい場合は
  引数なしで実行するよ！

## まとめ

みどり（通常）：
  今回は環境変数を学んだよ！
  `export` で環境変数を
  定義したり確認できるよ！

呼び名   | 使える範囲
-------- | ----------
変数     | 宣言されたシェルのみ
環境変数 | 宣言されたシェルとその子プロセス

しげる（通常）：
  一部のコマンドは
  環境変数で動作が変わるよ
  この説明は manpage の
  末尾に書いてあるで
  `man` で確認しよう

