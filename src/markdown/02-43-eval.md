chapter=2
story=43
title=evalコマンド
keyword=eval
prev=2/42/
prev-title=算術式展開
next=2/44/
next-title=差分

# `eval` コマンド

みどり（通常）：
  お兄ちゃん！
  ブレース展開を
  試しているんだけど
  どうも上手く行かないんだ！
みどり（通常）：
  試したコマンドはこれだよ！

```bash
END=4
echo {1..$END}
```

みどり（通常）：
  ブレース展開されて
  以下のようになると
  思ったんだけど…

```console
1 2 3 4
```

みどり（通常）：
  でも実際は
  こうだったんだ…

```console
{1..4}
```

みどり（通常）：
  この原因…
  わかるかな？
しげる（通常）：
  これは初心者が
  手こずる問題の一つだね！
  今回はこの挙動の説明と
  解決方法を伝えるよ

## 多段展開の挙動

しげる（通常）：
  みどりの記述が
  期待どおりに動くには
  展開が2段階必要なんだ

1. `END` 変数が展開されて数値 `4` になる
2. `{1..4}` がブレース展開される

みどり（通常）：
  言われてみると
  確かにそうだよね
しげる（通常）：
  このように展開が
  何段階も重なっている場合
  シェルは最初の展開しか
  行ってくれないんだ
みどり（驚き）：
  つまり `END` 変数は
  展開されるけど
  ブレース展開は
  行われないということ？
しげる（通常）：
  そういうことなんだ
  実際に結果は
  `{1..4}` だったでしょ？

## 多段展開の解釈

みどり（通常）：
  でも、色々な記述を学んで
  それらを組み合わせられるようになると
  こういった場面は結構あると思うんだ
  どうにかならないかな？
しげる（通常）：
  `eval` は多段の展開を評価するよ
  「evaluate(評価する)」の略なんだ

```bash
eval コマンド
```

しげる（通常）：
  このように `eval` を実行すると
  展開が無くなるまで
  展開を繰り返してから
  指定のコマンドを実行してくれるんだ
みどり（通常）：
  へぇ！
  これで問題を解決できるかな？
しげる（通常）：
  みどりの例で
  `eval` を使ってみよう！

```bash
END=4
eval echo {1..$END}
```

みどり（通常）：
  `echo` の前に
  `eval` を追加しただけだね！
  ちゃんと動いてくれるかな？

```console
1 2 3 4
```

みどり（驚き）：
  おお！
  こうやって解決するんだ！

## まとめ

みどり（通常）：
  今回は記述の展開が多段になっていると
  シェルは最初の展開しかしてくれないことと
  多段の展開をしてくれる `eval` を覚えたよ！
しげる（通常）：
  定義どおりの記述をしているはずなのに
  期待どおりの動作をしてくれない場合は
  この挙動が原因の場合がほとんどなんだ
  もしそうなら `eval` で解決できるよ！

