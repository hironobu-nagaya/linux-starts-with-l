chapter=2
story=46
title=プロセス置換
prev=2/45/
prev-title=パッチ
next=2/47/
next-title=グルーピング

# プロセス置換

みどり（通常）：
  お兄ちゃん！
  `diff` で比較する内容を
  入力リダイレクトから
  受け取りたいんだけど
  入力リダイレクトは
  同時に1つしか使えないんだ
みどり（通常）：
  `diff` で
  「比較元」と
  「比較先」の両方を
  入力リダイレクトから
  受け取る方法って
  あるのかな？
しげる（通常）：
  ちゃんとあるから安心してね
  今回は「プロセス置換
  (process substitution)」
  を学ぼう！

## 書き方

しげる（通常）：
  プロセス置換は
  このように書くよ

```bash
コマンド1 <(コマンド2)
```

```bash
コマンド1 >(コマンド2)
```

しげる（通常）：
  `<` や `>` と `(...)` の間に
  スペースを入れてはいけないよ
  注意してね
しげる（通常）：
  これは `コマンド1` の
  `<(...)` や `>(...)` がある位置に
  `コマンド2` の実行結果を
  内容に持つファイルが
  引数で指定されたような
  状態になるよ
しげる（通常）：
  ファイルを
  入力で使うの場合は `<(...)`
  出力で使うの場合は `>(...)`
  となるんだ
みどり（驚き）：
  ちょっと
  言っている意味が
  理解できないぞ？
しげる（通常）：
  これは定義を理解するより
  実際に使って覚えた方が
  いいと思うよ

## 使い方

しげる（通常）：
  それではプロセス置換を
  使いながら覚えよう！
みどり（通常）：
  うん！
  お兄ちゃん
  よろしくね！
しげる（通常）：
  内容が異なる二つの
  ディレクトリを作って
  それらの `ls` の結果を
  `diff` で比べてみるよ
しげる（通常）：
  まずは二つのディレクトリ
  `diff1` と `diff2` を作るよ

```bash
mkdir ~/diff{1,2}
```

みどり（通常）：
  ブレース展開を
  使っているんだね
しげる（通常）：
  次は `diff1` ディレクトリの中に
  ファイルを作ってみよう

```bash
touch ~/diff1/{1,2,3,4}
```

みどり（通常）：
  ブレース展開が大活躍だね！
  コマンドを実行したよ！
しげる（通常）：
  今度は `diff2` ディレクトリの中に
  ファイルを作ってみよう

```bash
touch ~/diff2/{1,2,4,5}
```

みどり（通常）：
  ディレクトリの内容が
  ちょっとずつ違うように
  ファイルを作るんだね

しげる（通常）：
  ここで `ls` に
  `-1` オプションを指定して
  `diff1` の内容を見てみよう
  「`l`(エル)」ではなく
  「`1`(イチ)」なので
  気を付けてね

```bash
ls -1 ~/diff1
```

みどり（通常）：
  `-1` は
  どんなオプション
  なんだろうね？

```console
1
2
3
4
```

みどり（通常）：
  なるほど！
  出力を1行ずつ
  表示してくれる
  オプションなんだ！
しげる（通常）：
  そういうことだね
  同じように
  `diff2` ディレクトリも
  表示されてみよう！

```bash
ls -1 ~/diff2
```

```console
1
2
4
5
```

みどり（通常）：
  `ls` の出力が
  少しだけ違うのなら
  `diff` で
  それぞれの出力を
  比較できそうだね！
しげる（通常）：
  コマンドでは
  入力リダイレクトを
  1つしか使えないけど
  プロセス置換は
  複数使えるんだ
  これらの出力の差分を
  表示させてみよう！

```bash
diff <(ls -1 ~/diff1) <(ls -1 ~/diff2)
```

みどり（笑顔）：
  なるほど！
  お兄ちゃんの
  言っていた意味が
  今なら理解できるよ！
みどり（通常）：
  プロセス置換 `<(...)` の位置に
  コマンドの実行結果を
  内容に持つファイルが
  引数で指定されたような
  状態になってくれるんだね！

```console
3d2
< 3
4a4
> 5
```

みどり（笑顔）：
  うん！
  `3` ファイルは `diff1` にあって `diff2` になくて
  `5` ファイルは `diff2` にあって `diff1` にはないね
  ちゃんと期待どおりの差分を
  出力してくれているよ！

## まとめ

みどり（通常）：
  今回は「プロセス置換」を学んだよ
  コマンドの引数のある場所に
  別のコマンドの実行結果内容を
  当てはめたい場合に便利なんだ！
みどり（笑顔）：
  一つのコマンド内で
  複数回使えるというのも
  便利で嬉しいね！
しげる（通常）：
  たいていは入力や出力リダイレクトを
  そのまま書けば済む場合が多く
  使用頻度はあまり多くない記述だよ
しげる（通常）：
  今回の `diff` ように
  複数のリダイレクトを
  同時に扱いたい場合や
  コマンドが引数の指定のみ受け付け
  標準入力を受け付けない場合などで
  使われるんだ

