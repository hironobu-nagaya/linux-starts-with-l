chapter=3
story=11
title=while文(実践)
keyword=shell script
keyword=while
keyword=read
prev=3/10/
prev-title=while文(使い方)
next=3/12/
next-title=制御文とリダイレクト

# `while`文(実践)

みどり（通常）：
  前回は`while`文と
  繰り返しを制御する
  `continue` と `break` を
  教えてもらったね！
しげる（通常）：
  今回は`while`文を使った
  シェルスクリプトを
  書いてみよう！

## 実践

しげる（通常）：
  今回は空行を削除する
  `remove-empty-lines` スクリプトを
  作成しよう！
  まずはエディタを開いてね

```bash
vim remove-empty-lines
```

みどり（通常）：
  うん!
しげる（通常）：
  次に以下の内容を
  入力して保存しよう

```bash
#!/bin/bash

while read LINE
do
  grep -sq '^ *$' <<< "$LINE" && continue
  echo "$LINE"
done
```

みどり（通常）：
  内容が少なくて
  シンプルだね！
しげる（通常）：
  記述は少ないけど
  学ぶものは多いものに
  仕上がっているんだ！

----

みどり（通常）：
  `while`のコマンドの所で
  `read` を使っているね
  コマンドが成功する限り
  繰り返すんだけど
  `read` の成功って
  何なんだろう？
しげる（通常）：
  入力があれば成功
  なければ失敗になるよ
  これは後で実行して確認するね

----

しげる（通常）：
  `while`文の処理を見てみよう
  以下の1行は何をしているかな

```bash
grep -sq '^ *$' <<< "$LINE" && continue
```

みどり（通常）：
  AND 演算子 `&&` を使って
  前半のコマンドが成功したら
  `continue` をしているね
みどり（通常）：
  肝心の前半だけど…
  `LINE` 変数の内容を
  `grep` で検索しているね
  検索内容は正規表現 `^ *$` で
  これは「スペースが任意の数ある行」
  つまり「空行」となるよ
みどり（通常）：
  つまり `LINE` 変数の値が空行なら
  この繰り返しを終えて
  次の繰り返しに移る
  ということだね！

----

しげる（通常）：
  処理の2行目は単純だけど
  1行目と組み合わせると
  どんな動きになるのかな？

```bash
echo "$LINE"
```

みどり（通常）：
  1行目で「空行」なら
  `continue` しているので
  「内容のある行」だけ
  表示という意味になるね！
  最初のスクリプトの説明のとおり
  空行を削除したものが表示されるんだ！

## 実行

しげる（通常）：
  今回は`while`文と
  `read` を組み合わせた
  動きを知るために
  実行権限を与えて
  動かしてみよう！

```bash
chmod a+x remove-empty-lines
```

みどり（通常）：
  うん！
  準備 OK だよ！
しげる（通常）：
  では実行してみよう！

```bash
./remove-empty-lines
```

みどり（通常）：
  親切な入力メッセージは
  付けていないから
  何も表示されていないけど
  入力を受け付ける状態に
  なっているんだね
しげる（通常）：
  そのとおり！
  空ではない文字列を入れて
  Enter を押してみよう！

```bash
バウムクーヘン!cursor!
```

みどり（通常）：
  これで Enter を押すね

```bash
バウムクーヘン
バウムクーヘン
!cursor!
```

みどり（通常）：
  空行じゃなかったので
  `echo` で内容を表示して
  次の繰り返しの
  `read` が実行されたね！
みどり（通常）：
  この処理を終えるのには
  どうすればいいのかな？
  文字を入れず Enter かな？
しげる（通常）：
  それだと「空文字」を
  入力したことになるんだ
  何も文字を入れていない状態で
  Ctrl + D を押してみよう！
  これは「入力の終わり」を
  伝える操作だよ
みどり（通常）：
  `remove-empty-lines` スクリプトが終わって
  プロンプトが表示されたよ！
みどり（通常）：
  でも…
  このスクリプトは役に立つのかな？
  手入力した内容の空行を削除されても…
しげる（通常）：
  そのまま実行しても面白みがいよね
  このスクリプトは入力リダイレクトや
  パイプなどと組み合わせて使うんだ
  以下のようにしてみよう！

```bash
./remove-empty-lines << EOF

フィナンシェ


シュークリーム

マドレーヌ
EOF
```

みどり（驚き）：
  あっ！
  もしかして…

```console
フィナンシェ
シュークリーム
マドレーヌ
```

みどり（驚き）：
  おお！
  手入力以外の入力も
  `read` で処理できるんだ！
しげる（通常）：
  これは入力の1行ずつが
  `read` コマンドで処理され
  入力の終わりに達すると
  `read` が失敗を返して
  `while`文が終了するんだ
みどり（笑顔）：
  つまり…
  入力の各行を順に
  処理できるんだね！
  これはすごい！

## まとめ

みどり（通常）：
  今回は`while`文で
  シェルスクリプトを書いたよ！
  `while`文と `read` を組み合わせることで
  入力の各行を繰り返し処理できるんだ！
しげる（通常）：
  これは入力の各行を処理する
  定番の書き方なんだ
  使う機会もあるので
  覚えておこう！

```bash
while read LINE
do
  LINE変数を使った処理
done
```

