chapter=3
story=13
title=exitコマンド
prev=3/12/
prev-title=制御文とリダイレクト
next=3/14/
next-title=ヌルコマンド

# `exit` コマンド

みどり（通常）：
  お兄ちゃん！
  シェルスクリプトは
  書いてあることが
  全部処理されるまで
  終われないのかな？
しげる（通常）：
  そんなことはないよ
  今回はシェルを途中で止める
  `exit` を学ぼう！

## 基本

しげる（通常）：
  `exit` は
  現在のシェルを終了させるよ

```bash
exit [終了ステータス]
```

みどり（通常）：
  `終了ステータス` は
  省略できるんだね？
  省略したらどうなるのかな？
しげる（通常）：
  それは直前に実行していた
  コマンドの終了ステータスが
  シェルの終了ステータスになるんだ
みどり（通常）：
  シェルスクリプト内では
  スクリプトを解釈している
  シェルを終わらせるんだよね？
  普段操作しているシェルでも
  実行できるのかな？
しげる（通常）：
  うん、できるよ
  この場合は操作している
  シェルが終了するから
  `logout` とほぼ同じ動作になるよ

## 実践

みどり（通常）：
  スクリプトを途中で
  止めるような場面って
  どういうのがあるかな？
しげる（通常）：
  前提条件を満たしていなければ
  処理をせず停止する場合などがあるよ
  以下の例はどうだろう？

```bash
#!/bin/bash

if [ "$(whoami)" != "midori" ]
then
  echo "midori ユーザで実行して下さい！" >&2
  exit 1
fi

!start-class-silver!# midori ユーザだけの処理!end!
...
```

みどり（通常）：
  `whoami` はユーザ名を取得だよね！
  実行したユーザが
  `midori` じゃなかったら
  エラーメッセージを出して
  `exit` で停止してくれるんだ！
しげる（通常）：
  `test` の評価を変えれば
  「指定されたファイルが存在していれば」
  「書き込み権限がなければ」など
  色々な前提条件を判断できるよ！

## サブシェルでの `exit`

しげる（通常）：
  グルーピング `( ... )` 内で
  `exit` を実行すると
  サブシェルが終了するよ
  元のシェルは終了しないので
  挙動の違いに気をつけよう！

```bash
#!/bin/bash

(
  echo "この処理は実行される"
  exit !start-class-silver!# ここでサブシェルが終了する!end!
  echo "この処理は実行されない"
)

echo "この処理は実行される"
```

みどり（通常）：
  シェルの中でシェルを
  立ち上げているんだものね
  こういう場合の `exit` は
  気をつけるよ！

## まとめ

みどり（通常）：
  今回は `exit` を学んだよ！
  シェルを途中で
  終了させることができるんだ！
しげる（通常）：
  シェルスクリプトで
  これ以上処理を続けたくない場合
  `exit` で途中で終了しよう！

