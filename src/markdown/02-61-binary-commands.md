chapter=2
story=61
title=バイナリ関連コマンド
keyword=file
keyword=strip
keyword=strings
keyword=ldd
keyword=od
prev=2/60/
prev-title=パス関連コマンド
next=2/62/
next-title=日時関連コマンド

# バイナリ関連コマンド

みどり（通常）：
  お兄ちゃん！
  色々なコマンドを覚えて
  操作の幅を広げたいんだ！
しげる（通常）：
  今回はバイナリに関する
  コマンドを見ていこう！
しげる（通常）：
  「バイナリ(binary)」は
  コンピュータが直接
  処理するためのデータだよ
  人間が読むためのテキストでは
  書かれていないんだ
  だから専用のコマンドで
  扱う必要があるよ！

## `file` コマンド

しげる（通常）：
  `file` は
  ファイル形式を
  表示するよ

```bash
file [オプション]... ファイル...
```

みどり（通常）：
  もしかして
  テキストファイルにも
  使えるのかな？
しげる（通常）：
  うん、使えるよ！
  HTML などの種別も
  判別してくれるんだ
しげる（通常）：
  では `ls` の
  ファイル形式を
  見てみよう

```bash
file /bin/ls
```

みどり（通常）：
  ちょっと
  ワクワクするね！

```console
/bin/ls: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=3ccc0d8aa8dc371f9c762c6e76823aa5b9d4041b, for GNU/Linux 3.2.0, stripped
```

しげる（通常）：
  この「ELF
  (Executable and Linkable Format)」
  というのが
  Linux のバイナリ実行ファイル形式だよ
みどり（通常）：
  Windows の EXE
  みたいなものなのね！

## `strip` コマンド

しげる（通常）：
  次は `strip` だよ
  バイナリ実行ファイルから
  デバッグ情報などを削除して
  ファイルサイズを
  大幅に減らしてくれるんだ

```bash
strip [オプション]... ファイル...
```

みどり（通常）：
  デバッグ情報って
  普通の人は使わないと思うけど
  削除しても問題ないのかな？
しげる（通常）：
  基本的には
  大丈夫だよ
しげる（通常）：
  配布されているパッケージは
  ほとんどがストリップ済みなんだ
  さっきの `file` の出力の
  最後をみてごらん
みどり（通常）：
  「ストリップ済み(`stripped`)」
  ってあるね！
しげる（通常）：
  `strip` を使う機会は少ないけど
  「ストリップ」という概念は
  時々出てくるよ

## `strings` コマンド

しげる（通常）：
  `strings` は
  バイナリの中から
  テキストを探して
  抜き出すよ

```bash
strings [オプション]... ファイル...
```

しげる（通常）：
  `ls` に対して
  実行してみよう！

```bash
strings /bin/ls
```

みどり（通常）：
  `ls` の中に
  普通のテキストが
  混じっているの？

```console
/lib64/ld-linux-x86-64.so.2
v,nv
_ITM_deregisterTMCloneTable
__gmon_start__
...
.data
.bss
.gnu_debuglink
.gnu_debugdata
```

みどり（驚き）：
  おわっ！
  たくさんの行が
  出力されたよ！
みどり（通常）：
  でも…
  その中に「help」とか
  見覚えのある
  単語もあるね
しげる（通常）：
  バイナリ実行ファイルの中には
  エラーやヘルプのメッセージが
  含まれていることが多いんだ
しげる（通常）：
  出力が多いので
  `less` でページ送りしながら見たり
  `grep` で探したい文字列だけ
  抜き出すといいよ

```bash
strings /bin/ls | less
```

```bash
strings /bin/ls | grep 'help'
```

## `ldd` コマンド

しげる（通常）：
  `ldd` は
  実行ファイルが参照している
  ライブラリを表示してくれるんだ

```bash
ldd [オプション]... ファイル...
```

みどり（通常）：
  「ライブラリ」は
  コマンドの共通部品
  だったよね！
しげる（通常）：
  `ls` を対象に
  調べてみよう！

```bash
ldd /bin/ls
```

みどり（通常）：
  どんなライブラリを
  参照しているのかな？

```console
        linux-vdso.so.1 (0x00007fff41b49000)
        libselinux.so.1 => /lib64/libselinux.so.1 (0x00007fb3e6187000)
        libcap.so.2 => /lib64/libcap.so.2 (0x00007fb3e617d000)
        libc.so.6 => /lib64/libc.so.6 (0x00007fb3e5e00000)
        libpcre2-8.so.0 => /lib64/libpcre2-8.so.0 (0x00007fb3e60e1000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fb3e61e1000)
```

しげる（通常）：
  各行が必要としているライブラリだよ
  もしこれらのライブラリが見つからないと
  `ls` は動かないんだ
みどり（通常）：
  コマンドが動かないときの
  原因調査に使えそうだね！

## `od` コマンド

しげる（通常）：
  `od` は
  ファイルの中身を
  八進数や十六進数の
  数値で表示するよ

```bash
od [オプション]... [ファイル]...
```

オプション | 役割
---------- | ----
`-x`       | 十六進数2バイト表示
`-o`       | 八進数2バイト表示

みどり（通常）：
  バイナリは
  生のデータだから
  数字として見るんだね！
しげる（通常）：
  `ls` を `od` で
  覗いてみよう！
  表示が膨大なので
  `head` と一緒に使うね

```bash
od /bin/ls | head
```

みどり（通常）：
  どれどれ？

```console
0000000 042577 043114 000402 000001 000000 000000 000000 000000
0000020 000003 000076 000001 000000 065420 000000 000000 000000
...
```

みどり（通常）：
  数字だらけで
  よく分からないね！
しげる（通常）：
  `ls` の中身を
  八進数で表示しているんだ
しげる（通常）：
  数字を理解できる必要は無いよ
  「`od` でバイナリの中身が読める」
  とだけ覚えておこう！

## `dd` コマンド

しげる（通常）：
  `dd` は
  入力元から出力先へ
  データを書き出すよ

```bash
dd [操作]...
```

操作           | 説明
-------------- | ----
`bs=バイト数`  | 入出力ブロックサイズを `バイト数` にする(デフォルトは `512`)
`ibs=バイト数` | 入力ブロックサイズを `バイト数` にする(デフォルトは `512`)
`obs=バイト数` | 出力ブロックサイズを `バイト数` にする(デフォルトは `512`)
`count=個数`   | ブロックを `個数` だけ処理する
`skip=個数`    | 最初のブロックを `個数` だけスキップする
`if=ファイル`  | 入力を `ファイル` から読み込む(デフォルトは `標準入力`)
`of=ファイル`  | 出力を `ファイル` へ書き出す(デフォルトは `標準出力`)

しげる（通常）：
  主にバイナリデータの
  コピーなどで使われるんだ
みどり（通常）：
  ちょっと
  どう使っていいのか
  わからないコマンドだよ…
しげる（通常）：
  確かにわかりづらいよね
  いくつか例を紹介するので
  それらを見てみよう！

----

しげる（通常）：
  以下のコマンドは
  1024 バイトの
  ランダムな内容を持つ
  `data` ファイルを
  作成するよ

```bash
dd bs=1024 count=1 < /dev/random > data
```

みどり（通常）：
  1024 バイトを
  1ブロックとして
  1回だけ処理するんだね
  入力は `/dev/random` で
  ランダムな内容を読み込み
  それを `data` ファイルに
  書き出しているんだ
  ダミーファイル作成などで
  使えそうだね！

----

しげる（通常）：
  次のコマンドは
  ストレージ `/dev/sda` の内容全てを
  二進数の `0`(ゼロ) で上書きするよ

```bash
dd < /dev/zero > /dev/sda
```

しげる（通常）：
  `/dev/zero` は
  二進数の `0`(ゼロ) を
  出力し続けるファイルだよ
みどり（通常）：
  それを
  ストレージ `/dev/sda` に
  書き出しているんだね
  ストレージの内容を
  全消去しているのかな？
しげる（通常）：
  そのとおり！
  ストレージ上の全データを
  `0`(ゼロ) で上書きして
  まっさらに消去するときに
  使われるコマンドだよ

----

しげる（通常）：
  このコマンドは
  ストレージ `/dev/sda` の
  先頭 512 バイトのデータを
  `sda-mbr` ファイルに書き出すよ

```bash
dd bs=512 count=1 < /dev/sda > sda-mbr
```

しげる（通常）：
  ストレージ先頭
  512 バイトは
  ストレージ内の構成が
  書かれている場合が
  ほとんどだよ
  このデータの
  バックアップを
  作成しているんだ

----

みどり（通常）：
  `dd` は
  特殊なコピー用途で
  使うんだね！
しげる（通常）：
  他にも入出力の間で
  ちょっとした変換を
  挟むこともできるけど
  ここでは省略するね

## まとめ

みどり（通常）：
  今回はバイナリ関連コマンド
  `file`, `strip`, `strings`,
  `ldd`, `od`, `dd` を
  学んだよ！
しげる（通常）：
  バイナリを直接扱う機会は
  あまり多くないので
  最初はこのぐらいの
  コマンドを知っていれば
  十分だよ！

