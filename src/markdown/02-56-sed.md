chapter=2
story=56
title=sedコマンド
keyword=sed
prev=2/55/
prev-title=grepコマンド
next=2/57/
next-title=awkコマンド

# `sed` コマンド

みどり（通常）：
  お兄ちゃんから
  正規表現を使ったコマンドを
  教えてもらっているんだよ！
  前回は `grep` だったね
しげる（通常）：
  今回は `sed` を
  扱ってみよう！

## 使い方

しげる（通常）：
  `sed` は
  「ストリームエディタ(stream editor)」の略で
  入力を一括で編集するためのコマンドなんだ
  編集後の内容は標準出力へ出力されるよ
みどり（通常）：
  エディタなんだ！
しげる（通常）：
  そう！
  エディタなので色々な編集ができるんだ
  全部の機能を一度には覚えられないので
  今回はよく使われる
  「置換コマンド `s` (**s**ubstitute) 」
  を覚えよう！
  以下のように使用するよ

```bash
sed [オプション]... 's/置換前/置換後/フラグ' ファイル
```

オプション     | 役割
-------------- | ----
-i [extension] | 編集結果を標準出力ではなく編集対象ファイルに書き出す。extention を指定すると `ファイル名extension` というファイル名で編集前のバックアップを作成する

しげる（通常）：
  ファイルの各行で
  最初に見つかった `置換前` を
  `置換後` に置き換えた
  内容を出力するんだ
みどり（通常）：
  `置換前` の指定に
  正規表現が使えるんだね！
しげる（通常）：
  「フラグ」は `g` だけ覚えよう
  各行の最初に見つかったものだけなく
  全ての `置換前` を `置換後` に変更するよ

## 実践

しげる（通常）：
  では実際の例を見てみよう
  `sed` で前回扱った
  `/etc/passwd` を加工してみよう
みどり（通常）：
  情報が「コロン(`:`)」区切りになっていて
  最初がユーザ名だったよね！
しげる（通常）：
  そのことを知っていれば
  以下のようにすることで
  全ユーザを列挙できるんだ

```bash
sed 's/:.*//' /etc/passwd
```

みどり（通常）：
  どんな結果に
  なるのかな？

```console
root
bin
...
shigeru
midori
```

みどり（通常）：
  区切り文字 `:` と
  その後に続く任意の文字列 `.*` を
  空っぽに置き換える…
  つまり削除するんだね！
しげる（通常）：
  そういうことだね
  これで Linux システム上の
  全ユーザ名を列挙できるんだ

## 区切り文字を変える

みどり（通常）：
  「置換前」や「置換後」の指定に
  「スラッシュ(`/`)」が
  含まれていたら
  どうすればいいのかな？
  例えばパスとかは
  たくさん含まれるんだけど…
しげる（通常）：
  実は `s` の直後に来る文字が
  置換操作の区切り文字になるんだ
  なので以下のように
  別の区切り文字を使えるよ

```bash
sed \
    's%/home/shigeru%/home/midori%g' \
    <<< /home/shigeru/diary
```

みどり（通常）：
  なるほど！
  この例では `%` を
  区切りに使っているんだね！
みどり（笑顔）：
  普段は「スラッシュ(`/`)」だけど
  不都合なときは
  別の文字を使っても
  いいんだ！

## まとめ

みどり（通常）：
  今回は `sed` のうち
  置換の方法を学んだよ！
しげる（通常）：
  `sed` では置換以外にも
  多くの編集操作が
  用意されているよ
  大抵のテキスト処理は
  `sed` だけでできてしまう
  万能コマンドなんだ

