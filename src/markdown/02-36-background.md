chapter=2
story=36
title=バックグラウンド実行
keyword=background
keyword=jobs
keyword=fg
keyword=bg
prev=2/35/
prev-title=ファイル検索
next=2/37/
next-title=プロセス

# バックグラウンド実行

みどり（通常）：
  お兄ちゃん！
  音楽を聴きながら
  作業をするように
  複数のコマンドを
  同時に動かせないかな？
しげる（通常）：
  ちゃんとそういう仕組みがあるよ！
  「バックグラウンド実行」
  とよばれるんだ
みどり（通常）：
  やっぱりできるんだね！
  教えて欲しい！

## フォアグラウンドとバックグラウンド

しげる（通常）：
  `sleep` は
  指定した秒数だけ待機するよ
  指定がなければ1秒待機するんだ

```bash
sleep [秒数]
```

しげる（通常）：
  好きな秒数で `sleep` を
  動かしてみよう！
みどり（通常）：
  長すぎない数字がいいよね
  3秒でどうかな？

```bash
sleep 3
```

みどり（驚き）：
  …あっ
  3秒後ぐらい待たされた後に
  プロンプトが表示されたよ！
しげる（通常）：
  `sleep` が終わるまで
  次の操作ができないよね
  これを「フォアグラウンド
  (foreground)」というんだ
しげる（通常）：
  この「フォアグラウンド」を
  「バックグラウンド」に持っていこう
  コマンドの最後に `&` を付けるだけだよ

```bash
コマンド &
```

みどり（通常）：
  今回は長めの方がいいよね？
  これでどうかな？

```bash
sleep 273 &
```

みどり（驚き）：
  あっ！
  すぐにプロンプトが返ってきた！

```console
[1] 5123
```

みどり（通常）：
  しかも `[1]` と
  何かメッセージが出てきたよ
しげる（通常）：
  `sleep` がバックグラウンドで動いて
  フォアグラウンドで他の操作が
  できるようになったんだ
  バックグラウンドで動いている
  プログラムを「ジョブ(job)」というよ
しげる（通常）：
  表示された`[1]` は
  「ジョブ番号(job number, jobspec)」で
  ジョブを一意に識別する番号なんだ

## `jobs` コマンド

みどり（通常）：
  ジョブの動作状況は見えにくいよね
  ジョブの確認はどうすればよいのかな？
しげる（通常）：
  `jobs` はジョブ一覧を表示するよ

```bash
jobs [オプション]... [ジョブ番号]...
```

しげる（通常）：
  ここでは `jobs` だけ
  実行してみよう！

```bash
jobs
```

みどり（通常）：
  さっきの `sleep` は
  バックグラウンドで
  動いていてくれているかな？

```console
[1]+ Running                 sleep 273 &
```
みどり（驚き）：
  おお！
  `sleep 273 &` が
  動いているのがわかるね！

# `fg` コマンド

しげる（通常）：
  `fg` はジョブを
  フォアグラウンドに移すよ
  foreground の略なんだ

```bash
fg [ジョブ番号]
```

しげる（通常）：
  指定が無ければ
  最後に実行された
  ジョブが対象になるよ
  以下を実行してみよう！

```bash
fg
```

みどり（通常）：
  実行したよ！

```bash
sleep 273
```

みどり（通常）：
  `sleep` のジョブが
  フォアグラウンドに
  なったんだね
  プロンプトが表示されず
  待たされ続けているよ

# `bg` コマンド

みどり（通常）：
  フォアグラウンドで
  動いているコマンドを
  バックグラウンドに
  戻すこともできるのかな？
しげる（通常）：
  もちろんできるよ！
  Ctrl + Z を押してみて
みどり（通常）：
  Ctrl + C の割り込みと
  操作が似ているね

```console
[1]+  Stopped                  sleep 273
```

みどり（驚き）：
  プロンプトが返ってきたね！
  `jobs` と同じ感じで
  番号が表示されたよ！
しげる（通常）：
  これはコマンドが
  一時停止状態になって
  バックグラウンドに
  移ったという意味なんだ
しげる（通常）：
  `bg` は一時停止状態の
  ジョブを再開するよ
  これは background の略だよ

```bash
bg [ジョブ番号]...
```

しげる（通常）：
  これも `bg` だけで実行しよう！
  ジョブの指定がなければ
  直前に一時停止になった
  ジョブを再開するよ

```bash
bg
```

みどり（通常）：
  じゃあ `bg` を
  実行するね！

```console
[1]+ sleep 273 &
```

みどり（通常）：
  表示があって
  すぐプロンプトが
  返ってきたよ！
しげる（通常）：
  ジョブの状況を
  確認してみよう

```bash
jobs
```
みどり（通常）：
  どれどれ…

```console
[1]+ Running                 sleep 273 &
```

みどり（笑顔）：
  本当だ！
  また裏で動き始めて
  くれたんだね！

## まとめ

みどり（通常）：
  コマンドの後ろに `&` を付けるだけで
  バックグラウンド実行になるんだね！
  関連コマンド `jobs`, `fg`, `bg` も学んだよ！
しげる（通常）：
  バックグラウンド実行されるコマンドは
  音楽再生のようにずっと裏で動いて欲しいコマンドや
  時間のかかる処理などが実行されることが多いよ
  今意識している操作をフォアグラウンドで進めて
  Linux を快適に操作しよう！

