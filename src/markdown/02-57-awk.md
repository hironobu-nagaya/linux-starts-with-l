chapter=2
story=57
title=awkコマンド
keyword=awk
prev=2/56/
prev-title=sedコマンド
next=2/58/
next-title=テキスト関連コマンド(その1)

# `awk` コマンド

みどり（通常）：
  今、お兄ちゃんから
  正規表現を使った
  コマンドを学んでいるよ！
  これまでで `grep` と
  `sed` を学んだんだ！
しげる（通常）：
  今回は `awk` を
  学んでいこう！

## 使い方

しげる（通常）：
  `awk` は
  決まった構造を持った内容を
  処理するのが得意なコマンドだよ
しげる（通常）：
  `awk` は制作者3名の頭文字で
  特定の意味を持った
  単語ではないんだ

```bash
awk [オプション]... 'パターン {アクション}' [ファイル]
```

オプション  | 役割
----------- | ----
`-F 文字列` | 指定された文字列をフィールド区切り文字にする

みどり（通常）：
  決まった構造を持った内容…
  今まで扱ったような
  `/etc/passwd` のようなものかな？
しげる（通常）：
  そうだね
  後で `/etc/passwd` を
  扱ってみよう！

## レコードとフィールド

しげる（通常）：
  読み込む内容の単位を
  「レコード(record)」と呼ぶんだ
  デフォルトでは1行が
  「レコード」となるよ
みどり（通常）：
  基本的には1行ずつ読み込んで
  その内容を解析していくんだね
しげる（通常）：
  レコードは
  「フィールドセパレータ
  (field separator, FS)」
  という区切り文字で区切られていて
  その区切られた要素を
  「フィールド」と呼ぶよ
しげる（通常）：
  デフォルトではスペースやタブなど空白文字が
  フィールドセパレータになっているんだ
みどり（通常）：
  「レコード」が
  「フィールド」と
  呼ばれる要素で
  構成されていると
  解釈してくれるんだ

## パターンとアクション

しげる（通常）：
  `awk` の操作は
  「パターン(pattern)」と
  「アクション(action)」で
  指定するよ
しげる（通常）：
  「パターン」は
  処理対象のレコードの指定で
  指定が無ければ全ての行で
  処理をしてくれるんだ
みどり（通常）：
  パターンを指定すれば
  一部のレコードだけに
  処理を絞れるんだね！
しげる（通常）：
  「アクション」は処理内容で
  指定がなければレコードを
  画面に出力するよ

## 実例

しげる（通常）：
  定義ばかりで難しかったね
  ここからは実例を見ながら
  `awk` を見ていこう
みどり（通常）：
  うん！
しげる（通常）：
  `/etc/passwd` から
  `midori` ユーザの行を
  抜き出してみよう！

```bash
awk '/^midori:/' /etc/passwd
```

みどり（通常）：
  `/^midori:/` は
  `{ ... }` で
  囲われていないから
  パターンになるのかな？
しげる（通常）：
  そのとおり！
  `/ ... /` は
  正規表現の指定なんだ
しげる（通常）：
  `/^midori:/` で
  「`midori:` で始まるレコードだけを処理」
  という意味になるよ
しげる（通常）：
  アクションを指定していない場合は
  レコードをそのまま表示するので
  `grep` と同じような動きになるよ

```console
midori:x:1001:1001:Midori Wakagi:/home/midori:/bin/bash
```

みどり（通常）：
  でも `/etc/passwd` の
  区切り文字って `:` だよね？
  区切り文字をちゃんと利用して
  操作してみたいのだけど
  どうすればいいのかな？
しげる（通常）：
  それは `-F` オプションで
  区切り文字を指定するよ
しげる（通常）：
  `-F` オプションで
  1文字を指定すると「その文字」
  2文字以上を指定すると正規表現になるんだ
みどり（笑顔）：
  区切りを正規表現で指定できる？
  それは柔軟にテキストを扱えそうだね
しげる（通常）：
  `-F` オプションを使って
  同じ動作をする `awk` コマンドを
  書いてみよう！

```bash
awk -F: '$1 == "midori"' /etc/passwd
```

しげる（通常）：
  `$0` がレコード全体
  `$1` が1番目のフィールド
  `$2` が2番目のフィールド
  …を意味するんだ
みどり（通常）：
  区切り文字を
  「コロン(`:`)」にして
  1番目のフィールドが
  `midori` であるレコードを表示…
みどり（通常）：
  実行して結果を
  確認してみるね！

```console
midori:x:1001:1001:Midori Wakagi:/home/midori:/bin/bash
```

しげる（通常）：
  今度は「アクション」を
  書いてみよう
  `print` は引数の内容を
  表示してくれるんだ

```bash
awk -F: '{ print $1 }' /etc/passwd
```

みどり（通常）：
  今度は「パターン」が
  書かれていないね
  ということは全部の行が
  処理されるのかな

```console
root
bin
...
shigeru
midori
```
みどり（通常）：
  あっ `sed` のときの例と
  同じ結果になったね！
  全ての行から1番目のフィールドだけ
  抜き出して表示してくれたんだね！
しげる（通常）：
  もちろん「パターン」と
  「アクション」を
  混ぜて使うこともできるよ

```bash
awk -F: '$1 == "midori" {print $1}' /etc/passwd
```

みどり（通常）：
  区切り文字を「コロン(`:`)」にして
  1番目のフィールドが `midori` である
  レコードの1番目のフィールドを表示…
  って意味ね！

```console
midori
```

しげる（通常）：
  `$1` はユーザ名なので
  抜き出してもあまり面白くないけど
  `$1` を別の数字に置き換えるなどの
  応用ができるよ

## まとめ

みどり（通常）：
  今回は決まった構造を持った内容を
  処理するのが得意な `awk` を学んだよ！
  でも使いこなすのは大変そう…
しげる（通常）：
  実は `awk` はスクリプト言語でもあるんだ
  なのでプログラミングもできるんだよ
  `grep` や `sed` の動きを再現できたように
  たいていの処理は実現できるんだ

