chapter=3
story=1
title=シェルスクリプト
keyword=shell script
keyword=interactive
keyword=non-interactive
keyword=shebang
prev=2/68/
prev-title=その他のコマンド
next=3/2/
next-title=コメント

# シェルスクリプト

みどり（通常）：
  お兄ちゃん！
  この前作った
  「おみくじ」なんだけど
  時々使いたくなるんだよね！
  これをコマンドみたいに
  簡単に実行できないかな？

```bash
cat << EOF | shuf | head -n 1
大吉
中吉
中吉
小吉
小吉
小吉
吉
吉
吉
吉
EOF
```

しげる（通常）：
  できるよ！
  今回は「シェルスクリプト(shell script)」を学ぼう！
  以降、単に「スクリプト(script)」と呼ぶよ
みどり（驚き）：
  おおっ！
  なんだか凄そうな名前だね！

## 「対話的」と「非対話的」

しげる（通常）：
  最初に「対話的(interactive)」と
  「非対話的(non-interactive)」を覚えよう！
みどり（通常）：
  「対話的」って…
  なんだろう？
しげる（通常）：
  今までみどりがやってきたように
  シェルにコマンドを打ち込むと
  シェルが実行してプロンプトを返してくれる
  これを「対話的」と言うんだよ
みどり（通常）：
  なるほど！
  確かにシェルと
  「対話」しているような
  感じだったよね
しげる（通常）：
  一方「非対話的」と言う操作もあるんだ
  これは事前にやりたいことを
  テキストファイルにまとめて
  それをシェルに解釈してもらうやり方だよ
みどり（通常）：
  コマンドを1つずつ
  入力するのではなくて
  あらかじめやって欲しいことをまとめて書いて
  それをシェルに全部お願いするような感じ？
しげる（通常）：
  そうそう！
  例えるならレストランで注文票を渡して
  料理ができるまで待っているようなものだね
  その注文票にあたるのが
  「シェルスクリプト」なんだ
みどり（通常）：
  だから「スクリプト(script)」
  つまり「台本」「手順書」などの
  意味なんだね！

### シェルスクリプト作成

しげる（通常）：
  早速おみくじを
  シェルスクリプトにしてみよう！
  まずは `omikuji` ファイルを編集しよう

```bash
vim omikuji
```

みどり（通常）：
  このファイルに
  スクリプトを書くんだね
  内容はどうすればよいのかな？
しげる（通常）：
  内容は以下のとおりだよ

```bash
#!/bin/bash
cat << EOF | shuf | head -n 1
大吉
中吉
中吉
小吉
小吉
小吉
吉
吉
吉
吉
EOF
```

みどり（通常）：
  1行目以外は
  以前書いたものと同じだね！
みどり（通常）：
  この最初の1行目に
  見慣れない記述があるけど…
  これは何なのかな？
しげる（通常）：
  これは「シェバン(shebang)」という記述だよ
  1行目の `#!` の後の実行ファイルで
  2行目以降の内容を
  実行するように指定しているんだ
みどり（通常）：
  1行目は
  「このプログラムで実行して下さい」
  と教える目印なんだ！
みどり（笑顔）：
  シェル `/bin/bash` に
  解釈してもらうから
  「シェルスクリプト」なんだね！

## シェルスクリプトを実行可能にする

しげる（通常）：
  次にこの `omikuji` ファイルを
  実行可能にするよ
  パーミッションの実行権限の
  ことを覚えているかな？
みどり（通常）：
  うん、覚えているよ！
  こうすればいいんだよね？

```bash
chmod a+x omikuji
```

しげる（通常）：
  そのとおり！
  実行後は `ls -l` で確認しよう！

```bash
ls -l
```

みどり（通常）：
  実行権限(`x`)が
  付いていればいいんだね！

```bash
-rwxr-xr-x 1 midori midori 104 Jan  3 19:10 omikuji
```

みどり（通常）：
  パーミッションは
  `rwxr-xr-x` だから…
  ちゃんと実行権限が付いているね！

## シェルスクリプトを実行する

みどり（通常）：
  よし！
  早速実行しよう！

```bash
omikuji
```

みどり（通常）：
  日頃の行いが良いから
  「大吉」かな？

```console
/bin/bash: omikuji: command not found
```

みどり（驚き）：
  …あれ？
  「コマンドが見つからない」
  って意味だよね？
  ちゃんと実行可能にしたのに？
しげる（通常）：
  これは `PATH` 変数の問題だね
みどり（通常）：
  `PATH` 変数の値は
  コマンドを探す場所を
  「コロン(`:`)」区切りで
  指定したものだよね？
しげる（通常）：
  そうだよ
  コマンドは `PATH` 変数の値で
  決められた場所から探すんだ
  指定の場所に無いと
  コマンドとしては実行されないよ
みどり（通常）：
  じゃあこれから
  どうすればいいんだろう？
しげる（通常）：
  `PATH` 変数に含まれない
  ディレクトリにある
  スクリプトでも実行できるよ
  スクリプトのパスを指定するんだ
  以下のようにしてみよう

```bash
./omikuji
```

みどり（通常）：
  ええっと…
  `.` は「ワーキングディレクトリ」
  すなわち今私がいる
  ディレクトリだよね？
しげる（通常）：
  そうそう！
  `./omikuji` は
  「現在のディレクトリにある omikuji」
  を実行するという意味になるんだ
  これでスクリプトを
  パスで指定したことになるよ！
みどり（通常）：
  なるほど！
  じゃあやってみるね！

```console
大吉
```

みどり（笑顔）：
  おおっ！
  動いた動いた！
しげる（通常）：
  いいね！
  これでおみくじスクリプトが完成したね！

## まとめ

みどり（通常）：
  今回はシェルスクリプトを
  書いて実行したよ！

1. スクリプトの1行目にシェバン、2行目以降にコマンドを書く
2. スクリプトに実行権限を与える
3. `./スクリプト` でスクリプトを実行する

しげる（通常）：
  お気に入りの操作は
  シェルスクリプトにしよう！
  ファイルだから無くなることはないよ！

