chapter=4
story=17
title=ユーザ設定ファイル
keyword=super user
keyword=root
keyword=passwd
keyword=shadow
keyword=vipw
prev=4/16/
prev-title=ファイルシステム
next=4/18/
next-title=グループ設定ファイル

# ユーザ設定ファイル

みどり（通常）：
  お兄ちゃん！
  `/etc` には
  設定ファイルがあるんだよね
  システム管理者が
  気にするべき設定に
  どういうものがあるのかな？
しげる（通常）：
  今回は `/etc/passwd` を見てみよう！
みどり（通常）：
  正規表現のときに
  このファイルを扱ったね！

## `/etc/passwd` ファイル

しげる（通常）：
  ユーザ情報の管理は
  `/etc/passwd` で行われているよ
  各行がユーザを表していて
  情報を「コロン(`:`)」で
  区切っているんだ

フィールド | 意味
---------- | ----
1          | ユーザ名
2          | ハッシュ化されたパスワード
3          | UID(ユーザID)
4          | GID(グループID)
5          | コメント
6          | ホームディレクトリ
7          | ログインシェル

みどり（通常）：
  項目にパスワードがあるのって
  大丈夫なのかな？
  `cat /etc/passwd` で
  表示できてしまうんだけど…
しげる（通常）：
  大丈夫！
  昔はここにパスワード情報があったけど
  現在は `/etc/shadow` に移されているよ
  このファイルはスーパユーザしか見られないよう
  パーミッションが設定されているんだ
  このような場合 `/etc/passwd` の
  パスワードの項目の箇所には
  `x` とだけ書かれているんだ

## `/etc/shadow` ファイル

しげる（通常）：
  `/etc/shadow` は
  スーパユーザしか
  アクセスできないユーザ情報を
  管理しているよ

フィールド | 意味
---------- | ----
1          | ユーザ名
2          | ハッシュ化されたパスワード
3          | パスワードを最後に変更した日
4          | パスワード変更可能になるまでの日数
5          | パスワード有効日数
6          | パスワード期限切れ警告日数
7          | 無効になるまでの非アクティブ日数
8          | アカウント失効日
9          | フラグ

みどり（通常）：
  うわぁ！
  いっぱいある！
しげる（通常）：
  ユーザのアカウントやパスワードに
  制限をつけることは滅多にないんだ
  普段気にするのは2番目や3番目の
  フィールドぐらいだから
  慌てなくても大丈夫！

## `vipw` コマンド

しげる（通常）：
  `/etc/passwd` を編集する場合は
  `vipw` コマンドを使おう！

```bash
sudo vipw
```

みどり（通常）：
  普通にエディタで
  開いたらダメなのかな？
しげる（通常）：
  それだとファイルの
  整合性が保証されないんだ
しげる（通常）：
  `vipw` を使うと
  他のプロセスが編集中に
  内容を変更できないようロックを掛けたり
  保存時に書式チェックをしてくれるんだ
みどり（通常）：
  わかった！
  `/etc/passwd` を
  編集するときは
  `vipw` ね！
しげる（通常）：
  また `vipw -s` とすることで
  `/etc/passwd` の代わりに
  `/etc/shadow` を編集するよ

## まとめ

みどり（通常）：
  今回はユーザ設定ファイル
  `/etc/passwd` と `/etc/shadow`
  それに関連するコマンドを学んだよ！
しげる（通常）：
  どちらも Linux システムにとって
  非常に重要なファイルだから
  内容を変更する時は
  細心の注意を払ってね

