chapter=2
story=51
title=終了ステータス
keyword=exit status
keyword=true
keyword=false
prev=2/50/
prev-title=ハッシュ(使い方)
next=2/52/
next-title=testコマンド

# 終了ステータス

みどり（通常）：
  お兄ちゃん！
  たいていのコマンドって
  実行しても起こったことを
  知らせてくれないよね
みどり（通常）：
  失敗したらエラーメッセージが
  出ることが多いけど
  成功や失敗がわかりにくいよ…
しげる（通常）：
  実はコマンドは
  成功や失敗を
  こっそり伝えているんだよ
みどり（驚き）：
  えっ？
  全然そんな感じはしなかったけど…
しげる（通常）：
  普段は気にならないようになっているので
  気が付かないのが普通だから大丈夫だよ
しげる（通常）：
  今回は「終了ステータス(exit status)」を学ぼう！
  これは「コマンドの成否」を
  数字で表したものだよ
  「終了コード(exit code)」や
  「返り値(return value, retval)」とも
  よばれるんだ

## `true` コマンド

しげる（通常）：
  `true` は
  どんな引数が与えられても
  何もせず成功で終了するよ

```bash
true [引数]...
```

みどり（笑顔）：
  名前がわかりやすいね！
しげる（通常）：
  それでは引数なしで
  実行してみよう！

```bash
true
```

みどり（通常）：
  …何も起こらず
  すぐにプロンプトが表示されたね
しげる（通常）：
  何も起こっていないように見えるけど
  シェルはこのコマンドの
  「成功」という結果を
  覚えているんだ
みどり（通常）：
  どうやって見れば
  いいのかな？
しげる（通常）：
  `?` 変数を使おう！
  この変数には直前のコマンドの
  終了ステータスが入っているんだ
しげる（通常）：
  `echo` で
  `?` 変数の値を
  表示させて確認しよう

```bash
echo $?
```

みどり（通常）：
  どれどれ…

```console
0
```

みどり（通常）：
  `0` が表示されたよ！
  `true` が成功して終了するということは
  `0` は成功を意味するんだよね？
しげる（通常）：
  そのとおり！
  シェルでは `0` が成功
  `0` 以外は失敗を意味するよ

## `false` コマンド

しげる（通常）：
  `false` は
  どんな引数が与えられても
  何もせず失敗で終了するよ

```bash
false [引数]...
```

みどり（笑顔）：
  こっちも名前が
  わかりやすいね！
しげる（通常）：
  こちらも引数なしで
  実行してみよう！

```bash
false
```

みどり（通常）：
  うん！
みどり（通常）：
  これも特に何も起きず
  すぐプロンプトが返ってきたね
しげる（通常）：
  挙動は `true` と同じだけど
  結果が違うんだ
  終了ステータスを
  確認してみよう

```bash
echo $?
```

みどり（通常）：
  これまでの説明からすると
  `0` 以外が入っていそうだね

```console
1
```

みどり（通常）：
  今度は `1` が表示されたよ！
  `0` 以外が「失敗」を
  意味するんだよね！
しげる（通常）：
  そうなんだ
  コマンドは終了するときに
  終了ステータスを返しているよ
しげる（通常）：
  普段はあまり見ることはなく
  必要な時に確認するものなんだ
みどり（通常）：
  なるほど…
  コマンドが成功か失敗かは
  `?` 変数で確認できるんだね

## 終了ステータスの反転 `!`

しげる（通常）：
  コマンドの前に `!` を付けると
  そのコマンドの終了ステータスを
  反転するよ

```bash
! コマンド
```

しげる（通常）：
  `!` と `コマンド` の間には
  スペースが必要だから
  気を付けてね
みどり（通常）：
  コマンドが「成功(`0`)」を返せば「失敗(`0`以外)」
  コマンドが「失敗(`0`以外)」を返せば「成功(`0`)」
  を返すってことでいいのかな？
しげる（通常）：
  そういうことだね！

## まとめ

みどり（通常）：
  今回は終了ステータスを学んだよ！
  コマンドは終了ステータス
  という数字を返していて
  成功は `0`、失敗は `0` 以外なんだ！
  また成功と失敗は `!` で反転できるんだね！
みどり（通常）：
  でもこれって
  どういう場面で
  役に立つのかな？
しげる（通常）：
  例えば状況を判断して
  処理を分ける場合に使われるよ
  「あるコマンドが成功したら次の処理をする」とか
  「失敗したらエラーメッセージを表示する」
  といった感じだね
しげる（通常）：
  具体的な使い方は少し応用的だから
  もう少し後で学ぶことにしよう

