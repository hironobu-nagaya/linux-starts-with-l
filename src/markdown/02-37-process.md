chapter=2
story=37
title=プロセス
keyword=process
keyword=ps
keyword=pstree
keyword=fork
prev=2/36/
prev-title=バックグラウンド実行
next=2/38/
next-title=プロセス操作
keyword=pstree

# プロセス

しげる（通常）：
  今回はコマンドを実行した後で
  「何が起きているのか」を
  覗いてみよう！
みどり（通常）：
  言われてみると
  どんな仕組みなんだろうね？

## 役割

しげる（通常）：
  Linux 上のプログラムは
  「プロセス(process)」という
  単位で動いているよ
みどり（通常）：
  1コマンドが
  1プロセスに
  なるのかな？
しげる（通常）：
  その場合がほとんどだけど
  そうとも限らないんだ
  例えば並列処理の場合は
  1コマンドで複数のプロセスが
  動くこともあるよ
みどり（通常）：
  データのまとまりの単位が
  「ファイル」だとしたら
  プログラムの動きの単位が
  「プロセス」なんだね

## `ps` コマンド

しげる（通常）：
  `ps` で
  プロセスを確認できるよ
  process の略なんだ

```bash
ps [オプション]...
```

オプション | 役割
---------- | ----
`-e`       | 詳細情報を表示
`-f`       | 自分が動かしていないプロセスも表示

しげる（通常）：
  ここでは
  `-e` オプションを
  指定して実行しよう！

```bash
ps -e
```

みどり（通常）：
  うん！

```console
UID          PID    PPID  C STIME TTY          TIME CMD
midori      5173    5172  0 09:28 pts/0    00:00:00 -bash
midori      5632    5173  0 13:00 pts/0    00:00:00 ps -f
```

しげる（通常）：
  この中で注目して欲しいのは
  `PID`, `PPID`, `CMD` の3つだよ
しげる（通常）：
  CMD は「コマンド」の略で
  プロセスを動かしている
  プログラムの名前だね
みどり（通常）：
  CMD はすぐにわかるね！
しげる（通常）：
  PID は「プロセスID(process ID)」の略で
  プロセスを一意に
  識別する番号なんだ
みどり（通常）：
  なるほど！
  `sleep` のプロセスが
  複数動いていても
  PID でそれぞれを
  区別できるんだね！
みどり（通常）：
  似たような名前に
  PPID があるね？
しげる（通常）：
  PPID は
  「親プロセスID(parent process ID)」の略だよ
  プロセスは親子関係があって
  親プロセスの PID が PPID になるんだ

## 親子関係

みどり（通常）：
  プロセスに親子関係が
  あるってどういうこと？
しげる（通常）：
  プロセスは
  「フォーク(fork)」という
  仕組みで作られるんだ
  以下のような流れになるよ

1. 元になるプロセス（親プロセス）が動いている
2. 新しいプロセスを作るとき、親プロセスを「コピー」する
3. コピーされたプロセスは、用途に応じて内容が書き換えられる
4. 書き換えられたプロセスは、元のプロセスの「子プロセス」になる

みどり（通常）：
  なるほど！
  シェルからコマンドを実行する場合
  そのコマンドはシェルの
  子プロセスになるんだね！
しげる（笑顔）：
  飲み込みが早いね
  さっきの `ps` の出力の
  `ps -f` の `PPID` と
  `bash` の `PID` を
  見比べてみてごらん
みどり（驚き）：
  あっ！
  同じ `4172` だ！
  ということは `ps -f` の
  親プロセスは `bash` なんだね

## `pstree` コマンド

みどり（通常）：
  でも `ps` で PID と PPID を
  照らし合わせて探すのは大変だよ…
  もっと簡単に親子関係を
  見られないのかな？
しげる（通常）：
  `pstree` は
  プロセスの親子関係を
  ツリー形式で表示するよ

```bash
pstree [オプション]... [PID|ユーザ名]
```

しげる（通常）：
  `pstree` で
  プロセスの親子関係を
  見てみよう！

```bash
pstree
```

みどり（通常）：
  どれどれ？

```console
systemd─┬─ ...
        ...
        ├─sshd───sshd───sshd───bash───pstree
        ...
```

みどり（笑顔）：
  本当だ！
  `bash` の子どもとして
  `pstree` が表示されたよ
  これなら親子関係が
  一発でわかるね！

## まとめ

みどり（通常）：
  今回は
  プログラムの動作単位
  「プロセス」と
  プロセス確認コマンド
  `ps`, `pstree` を学んだよ！
みどり（通常）：
  でも…
  プロセスの親子関係は
  何のためにあるのかな？
しげる（通常）：
  プロセスを効率的に
  管理するためなんだ
  この話をすると
  長くなりそうだから
  次回のプロセスを
  管理するコマンドで
  説明するね！

