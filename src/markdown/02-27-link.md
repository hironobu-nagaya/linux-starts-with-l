chapter=2
story=27
title=リンク
keyword=ln
keyword=readlink
keyword=unlink
keyword=symbolic link
keyword=hard link
prev=2/26/
prev-title=パーミッション操作
next=2/28/
next-title=ワイルドカード

# リンク

みどり（通常）：
  お兄ちゃん！
  Windows の「ショートカット」
  のようなものって作れるのかな？
しげる（通常）：
  もちろん作れるよ！
  今回は「リンク(link)」について学ぼう！

## `ln` コマンド

しげる（通常）：
  `ln` はリンクを作成するんだ
  link の略なんだよ

```bash
ln [オプション]... リンク先 リンク
```

オプション               | 役割
------------------------ | ----
`-s`, `--symbolic`       | シンボリックリンクを作成
`-f`, `--force`          | `リンク` が存在していればそれを削除してからリンクを作成
`-n`, `--no-dereference` | `リンク` が存在していればそれをシンボリックリンクとして扱わないようにしてリンクを作成
`-v`, `--verbose`        | 動作内容を表示

みどり（通常）：
  さっそく作ってみようよ！
しげる（通常）：
  まずはリンク先のファイル
  `original` を作成しよう

```bash
touch original
```

みどり（通常）：
  うん！
  作ったよ！
しげる（通常）：
  そうしたら `ln` と `-s` オプションを
  指定してリンクを作成しよう

```bash
ln -s original link
```

みどり（通常）：
  確認は `ls` だね

```console
link  original
```

みどり（通常）：
  `original` と `link` の
  2つのファイルがある！
  リンクができたね！
しげる（通常）：
  このリンクは
  「シンボリックリンク(symbolic link)」
  と呼ばれるよ
しげる（通常）：
  シンボリックリンクは
  リンク先の情報を保持していているよ
  `link` へのアクセスは
  代わりに `original` への
  アクセスになるんだ
みどり（通常）：
  まさに Windows の
  ショートカットと同じだね！

## リンクの確認

しげる（通常）：
  リンクの詳細は
  `ls -l` で確認できるよ

```bash
ls -l link
```

みどり（通常）：
  へぇ…

```console
lrwxrwxrwx 1 midori midori 8 Jan  1 17:17 link -> original
```

みどり（通常）：
  `link -> original` と
  リンク情報が表示されるんだね！

## `readlink` コマンド

しげる（通常）：
  `readlink` は
  シンボリックリンクの情報を読むよ
  これでもリンクの情報が確認できるんだ

```bash
readlink [オプション]... シンボリックリンク...
```

オプション             | 役割
---------------------- | ----
`-f`, `--canonicalize` | 最終リンク先を表示

しげる（通常）：
  `readlink` も
  試してみよう！

```bash
readlink link
```

みどり（通常）：
  やってみるね！

```console
original
```

みどり（通常）：
  リンク先の `original` が表示されたよ
  これでもリンク先を確認できるんだね！
しげる（通常）：
  リンク先がシンボリックリンク…と
  リンクが連鎖している場合もあるんだ
  こういうときは `-f` オプションを使うと
  最終的なリンク先を表示してくれるよ

```bash
readlink -f link
```

みどり（驚き）：
  へぇ…
  これは便利だね！

## ハードリンク

みどり（驚き）：
  お兄ちゃん！
  `ln` で `-s` オプションを忘れちゃった！
  そうしたらリンクじゃなくて
  ファイルができちゃったんだけど！

```bash
ln original link
```

しげる（通常）：
  `ln` の `-s` オプションなしで
  作成されたのもリンクなんだ
  このリンクを「ハードリンク(hard link)」というよ
みどり（通常）：
  それはどういう
  ものなのかな？
しげる（通常）：
  ハードリンクは指定されたリンク先と
  同じのデータを指しているんだ
みどり（驚き）：
  つまりストレージ上には
  1個のデータしかないけど
  そのデータを指し示すファイルは
  2個あるということ？！
しげる（通常）：
  そういうことになるね
  同じデータに対して
  ハードリンクが何個あっても
  使用する容量は1ファイル分だし
  どのハードリンクを変更しても
  他のハードリンクを開けば
  変更が反映されているよ
みどり（通常）：
  じゃあ…
  間違って作成したハードリンクは
  削除しても問題ないんだ？
しげる（通常）：
  うん、大丈夫だよ！
  普通にファイルを作った時も
  それはハードリンクなんだ
  ハードリンクが0個になったら
  そのデータは使われないと
  判断されるよ
しげる（通常）：
  使う機会は少ないけど
  概念は覚えておこう！

## `unlink` コマンド

みどり（通常）：
  リンクの削除は
  `rm` でいいのかな？
しげる（通常）：
  うん
  普通は `rm` で
  削除するね
しげる（通常）：
  他にも `unlink` という
  リンクを切るコマンドがあるんだ

```bash
unlink リンク
```

しげる（通常）：
  `unlink` は `rm` と
  同じように使えるけど
  「リンクを切る」という意図を
  明確にしたい場合に
  使うこともあるよ
みどり（通常）：
  「シンボリックリンクを切る」
  「ハードリンクを切る」
  どちらも対象のリンクを
  消す動作になるものね

## まとめ

みどり（通常）：
  今回は「シンボリックリンク」
  「ハードリンク」というリンクの種類と
  `ln`, `readlink`, `unlink` といった
  関連コマンドを扱ったね！
しげる（通常）：
  リンクはファイル名の差異を吸収したり
  簡単にアクセスできる場所にリンクを作ったりと
  システムの操作性や柔軟性を支えてくれているんだ
  普段の作業やシステム操作で
  使う機会が多いから活用してみてね！

