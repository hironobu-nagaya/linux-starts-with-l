chapter=3
story=20
title=パラメータ展開(基本)
keyword=shell script
keyword=parameter expansion
prev=3/19/
prev-title=envコマンド
next=3/21/
next-title=パラメータ展開(拡張)

# パラメータ展開(基本)

しげる（通常）：
  今回は変数の高度な使い方
  「パラメータ展開
  (parameter expansion)」
  を学ぶよ！
みどり（驚き）：
  これまでだけでも
  結構高度だと思っていたけど
  まだまだ上があるんだね…

## `${変数名:=文字列}`

しげる（通常）：
  最初は「デフォルト値の代入」だよ

```bash
${変数名=文字列}
```

しげる（通常）：
  これは `変数名` の変数が未定義のとき
  変数に `文字列` を代入して宣言した上で
  その変数の値を展開してくれるんだ
しげる（通常）：
  また `=` の代わりに `:=` とすると
  `変数名` の変数が
  「未定義」か「値が空」のときに
  同様の処理をしてくれるよ

```bash
${変数名:=文字列}
```

しげる（通常）：
  「コロン(`:`)」をつける場合が
  ほとんどなのでこちらで覚えよう
  後で紹介するパラメータ展開でも同様だよ
みどり（通常）：
  すごそうだけど…
  どうやって使えば
  いいのかな？
しげる（通常）：
  このような例は
  どうだろう？

```bash
#!/bin/bash

echo -n "名前を入力して下さい: "
read NAME
echo "こんにちは、${NAME:=名無しの権兵衛}さん！"
```

みどり（通常）：
  なるほど！
  `read` の入力に
  そのまま Enter だけ押したら
  `NAME` 変数の値は空になるね
みどり（通常）：
  そして表示のときに
  `NAME` が空だったら
  値に「名無しの権兵衛」を代入して
  「こんにちは、名無しの権兵衛さん！」
  と表示してくれるんだ！
しげる（笑顔）：
  そういうことだよ
  便利でしょ？

## `${変数名:-文字列}`

しげる（通常）：
  次は「デフォルト値の表示」だよ

```bash
${変数名:-文字列}
```

しげる（通常）：
  これは `変数名` の変数が
  「未定義」か「値が空」のときに
  `文字列` を表示してくれるんだ
  そうでない場合は
  `変数名` の値を表示するよ
しげる（通常）：
  これは `=` のときのように
  変数への代入はしないんだ
みどり（通常）：
  わざわざ代入を避けるのは
  どんなときなのかな？
しげる（通常）：
  読み取り専用変数などに使われるよ
  位置変数 `$1` などでよく使われるね
みどり（通常）：
  使っている例を
  見せて欲しいなぁ
しげる（通常）：
  こういうので
  どうだろう？

```bash
#!/bin/bash
引数が必要なコマンド "${1:-default}"
```

みどり（通常）：
  シェルスクリプトに
  引数が与えられなかったら
  シェルスクリプト内の
  `引数が必要なコマンド` の引数に
  `default` を指定するんだね！
しげる（通常）：
  `-` はマイナス記号として読むより
  `=` から横棒が一本少なくなって
  代入ができなくなくなって
  弱くなったと読むと覚えやすいよ
みどり（通常）：
  なるほど！

## `${変数名:+文字列}`

しげる（通常）：
  次は「値の代用」だよ！

```bash
${変数名:+文字列}
```

しげる（通常）：
  これは `変数名` の変数が
  「未定義」か「値が空」でないときに
  `変数名` の値の代わりに
  `文字列` を表示してくれるんだ
  そうでなければ通常どおり
  `変数名` の値(空)を表示するよ
みどり（通常）：
  値があるのに
  別の値を使いたいとき…
  うーん
  思いつかないや…
しげる（通常）：
  こんな例は
  どうだろう？

```bash
export PATH="$PATH${PATH:+:}$HOME/bin"
```

みどり（通常）：
  `PATH` 変数の値は
  コマンドを探すパスを
  「コロン(`:`)」で
  区切ったものだよね
しげる（通常）：
  以下を `PATH` 変数の値が
  空になっていた場合にも
  対応できるよう
  拡張したものなんだ

```bash
export PATH="$PATH:$HOME/bin"
```

みどり（通常）：
  なるほど！
  もし `PATH` の値が空だったら
  `export PATH="$HOME/bin"`
  もし `PATH` の値が空でなかったら
  `export PATH="$PATH:$HOME/bin"`
  そういうふうに
  展開してくれるんだね！

## `${変数名:?文字列}`

しげる（通常）：
  最後は「定義のチェック」だよ

```bash
${変数名:?文字列}
```

しげる（通常）：
  これは `変数名` の変数が
  「未定義」か「値が空」のときに
  シェルスクリプトを停止して
  `文字列` を標準エラー出力に
  出力するんだ
  そうでなければ通常通り
  変数の値を展開するよ
みどり（通常）：
  これはわかりやすい！
  値がちゃんと
  指定されていないと
  困る場合の確認に
  使うんだね！
しげる（笑顔）：
  そのとおり！
みどり（通常）：
  でも変数を使う所でしか
  記述できないのは不便だなぁ
  複数の変数があったら
  確認があちこちに
  散らばっちゃうよ
しげる（通常）：
  なのでヌルコマンド `:` と
  一緒に使われるよ
  スクリプト冒頭などで
  以下のように記述されるんだ

```bash
: ${X:?Xの値が設定されていません}
: ${Y:?Yの値が設定されていません}
: ${Z:?Zの値が設定されていません}
```

みどり（驚き）：
  おおっ！
  そんなふうに
  使えるんだ！

## まとめ

みどり（通常）：
  今回はパラメータ展開を学んだよ！
  以下のような記述があるんだ！

記述                | 挙動
------------------- | ----
`${変数名:=文字列}` | `変数名` が未定義か値が空なら `変数名` に `文字列` を代入し表示
`${変数名:-文字列}` | `変数名` が未定義か値が空なら `文字列` を表示、そうでないなら `変数名` の値を表示
`${変数名:+文字列}` | `変数名` が未定義か値が空なら `変数名` の値(空)を表示、そうでないなら `文字列` を表示
`${変数名:?文字列}` | `変数名` が未定義か値が空ならスクリプトを停止して  `文字列` をエラー表示

しげる（通常）：
  変数をより柔軟に扱える
  便利な記法だよ！

