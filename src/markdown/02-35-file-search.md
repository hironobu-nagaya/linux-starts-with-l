chapter=2
story=35
title=ファイル検索
keyword=file search
keyword=find
keyword=locate
keyword=updatedb
keyword=xargs
prev=2/34/
prev-title=パイプ
next=2/36/
next-title=バックグラウンド実行

# ファイル検索

みどり（通常）：
  お兄ちゃん！
  特定のファイルが
  どこにあるかを調べられるかな？
  全部のファイルのパスを覚えられないので
  検索機能が欲しくなってきたよ…
しげる（通常）：
  もちろんできるよ！
  今回はファイル検索コマンドを
  見ていこう！

## `find` コマンド

しげる（通常）：
  `find` は
  ファイル検索コマンドだよ
  以下のように実行するんだ

```bash
find 起点パス 検索オプション...
```

検索オプション     | 意味
------------------ | ----
-name ファイル名   | 指定されたファイル名を検索。メタ文字というワイルドカードと似た指定ができる
-type ファイル種別 | 指定したファイル種別のファイルを検索（後述）
-user ユーザ名     | 指定された所有ユーザのファイルを検索
-group グループ名  | 指定された所有グループのファイルを検索
-size サイズ       | ファイルサイズが指定以上のファイルを検索

ファイル種別 | 意味
------------ | ----
f            | 通常ファイル
d            | ディレクトリ
l            | シンボリックリンク

みどり（通常）：
  ちょっと扱いが
  難しそうだね…
しげる（通常）：
  細かく条件を
  指定できるのが
  `find` の特徴だけど
  初めてだと敷居が高く
  感じてしまうよね
しげる（通常）：
  いくつか
  例を出すから
  見てごらん

`find` コマンド                         | 動作
--------------------------------------- | ----
`find /home -type f -name "diary"`      | /home を起点に、diary という名前の通常ファイルを検索
`find /usr/share -type f -name "*.txt"` | /usr/share を起点に、ファイル名が .txt で終わる通常ファイルを検索
`find /tmp -user midori -group midori`  | /tmp を起点に、所有者が midori で所有グループが midori のファイルを検索
`find . -size 100M`                     | ワーキングディレクトリを起点に、サイズが 100MB 以上のファイルを検索

みどり（驚き）：
  へぇ…
  柔軟にファイルを
  探せるのね！

## `locate` コマンド

しげる（通常）：
  `locate` もファイル検索コマンドだよ
  こちらはあらかじめ検索用データを作っておき
  そこからファイルを探すような動きをするんだ

```bash
locate [オプション]... パターン...
```

みどり（通常）：
  `find` と
  どう違ってくるのかな？
しげる（通常）：
  `locate` は `find` より
  高速な検索ができるけど
  指定されたパターンが
  パスに含まれているかどうかの
  簡単な条件でしか
  検索しかできないんだ
みどり（通常）：
  ファイル名で探すことが多いので
  簡素でも十分役に立ちそう！
しげる（通常）：
  また検索用データ作成後の変更は
  検索に反映されないという問題もあるんだ
しげる（通常）：
  具体的には新しく作ったファイルが見つからなかったり
  削除済みのファイルが結果に表示されたりしてしまうよ
みどり（通常）：
  それはちょっと困るね…
しげる（通常）：
  `updatedb` は
  `locate` の検索用データを作るよ

```bash
updatedb [オプション]...
```

しげる（通常）：
  `updatedb` は1日1回などの
  タイミングで自動実行されるけど
  手動実行しても問題ないんだ
しげる（通常）：
  `sudo` は
  管理者権限でコマンドを実行するんだ
  検索用データは全ユーザ共通で使うので
  このデータの管理は管理者が行うよ
  手動実行する場合は以下のようにしよう！

```bash
sudo updatedb
```

みどり（通常）：
  `updatedb` 実行直後に
  `locate` を実行すると
  検索用データの情報が
  古い問題を回避できるね！

## `xargs` コマンド

しげる（通常）：
  `xargs` は
  標準入力から受け取った内容を
  コマンドの引数にしてくれるんだ

```bash
xargs [オプション]... [コマンド]
```

しげる（通常）：
  以下のように検索コマンドと
  一緒に使われることが多いよ

```bash
find ... | xargs コマンド
```

みどり（通常）：
  どのように使えば
  いいんだろう？
しげる（通常）：
  例えば、以下は `/tmp` にある
  所有者が `midori` のファイルを
  削除するよ

```bash
find /tmp -type -f -user midori | xargs rm
```

みどり（通常）：
  `find` の結果を
  `xargs` に渡すと
  `rm` の引数にして
  実行してくれるんだね！

## まとめ

みどり（通常）：
  今回はファイル検索コマンド
  `find` と `locate` を学んだよ！
  また `xargs` と組み合わせて
  見つかったファイルを
  処理する方法も知ったよ！
しげる（通常）：
  `find` と `locate` には
  それぞれ特徴があるから
  かしこく使い分けよう！

