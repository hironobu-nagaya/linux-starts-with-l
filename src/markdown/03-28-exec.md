chapter=3
story=28
title=execコマンド
keyword=shell script
keyword=exec
prev=3/27/
prev-title=ジョブ管理
next=3/29/
next-title=ANSIエスケープシーケンス

# `exec` コマンド

しげる（通常）：
  今回はシェルのプロセスを
  置き換える方法を学ぼう！
みどり（驚き）：
  え？
  意味がよくわからないんですけど？！

## 仕組み

しげる（通常）：
  プロセスを置き換える
  理由を理解するために
  まずはプロセスの
  親子関係の話から入ろう
みどり（通常）：
  プロセスは親子関係があって
  親プロセスから子プロセスが
  作られるんだよね？
しげる（通常）：
  そうそう
  その話だよ！
しげる（通常）：
  今動いているシェルを
  `pstree` の表示のように
  表現してみよう

```console
bash
```

みどり（通常）：
  このシェル `bash` が
  私のコマンド入力を
  処理してくているんだよね！
しげる（通常）：
  そういうことになるね
  このシェルから
  シェルスクリプトを実行したとしよう
  親子関係はこのようになるんだ

```console
bash ─── bash
```

みどり（通常）：
  うん
  これは理解できるよ！
  親の `bash` が
  私の入力を受け付けるシェルで
  子の `bash` が
  シェルスクリプトを解釈するシェル
  というわけだね！
しげる（通常）：
  ここで実行している
  シェルスクリプトが
  以下のようなものだったとしよう

```bash
#!/bin/bash
ls -l "$@"
```

みどり（通常）：
  `ls` に `-l` オプションを
  付けてくれるスクリプトだね！
しげる（通常）：
  このシェルスクリプトで
  `ls` が実行されると
  このようになるのはわかるかな

```console
bash ─── bash ─── ls
```

みどり（通常）：
  そうなるよね
みどり（通常）：
  でもこうやって見てみると
  シェルスクリプトの
  シェル `bash` が余計に感じるなぁ
  だって `ls` を呼び出しているだけでしょ？
しげる（通常）：
  このように一つのコマンドを
  便利にしたりするスクリプトを
  「ラッパースクリプト(wrapper script)」
  と呼ぶよ
みどり（通常）：
  メインとなるコマンドを
  「つつんで(wrap)」
  便利にしてあげているんだね

## 使い方

しげる（通常）：
  このようなラッパースクリプトで
  使われるのが `exec` なんだ

```bash
exec [オプション]... [コマンド]
```

しげる（通常）：
  これは `exec` を動かした
  シェルのプロセスを
  `コマンド` のプロセスに
  置き換えてくれるよ
しげる（通常）：
  さっきのスクリプトの例だと
  こんな感じになるよ

```bash
#!/bin/bash
exec ls -l "$@"
```

みどり（驚き）：
  じゃあこのスクリプトを実行すると
  親子関係はこうなっちゃうんだ？！

```console
bash ─── ls
```

しげる（通常）：
  そのとおり！
  シェルスクリプトを動かしていた
  `bash` のプロセスが
  `ls` のプロセスに置き換わるんだ
みどり（通常）：
  `bash` プロセスが
  `ls` に置き換わっちゃうんでしょ？
  `exec` より後に
  記述があったら
  どうなっちゃうのかな？
しげる（通常）：
  `ls` のプロセスが
  処理を終えた時点で終了になるよ
  だから `exec` 以降に記述があったとしても
  それらの記述は実行されないことになるんだ
みどり（通常）：
  つまり `exec` は
  ラッパースクリプトの
  最後で使うんだね！

## まとめ

みどり（通常）：
  今回はシェルのプロセスを置き換える
  `exec` を学んだよ！
  ラッパースクリプトで使われるよ！
しげる（通常）：
  `exec` とリダイレクトを組み合わせ
  3番以降のファイルディスクリプタを
  使う目的でも利用されるんだ
  これは高度な使い方なので
  ここでは説明はしないけど
  興味があれば
  「exec リダイレクト」
  などで検索してみよう！

