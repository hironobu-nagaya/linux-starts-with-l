chapter=6
story=6
title=ポート
keyword=port
keyword=lsof
keyword=ss
prev=6/5/
prev-title=ストレージ
next=6/7/
next-title=デーモン

# ポート

みどり（通常）：
  これまでで代表的なリソース
  「CPU」「メモリ」「ストレージ」の
  確認方法を覚えたよ！
  他にもサーバ管理者が
  確認できるといいものって何かな？
しげる（通常）：
  ネットワーク周りの確認も重要だね
  今回はポートの確認方法を学んでいこう！

## `lsof` コマンド

しげる（通常）：
  `lsof` は
  プロセスが開いている
  ファイルを表示するよ
  list open file の略なんだ

```bash
lsof [オプション]... [名前]...
```

オプション | 説明
---------- | ----
`-i`       | ポートを表示
`-P`       | ポート番号をサービス名に変換しない

みどり（通常）：
  開いているファイルを
  確認するコマンドで
  ポートを確認するんだ？
しげる（通常）：
  Linux の考え方に
  「全てをファイルとして扱う」があるよ
  なのでポート確認も
  `lsof` で確認できるんだ
しげる（通常）：
  早速ポートを
  確認してみよう！

```bash
sudo lsof -i -P
```

```console
COMMAND     PID     USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
...
sshd        962     root   3u   IPv4  30008      0t0  TCP *:22 (LISTEN)
...
```

みどり（通常）：
  見やすく一覧表示してくれるんだね！
  `sshd` が 22 番ポートで
  待ち受けしてるのがわかるよ！


## `ss` コマンド

しげる（通常）：
  `ss` は
  ソケット接続の
  統計情報を表示するよ
  socket statistics の略なんだ

```bash
ss [オプション]... [フィルタ]
```

オプション          | 説明
------------------- | ----
`-t`, `--tcp`       | TCP ソケットを表示
`-u`, `--udp`       | UDP ソケットを表示
`-a`, `--all`       | Listen 状況にかかわらず全てのソケットを表示
`-p`, `--processes` | ソケットを利用しているプロセスを表示
`-n`, `--numeric`   | ポート番号をサービス名に変換しない

みどり（通常）：
  ポート確認ができるけど
  本来の用途が違うのね
しげる（通常）：
  以下のようにすると
  `lsof` と同様の情報が見られるよ

```bash
sudo ss -tuapn
```

みどり（通常）：
  オプションの指定が多いけど
  細かく制御できるということなんだね

```console
State    Recv-Q   Send-Q     Local Address:Port       Peer Address:Port    Process
...
LISTEN   0        128        *:22                     *:*                  users:(("sshd",pid=962,fd=3))
...
```

しげる（通常）：
  `ss` ほとんどのシステムで使える
  標準的なコマンドなんだ
  どの環境でも使えると
  考えていいのも強みだよ

## まとめ

みどり（通常）：
  今回はポート確認の方法を学んだよ！
  `lsof` や `ss` で確認できるんだ！
しげる（通常）：
  ポートの状態を知ることで指定したポートで
  アプリケーションが待ち受けているかとか
  管理外のプログラムが勝手に
  ポートを利用していないかなどを確認できるんだ
  ほとんどのサーバプログラムは
  ネットワークを使うので
  ポート確認は大事な基礎知識だよ！

