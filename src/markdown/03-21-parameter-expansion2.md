chapter=3
story=21
title=パラメータ展開(拡張)
keyword=shell script
keyword=parameter expansion
prev=3/20/
prev-title=パラメータ展開(基本)
next=3/22/
next-title=シェル関数

# パラメータ展開(拡張)

みどり（通常）：
  前回はパラメータ展開を学んだよ！
しげる（通常）：
  今回は `bash` で拡張された
  パラメータ展開を紹介するね！
  Linux の標準的なシェルは `bash` なので
  ほとんど問題は起こらないだろうけど
  他のシェルで使えないかもしれないことは
  覚えておこう！

## `${#変数名}`

しげる（通常）：
  最初は「値の長さ」だよ

```bash
${#変数名}
```

しげる（通常）：
  このように書くと
  変数の値の文字列長を返すんだ
  簡単なので試してみよう！

```bash
MESSAGE=123456
echo "${#MESSAGE}"
```

みどり（通常）：
  へぇ…

```console
6
```

みどり（通常）：
  6文字だから
  `6` なんだね
  `wc` の代わりに
  使えそう！

## `${変数名:開始位置:長さ}`

しげる（通常）：
  今度は「値の部分展開」だよ

```bash
${変数名:開始位置:長さ}
${変数名:開始位置}
```

しげる（通常）：
  これは変数の値の
  一部分を抜き出すんだ
  開始位置は 0 から
  数え始めるから気をつけてね！
  例えば `4` は
  「5文字目」となるよ！
しげる（通常）：
  `長さ` の指定がなければ
  開始位置から末尾までを
  抜き出すよ
しげる（通常）：
  負の長さを指定した場合は
  開始位置から
  「末尾から指定された文字数分まで」
  を抜き出すんだ
みどり（通常）：
  言葉で言うと
  複雑な感じがするね
しげる（通常）：
  例を見てみよう！

```bash
VALUE=123456789
```

コマンド               | 出力   | 説明
---------------------- | ------ | ----
`echo "${VALUE:5}"`    | `6789` | 6文字目以降を抜き出す
`echo "${VALUE:3:3}"`  | `456`  | 4文字目以降の3文字を抜き出す
`echo "${VALUE:6:-1}"` | `78`   | 7文字目以降末尾から1文字目までを抜き出す

みどり（通常）：
  これは便利だね！
  `cut` の代わりに
  使えそう！

## `${変数名#文字列}`

しげる（通常）：
  次は「値の前方削除」だよ

```bash
${変数名#文字列}
${変数名##文字列}
```

しげる（通常）：
  これは変数の値の先頭から
  `文字列` にマッチする部分を
  削除した値を表示するよ
  ワイルドカードの指定も可能なんだ
みどり（通常）：
  `#` の個数で
  2パターンあるんだね
しげる（通常）：
  `#` だと最短一致パターン
  `##` だと最長一致パターンを
  削除してくれるよ
しげる（通常）：
  これも例を
  見てみよう！

```bash
VALUE="/home/midori/diary.txt"
```

コマンド                  | 出力
------------------------- | ----
`echo "${VALUE#/home}"`   | `/midori/diary.txt`
`echo "${VALUE#/*/}"`     | `midori/diary.txt`
`echo "${VALUE#*midori}"` | `/diary.txt`
`echo "${VALUE#*.}"`      | `txt`
`echo "${VALUE##*/}"`     | `diary.txt`

みどり（通常）：
  `${VALUE##*/}` は
  `basename` の代わりに
  使えるね！

## `${変数名%文字列}`

しげる（通常）：
  次は「値の後方削除」だよ

```bash
${変数名%文字列}
${変数名%%文字列}
```

しげる（通常）：
  これは変数の値の末尾から
  `文字列` にマッチする部分を
  削除した値を表示するよ
みどり（通常）：
  `${変数名#文字列}` の
  「末尾から」バージョンだね！
しげる（通常）：
  同じく例を
  確認しよう！

```bash
VALUE="/home/midori/diary.txt"
```

コマンド                  | 出力
------------------------- | ----
`echo "${VALUE%.txt}"`    | `/home/midori/diary`
`echo "${VALUE%/*}"`      | `/home/midori`
`echo "${VALUE%midori*}"` | `/home/`
`echo "${VALUE%%[!/]*}"`  | `/`

みどり（通常）：
  `${VALUE$/*}` は
  `dirname` の代わりに
  使えるね！

## `${変数名/置換前/置換後}`

しげる（通常）：
  次は「値の置換」だよ！

```bash
${変数名/置換前/置換後}
${変数名//置換前/置換後}
```

しげる（通常）：
  これは `変数名` の値の
  最初に現れる `置換前` を
  `置換後` に置き換えた値を表示するよ
  `//` を使うと
  「最初に現れる」ではなく
  「全ての」 `置換前` を
  `置換後` に置き換えてくれるんだ
しげる（通常）：
  これも例を見てみよう

```bash
VALUE="/home/midori/diary.txt"
echo "${VALUE/midori/shigeru}"
```

```console
/home/shigeru/diary.txt
```

みどり（通常）：
  それぞれ `sed` の置換の
  `g` フラグありなしの
  動きになるんだね！


### `${変数名^}`, `${変数名,}`, `${変数名~}`

しげる（通常）：
  最後は「大文字小文字の変換」だよ！
  似たような機能なので
  まとめて紹介するね

しげる（通常）：
  `変数名` の値の小文字を
  大文字に変換した値を表示するよ
  `^` は最初の1文字、
  `^^` は全部を変換するんだ

```bash
${変数名^}
${変数名^^}
```

しげる（通常）：
  `変数名` の値の大文字を
  小文字に変換した値を表示するよ
  `,` は最初の1文字、
  `,,` は全部を変換するんだ

```bash
${変数名,}
${変数名,,}
```

しげる（通常）：
  `変数名` の値の大文字小文字を
  入れ替えた値を表示するよ
  `~` は最初の1文字、
  `~~` は全部を変換するんだ

```bash
${変数名~}
${変数名~~}
```

みどり（通常）：
  `tr` の代わりに
  使えるね！

## まとめ

みどり（通常）：
  今回は `bash` 拡張の
  パラメータ展開を学んだよ！
  多くて一度で覚えきれないね…
しげる（通常）：
  より便利に使えるようにするために
  `bash` で追加された記述なので
  みどりが挙げてくれたように
  コマンド置換で代用できる場合が多いよ
しげる（通常）：
  変数の値を細かく加工できて便利だけど
  急いで覚える必要はないと覚えておこう！

