chapter=2
story=50
title=ハッシュ(使い方)
prev=2/49/
prev-title=ハッシュ(基本)
next=2/51/
next-title=終了ステータス

# ハッシュ(使い方)

みどり（通常）：
  前回はハッシュが
  どういうものかを
  教えてもらったよ！
しげる（通常）：
  今回はハッシュの
  使い方を学ぼう！

## ハッシュアルゴリズム

しげる（通常）：
  ハッシュを求める計算方法を
  「ハッシュアルゴリズム
  (hash algorithm)」というよ
しげる（通常）：
  代表的なものに
  以下があるんだ

ハッシュアルゴリズム | ハッシュ値の長さ | 安全性 | 対応するコマンド
-------------------- | ---------------- | ------ | ----------------
MD5                  | 128 bit          | ×      | `md5sum`
SHA-1                | 160 bit          | ×      | `sha1sum`
SHA-224              | 224 bit          | ○      | `sha224sum`
SHA-256              | 256 bit          | ○      | `sha256sum`
SHA-384              | 384 bit          | ○      | `sha384sum`
SHA-512              | 512 bit          | ○      | `sha512sum`

しげる（通常）：
  安全性に「×」が
  付いているものは
  任意のハッシュ値を
  生成できる方法が
  見つかったなどで
  現在では安全に
  利用できないものだよ
みどり（通常）：
  安全性に「×」が
  付いているものは
  使っちゃいけない
  ということ？
しげる（通常）：
  セキュリティに
  関わらない内容なら
  使っても問題ないよ
しげる（通常）：
  例えば
  「ダウンロードしたファイルが
  データ化けしていないか」を
  確認する場合などだよ
みどり（通常）：
  逆のことをいうと
  「ファイルが意図的に
  改ざんされていないか」を
  確認する用途では
  セキュリティが関わるので
  使っちゃダメなんだね！
しげる（通常）：
  特に MD5 は処理が速いので
  安全に使えないと知られてからも
  セキュリティが関わらない用途で
  使われ続けているんだ

## `md5sum` コマンド

しげる（通常）：
  `md5sum` は
  MD5 のハッシュ値を
  生成したり確認するよ

```bash
md5sum [オプション]... [ファイル]...
```

オプション  | 役割
----------- | ----
-c, --check | 入力からハッシュ値のチェックを行う
-q, --quiet | チェックでハッシュ値が一致しなかったファイルのみ出力

しげる（通常）：
  ハッシュアルゴリズムが
  違うコマンドも
  使い方は同様なので
  他のアルゴリズムを
  使いたい場合は
  コマンドを読み替えてね

## ハッシュ値の出力

みどり（通常）：
  お兄ちゃん！
  さっそくハッシュ値を
  求めてみようよ！
しげる（通常）：
  まずはハッシュを求める
  元データを作ろう
  どのように作ってもいいけど
  以下のようにしてみようか

```bash
echo -n "hello" > ~/hello
```

みどり（通常）：
  `echo` の `-n` オプションは
  末尾に改行を付けないだったね
  「hello」とだけ書かれた
  `hello` ファイルを作るんだね
  実行したよ！
しげる（通常）：
  この `hello` ファイルを対象に
  `md5sum` を実行してみよう！

```bash
md5sum ~/hello
```

みどり（通常）：
  どんな値が出てくるか
  ワクワクするね！

```console
5d41402abc4b2a76b9719d911017c592  /home/midori/hello
```

みどり（通常）：
  最初がハッシュ値で
  最後がファイルのパスかな？
しげる（通常）：
  そのとおり！
  複数のファイルを指定しても
  出力の各行から
  ファイルとハッシュ値の
  対応がわかるよ！

## ハッシュ値の比較

しげる（通常）：
  拡張子が `.md5` や
  `.md5sum` のファイルには
  `md5sum` の出力が
  書かれているんだ
  このファイルを使えば
  ハッシュ値の検証ができるよ！
みどり（通常）：
  へぇ…
  こっちも
  やってみようよ！
しげる（通常）：
  まずは `md5sum` の出力を
  `hello.md5sum` ファイルへ
  出力しよう

```bash
md5sum ~/hello > ~/hello.md5sum
```

みどり（通常）：
  うん！
  実行したよ！
しげる（通常）：
  そうしたら `md5sum` に
  `-c` オプションを付けて
  引数に `hello.md5sum` を
  指定して実行してね

```bash
md5sum -c  ~/hello.md5sum
```

みどり（通常）：
  `-c` オプションを指定すると
  指定されたファイルの
  ハッシュ値を求めるのではなく
  指定されたファイルの内容から
  ハッシュ値を確認する動作を
  してくれるんだね！

```console
/home/midori/hello: OK
```

みどり（笑顔）：
  OK と出たよ！
  `hello.md5sum` に
  記録されていたハッシュ値と
  実際のファイルのハッシュ値が
  一致したんだね！
みどり（通常）：
  ところで
  一致しなかった場合は
  どうなるんだろうね？
しげる（通常）：
  それなら
  `hello` ファイルの
  内容を変更してみよう

```bash
echo >> ~/hello
```

みどり（通常）：
  `echo` に引数を
  指定していないけど
  何を出力しているのかな？
しげる（通常）：
  `echo` に
  引数を指定しないと
  改行だけを出力するよ
みどり（通常）：
  ということは
  `hello` ファイルの
  内容の末尾に改行を
  追加したんだね！
しげる（通常）：
  この状態で
  ハッシュ値の比較を
  もう一度行ってみよう！

```bash
md5sum -c  ~/hello.md5sum
```

みどり（通常）：
  これでファイルの
  内容変更が検出できる
  という訳なんだね！

```console
/home/midori/hello: FAILED
md5sum: WARNING: 1 computed checksum did NOT match
```

みどり（驚き）：
  おお！
  チェックで失敗したね！
  ちゃんとハッシュ値の
  変化を検出できたよ！

## まとめ

みどり（通常）：
  今回は `md5sum` で
  ハッシュ値を求めたり
  ハッシュ値を使った
  比較検証を行ったよ
みどり（通常）：
  `md5sum` は MD5 を使うけど
  他のハッシュアルゴリズムを
  使いたい場合
  同様の `〜sum` コマンドで
  ハッシュ値を扱えるよ
しげる（通常）：
  一般的な操作での主な用途は
  ファイル内容変化の検出だよ
  ダウンロードサイトでは
  `.md5` や `.md5sum` も一緒に
  公開されていることがあるので
  これらを使って検証することで
  データ化けが起こっていないと
  確認できるんだ！

