chapter=2
story=45
title=パッチ
prev=2/44/
prev-title=差分
next=2/46/
next-title=プロセス置換

# パッチ

しげる（通常）：
  `diff` の出力は
  「パッチ(patch)」にもなるよ！
みどり（通常）：
  変更前と変更後の
  二つのファイルの「違い」を
  表すファイルだよね？
しげる（通常）：
  そのとおり！
  変更前のファイルとパッチから
  変更後のファイルを
  作ることができるんだ
しげる（通常）：
  今回はそんなパッチの
  扱いを学んでいこう！

## パッチ作成

みどり（通常）：
  前回は以下のコマンドで
  比較するための二つのファイル
  `a.txt` と `b.txt` を作ったね！

```bash
cat > a.txt << EOF
111
222
333
444
555
666
777
888
999
EOF
```

```bash
cat > b.txt << EOF
111
333
444
555
656
777
888
999
000
EOF
```

しげる（通常）：
  それではこれらの差分を
  パッチ `ab.patch` にしよう！
しげる（通常）：
  パッチは unified diff 形式が一般的だよ
  `-u` オプションを指定して出力しよう

```bash
diff -u a.txt b.txt > ab.patch
```

みどり（通常）：
  うん！
  出力したよ！
  中身はこんな感じみたい…

```bash
cat ab.patch
```

```console
--- a.txt       2025-05-12 17:25:22.302944148 +0900
+++ b.txt       2025-05-12 17:25:38.967887343 +0900
@@ -1,9 +1,9 @@
 111
-222
 333
 444
 555
-666
+656
 777
 888
 999
+000
```

みどり（通常）：
  「統一された(unified)」の通り
  差分が一つの記述に
  まとまっている形式なんだね
みどり（通常）：
  行の先頭に `+` や `-` があって
  書式を詳しく知らなくても
  どのような変化があったか
  直感的にわかりやすいね！
しげる（通常）：
  出力の先頭を見てみよう！
  diff 形式との大きな違いは
  比較した二つのファイル名が
  出力に含まれていることだよ
みどり（驚き）：
  言われてみれば…！
  diff 形式は差分内容しか
  出力されていなかったね

## `patch` コマンド

みどり（通常）：
  このパッチ `ab.patch` を
  `a.txt` に反映させるには
  どうすればいいのかな？
しげる（通常）：
  `patch` は
  ファイルにパッチを適用するよ
しげる（通常）：
  書式で覚えるよりも
  入力リダイレクトで使うと覚えよう！
  以下のように実行してみてね

```bash
patch < ab.patch
```

みどり（通常）：
  どれどれ？

```console
patching file a.txt
```

みどり（通常）：
  「`a.txt` ファイルに
  パッチを当てています」
  と表示されたね！
しげる（通常）：
  unified diff 形式の内容には
  ファイル名も含まれているので
  パッチファイルを
  入力リダイレクトするだけで
  処理してくれるんだよ
みどり（通常）：
  もう `a.txt` の内容は
  パッチが当てられたのかな？
しげる（通常）：
  それは中身を表示させて
  確認してみよう！

```bash
cat a.txt
```

みどり（通常）：
  うん！

```console
111
333
444
555
656
777
888
999
000
```

みどり（通常）：
  変更されたっぽいけど
  内容は合っているのかな？
しげる（通常）：
  せっかく `diff` を覚えたのだから
  パッチを当てた `a.txt` と
  `b.txt` を比較してみよう
しげる（通常）：
  ちゃんとパッチが
  当たっていれば
  二つのファイル内容に
  差はないはずだよ
みどり（驚き）：
  おー！
  人間の目で見比べると
  ミスが怖いよね
  機械的に処理できるのなら
  `diff` に任せよう！

```bash
diff a.txt b.txt
```

みどり（笑顔）：
  うん！
  何も表示されない！
  ということは差が無いんだね！
  ちゃんとパッチが
  当たっていたよ

# まとめ

みどり（通常）：
  今回はパッチの扱いを学んだよ！
  `diff` の `-u` オプションで
  unifided diff 形式のパッチを出力して
  `patch` でパッチを適用できるんだ！
しげる（通常）：
  ソフトウェア配布などでは
  パッチも一緒に
  提供されていることがあるよ
  大元のファイルが手元にあれば
  パッチをダウンロードして適用するだけで
  新しいバージョンにすることができるんだ

