chapter=5
story=23
title=ビルド(手順)
keyword=build
keyword=gcc
keyword=make
keyword=configure
prev=5/22/
prev-title=アーカイブ
next=5/24/
next-title=ビルド(実践)

# ビルド(手順)

みどり（通常）：
  お兄ちゃん！
  ソースコードから
  プログラムを作るには
  どうすればいいのかな？
しげる（通常）：
  そのことを
  「ビルド(build)」と呼ぶよ
  ビルド手順は使うツールや
  プログラム言語などによって
  変わってくるんだ
しげる（通常）：
  今回は
  Linux で一般的な
  C や C++ 言語での
  ビルドを説明するね

## 必要なパッケージ

しげる（通常）：
  ビルドには
  以下のパッケージが必要だよ

パッケージ | 役割
---------- | ----
gcc        | コンパイラ(ソースコードから実行ファイルを生成)
make       | ビルドツール(コンパイラの動作を統括)

しげる（通常）：
  ソースコードによっては
  以下のようなパッケージが
  追加で必要になる場合があるよ

パッケージ | 役割
---------- | ----
autoconf   | configure スクリプト生成
automake   | Makefile ファイル雛形生成
flex       | 字句解析
bison      | 構文解析
pkg-config | パッケージ管理
libtool    | ライブラリ管理
m4         | マクロ処理
patch      | ソースコード修正
ncurses    | 画面描画ライブラリ

みどり（通常）：
  追加パッケージは
  どうやって知ればいいのかな？
しげる（通常）：
  たいていソースコードには
  README や INSTALL ファイルが付属しているよ
  この中に必要なパッケージやビルド手順が
  書かれていることが多いからこれを読もう！

## `configure`

しげる（通常）：
  多くの場合ソースコードと一緒に
  `configure` スクリプトが
  付属しているんだ
  これは以下のようなビルドの
  前準備をしてくれるツールだよ

* マシン環境(OS, 必要パッケージなど)の確認
* 機能の有効/無効の設定
* ビルド設定ファイル Makefile 生成

しげる（通常）：
  どんな指定ができるかは
  `--help` オプションで
  調べられるよ

```bash
./configure --help
```

みどり（通常）：
  そのプログラム独自の機能などの
  確認ができるんだね
しげる（通常）：
  そうしたら必要なオプションを指定して
  `configure` スクリプトを実行しよう！

```bash
./configure
```

みどり（通常）：
  簡単そうだけど
  失敗することってある？
しげる（通常）：
  失敗する場合は
  必要なライブラリやツールが
  無い場合がほとんどだよ
  エラーメッセージを読んで
  不足しているものを
  インストールしてあげよう

## `make`

しげる（通常）：
  次に `make` を実行しよう
  これで実行ファイルを
  生成してくれるよ

```bash
make
```

みどり（通常）：
  これだけで
  作ってくれるんだ？！
しげる（通常）：
  configure スクリプトが生成した
  `Makefile` の指示に従って
  動作しているだけだからね
しげる（通常）：
  `make` が何をしているのか気になるのなら
  `Makefile `を覗いてみるといいよ

```bash
less Makefile
```

## `make install`

しげる（通常）：
  ビルドが終わったらインストールだよ
  成果物を所定のディレクトリへ配置しよう！

```bash
make install
```

しげる（通常）：
  `/usr` 配下などに
  インストールする場合は
  書き込みができるよう
  `sudo` が必要となるよ

# まとめ

みどり（通常）：
  今回はソースコードから
  実行ファイルを作るビルドを学んだよ！
  `configure` スクリプトと `make` で
  簡単にできてしまうんだね！
しげる（通常）：
  これらの定型的な手順は「CMMI
  (configure-make-make-install)」
  と呼ばれているよ
  次回は実際にソースコードから
  実行ファイルを作ってみよう！

