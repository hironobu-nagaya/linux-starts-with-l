chapter=3
story=22
title=シェル関数
keyword=shell script
keyword=shell function
keyword=return
keyword=local
prev=3/21/
prev-title=パラメータ展開(拡張)
next=3/23/
next-title=ドットコマンド

# シェル関数

みどり（通常）：
  お兄ちゃん！
  自作スクリプトの内容が
  どんどん大きくなって
  読むのも大変になってきたよ！
しげる（通常）：
  それは大変だね
  今回はまとまった機能を分割する
  「シェル関数(shell function)」を学ぼう！
  以降、単に「関数(function)」と呼ぶよ

## 使い方

しげる（通常）：
  関数は以下のように定義するよ

```bash
function 関数名() {
  処理
}
```

しげる（通常）：
  `function` は省略可能なんだ
  だからこのように書いても同じだよ

```bash
関数名() {
  処理
}
```

しげる（通常）：
  定義した関数はコマンドと
  同じように呼び出せるよ

```bash
関数名
```

みどり（通常）：
  処理のまとまりに
  意味のある名前を付けて
  呼び出せるのね
  これだけでも
  スクリプトの中身を
  整理できそうだよ

## 終了ステータス

しげる（通常）：
  関数も終了ステータスを返すよ
  関数内で最後に実行された
  コマンドの終了ステータスが
  関数の終了ステータスになるんだ
みどり（通常）：
  終了ステータスの制御は難しそうだね…
  `exit` のように
  終わりたいタイミングで関数を終わらせて
  終了ステータスを返せないものかな？
しげる（通常）：
  `return` は
  関数を終了して
  終了ステータスを返すよ！

```bash
return [終了ステータス]
```

みどり（通常）：
  `exit` はシェルを終了するけど
  `return` は関数を終了させるんだね！

## 引数

しげる（通常）：
  関数内では
  引数を表す特殊変数には
  関数が呼ばれたときの
  引数の値が入っているよ
みどり（通常）：
  関数でも引数を扱えるんだね
  もうほとんどコマンドと
  変わらないよ！

## `local` コマンド

しげる（通常）：
  `local` は
  シェル関数内のみ有効な
  変数を宣言するよ
  その役割から
  関数の中でしか使えないよ

```bash
local [オプション]... [変数名[=値]]
```

みどり（通常）：
  変数の範囲が
  わかりやすくなるね！

## 注意点

しげる（通常）：
  シェルスクリプトは
  上から下へ書かれた順に
  実行されて行くんだ
  なので関数定義の前に
  関数呼び出しをすると
  「そんなコマンドはない！」
  と怒られるよ
みどり（通常）：
  関数定義は
  早いうちに
  しておいた方が
  良さそうだね！
しげる（通常）：
  関数定義は
  シェルスクリプト冒頭に
  書くのがおすすめだよ

## まとめ

みどり（通常）：
  今回は関数の使い方を学んだよ！
  まとまった処理に名前を付けて
  コマンドのように呼び出せるんだ！
しげる（通常）：
  関数はシェルスクリプト内でよく使われるけど
  通常のシェル上でも定義できるよ
  あたかもそういうコマンドがあるかのように
  実行できるようになって便利なんだ

