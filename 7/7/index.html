<html lang="ja">
<head>
<title>Lから始まるLinux - 7章7話 パッケージ自動更新</title>
<base href="../..">
<meta charset="utf-8">
<meta name="author" content="Hironobu Nagaya">
<meta name="robots" content="all">
<meta name="keywords" content="Lから始まるLinux,Linux starts with L,linux,Raspberry Pi,unattended-upgrades">
<meta name="description" content="兄妹の対話を通してLinuxへの理解を深めていくお話です">
<meta name="viewport" content="width=device-width, initial-scale=0.5" />
<meta name="format-detection" content="telephone=no, email=no, address=no" />
<link rel="prev" href="7/6/" />
<link rel="next" href="7/8/" />
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link rel="stylesheet" href="css/normalize.css" type="text/css">
<link rel="stylesheet" href="css/common.css" type="text/css">
<link rel="stylesheet" href="css/story.css" type="text/css">
</head>
<body>
<header>
<h1>Lから始まるLinux</h1>
<div class="relation">
<div>
<div>前</div>
<div>7章6話</div>
<div><a href="7/6/">ブートローダ更新</a></div>
</div>
<div>
<div>今</div>
<div>7章7話 パッケージ自動更新</div>
<div><a href=".">もくじ</a></div>
</div>
<div>
<div>次</div>
<div>7章8話</div>
<div><a href="7/8/">Raspberry Pi独自機能</a></div>
</div>
</div>
</header>
<main>
<section>
<article class="header1"><span>パッケージ自動更新</span></article>
<article class="talk">
<div><img src="img/midori.svg" alt="若木 みどり" /></div>
<div>
<span><span>お兄ちゃん！</span></span>
<span><span>毎回 </span><code>apt</code><span> でパッケージを</span></span>
<span><span>手動更新するのは面倒だよ！</span></span>
<span><code>cron</code><span> で定期的に</span></span>
<span><span>更新させてもいいものなのかな？</span></span>
</div>
</article>
<article class="talk">
<div><img src="img/shigeru.svg" alt="若木 しげる" /></div>
<div>
<span><span>それならもっと良い方法があるよ</span></span>
<span><code>unattended-upgrades</code><span> パッケージを使うんだ</span></span>
<span><span>これはパッケージの自動更新をしてくれるよ</span></span>
</div>
</article>
<article class="talk">
<div><img src="img/midori.svg" alt="若木 みどり" /></div>
<div>
<span><span>専用のパッケージがあるんだ！</span></span>
<span><span>それを試そうよ！</span></span>
</div>
</article>
<article class="header2"><span>インストール</span></article>
<article class="talk">
<div><img src="img/shigeru.svg" alt="若木 しげる" /></div>
<div>
<span><span>まずは </span><code>unattended-upgrades</code><span> を</span></span>
<span><span>インストールしよう</span></span>
</div>
</article>
<article class="code"><pre><code class="bash">sudo <wbr>apt <wbr>install <wbr>-y <wbr>unattended-upgrades
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>うん！</span></span><span><span>インストールしたよ</span></span><span><span>次は設定だよね？</span></span></div></article><article class="header2"><span>設定</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>設定ファイルは</span></span><span><code>/etc/apt/apt.conf.d/50unattended-upgrades</code></span><span><span>にあるよ</span></span><span><span>この設定ファイルをコピーして</span></span><span><span>コピー先を編集するようにしよう</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>まずは</span></span><span><span>設定ファイルの</span></span><span><span>コピーだよ</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>cp <wbr>-v <wbr>/etc/apt/apt.conf.d/5{0,1}unattended-upgrades
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>ファイル名先頭の数字が</span></span><span><span>1だけ大きい名前の</span></span><span><span>設定ファイルを作るんだね</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>このように先頭が数字と</span></span><span><span>なっている設定ファイルは</span></span><span><span>ファイル名の辞書順に</span></span><span><span>設定が読み込まれるんだ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>数字を増やした</span></span><span><span>設定ファイルを作って</span></span><span><span>そちらが元の設定を</span></span><span><span>上書きするようにしているよ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>次にコピーした設定ファイルを</span></span><span><span>エディタで開いてみよう</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>vim <wbr>/etc/apt/apt.conf.d/51unattended-upgrades
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>最初の</span></span><span><code>Unattended-Upgrade::Origins-Pattern { ... <wbr>};</code></span><span><span>が更新対象のパッケージを指定する項目だよ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>デフォルトはセキュリティ関連の</span></span><span><span>更新しかしてくれないんだね</span></span><span><span>サーバが安定して</span></span><span><span>動いて欲しい場合には良さそう！</span></span><span><span>でも私は普通に全部更新して欲しいな</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>それならコメントアウトされている</span></span><span><span>項目を有効にすればいいよ</span></span><span><span>設定は各項目に丁寧なコメントが</span></span><span><span>付いているので大抵は読めばわかるよ</span></span><span><span>以下の設定項目も良く変更されるから</span></span><span><span>必要があれば変更しよう！</span></span></div></article><article class="table"><table><thead><tr><th><span>設定項目</span></th><th><span>意味</span></th></tr></thead><tbody><tr><td><span>Unattended-Upgrade::Automatic-Reboot</span></td><td><span>再起動が必要な場合に自動で再起動するか（</span><code>true</code><span>/</span><code>false</code><span>で指定）</span></td></tr><tr><td><span>Unattended-Upgrade::Automatic-Reboot-WithUsers</span></td><td><span>ログイン中のユーザがいても再起動するかどうか（</span><code>true</code><span>/</span><code>false</code><span>で指定）</span></td></tr><tr><td><span>Unattended-Upgrade::Automatic-Reboot-Time</span></td><td><span>再起動する時刻の指定</span></td></tr></tbody></table></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>再起動が必要な場合は</span></span><span><span>真夜中に自動再起動して</span></span><span><span>くれるよう設定したよ！</span></span></div></article><article class="header2"><span>起動</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>設定が終わったら動かそう！</span></span><span><span>自動起動も一緒に設定するよ</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>systemctl <wbr>enable <wbr>--now <wbr>unattended-upgrades
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>正常に起動したかどうかは</span></span><span><span>以下で確認できるよ</span></span></div></article><article class="code"><pre><code class="bash">sudo <wbr>systemctl <wbr>status <wbr>unattended-upgrades
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>うん！</span></span><span><span>ちゃんと動いてくれたよ！</span></span></div></article><article class="header2"><span>まとめ</span></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>今回はパッケージを自動更新してくれる</span></span><span><code>unattended-upgrades</code><span> を扱ったよ！</span></span><span><span>これで手動更新しなくても良くなったね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>定期的な更新は</span></span><span><span>セキュリティを保つためにも重要だから</span></span><span><span>自動更新をしておくと</span></span><span><span>忘れることもないし安心だよ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>Debian 系(</span><a href="https://www.debian.or.jp" target="_blank" rel="noopener noreferrer">Debian</a><span>, <wbr></span><a href="https://ubuntulinux.jp" target="_blank" rel="noopener noreferrer">Ubuntu</a><span> など)は</span></span><span><code>unattended-upgrades</code><span> を使っているよ</span></span><span><span>Red Hat 系(</span><a href="https://www.centos.org" target="_blank" rel="noopener noreferrer">CentOS</a><span>, <wbr></span><a href="https://fedoraproject.org/ja/" target="_blank" rel="noopener noreferrer">Fedora</a><span> など)では</span></span><span><span>同じ役割のパッケージに </span><code>dnf-automatic</code><span> があるよ！</span></span></div></article></section></main><footer><div class="relation"><div><div>前</div><div>7章6話</div><div><a href="7/6/">ブートローダ更新</a></div></div><div><div>今</div><div>7章7話 パッケージ自動更新</div><div><a href=".">もくじ</a></div></div><div><div>次</div><div>7章8話</div><div><a href="7/8/">Raspberry Pi独自機能</a></div></div></div></footer><script src="js/jquery.js"></script><script src="js/common.js"></script></body></html>
