<html lang="ja">
<head>
<title>Lから始まるLinux - 3章25話 一時ファイル作成</title>
<base href="../..">
<meta charset="utf-8">
<meta name="author" content="Hironobu Nagaya">
<meta name="robots" content="all">
<meta name="keywords" content="Lから始まるLinux,Linux starts with L,linux,shell script,temporary file,mktemp">
<meta name="description" content="兄妹の対話を通してLinuxへの理解を深めていくお話です">
<meta name="viewport" content="width=device-width, initial-scale=0.5" />
<meta name="format-detection" content="telephone=no, email=no, address=no" />
<link rel="prev" href="3/24/" />
<link rel="next" href="3/26/" />
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link rel="stylesheet" href="css/normalize.css" type="text/css">
<link rel="stylesheet" href="css/common.css" type="text/css">
<link rel="stylesheet" href="css/story.css" type="text/css">
</head>
<body>
<header>
<h1>Lから始まるLinux</h1>
<div class="relation">
<div>
<div>前</div>
<div>3章24話</div>
<div><a href="3/24/">setコマンド</a></div>
</div>
<div>
<div>今</div>
<div>3章25話 一時ファイル作成</div>
<div><a href=".">もくじ</a></div>
</div>
<div>
<div>次</div>
<div>3章26話</div>
<div><a href="3/26/">シグナル処理</a></div>
</div>
</div>
</header>
<main>
<section>
<article class="header1"><span>一時ファイル作成</span></article>
<article class="talk">
<div><img src="img/midori.svg" alt="若木 みどり" /></div>
<div>
<span><span>お兄ちゃん！</span></span>
<span><code>/tmp</code><span> 配下に一時ファイルを作ると</span></span>
<span><span>名前がかぶって困ることがあるんだ！</span></span>
</div>
</article>
<article class="talk">
<div><img src="img/midori.svg" alt="若木 みどり" /></div>
<div>
<span><code>/tmp</code><span> 配下は誰でも</span></span>
<span><span>ファイルを作れるので</span></span>
<span><span>名前がかぶることは</span></span>
<span><span>仕方ないと思うんだけど…</span></span>
<span><span>どうしたらいいかな？</span></span>
</div>
</article>
<article class="talk">
<div><img src="img/shigeru.svg" alt="若木 しげる" /></div>
<div>
<span><span>いくつか方法があるよ</span></span>
<span><span>今回は名前がかぶらない</span></span>
<span><span>一時ファイルを</span></span>
<span><span>作る方法を学ぼう！</span></span>
</div>
</article>
<article class="header2"><code>$</code><span> 変数</span></article>
<article class="talk">
<div><img src="img/shigeru.svg" alt="若木 しげる" /></div>
<div>
<span><code>$</code><span> 変数には</span></span>
<span><span><wbr>「シェルのPID」<wbr>が代入されているんだ</span></span>
<span><span>シェルスクリプトの場合には</span></span>
<span><span>それを解釈しているシェルの PID だね</span></span>
<span><span>これを一時ファイルの名前に含めれば</span></span>
<span><span>名前がかぶる心配はほぼ無くなるよ</span></span>
</div>
</article>
<article class="talk">
<div><img src="img/midori.svg" alt="若木 みどり" /></div>
<div>
<span><span>PID はプロセスの</span></span>
<span><span>一意となる番号だったよね</span></span>
<span><span>PID を名前に含めれば</span></span>
<span><span>問題を解決できそう！</span></span>
</div>
</article>
<article class="talk">
<div><img src="img/shigeru.svg" alt="若木 しげる" /></div>
<div>
<span><span>以下のように</span></span>
<span><span>したらどうだろう？</span></span>
</div>
</article>
<article class="code"><pre><code class="bash">#!/bin/bash

<span class="silver"># <wbr>一時ファイル作成</span>
TEMP_FILE=&quot;/tmp/${0##*/}.$$&quot;
touch <wbr>&quot;$TEMP_FILE&quot;

<span class="silver"># <wbr>一時ファイルを使う処理</span>
...

<span class="silver"># <wbr>一時ファイル削除</span>
rm <wbr>&quot;$TEMP_FILE&quot;
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><code>${0##*/}.$$</code><span> で</span></span><span><code>スクリプト名.シェルのPID</code><span> という</span></span><span><span>一時ファイル名にしているんだ！</span></span><span><span>これならかぶる心配がなさそうだね！</span></span></div></article><article class="header2"><code>mktemp</code><span> コマンド</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>$</code><span> 変数を使えば</span></span><span><span>名前がかぶる心配は</span></span><span><span>ほぼ無くなるけど</span></span><span><span>ゼロではないんだ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>厳密なスクリプトだと</span></span><span><span>困ることがありそうだね</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>mktemp</code><span> は</span></span><span><span>名前がかぶらない</span></span><span><span>一時ファイルを作るよ</span></span></div></article><article class="code"><pre><code class="bash">mktemp <wbr>[オプション]... <wbr>テンプレート文字列
</code></pre></article><article class="table"><table><thead><tr><th><span>オプション</span></th><th><span>役割</span></th></tr></thead><tbody><tr><td><code>-d</code></td><td><span>ファイルではなくディレクトリを作成</span></td></tr></tbody></table></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><code>テンプレート文字列</code><span> は</span></span><span><span>どう書くのかな？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>普通のパスのように書けるよ</span></span><span><span>ただし大文字の </span><code>X</code><span> が</span></span><span><span>連続している箇所は</span></span><span><span>一意となる文字列に</span></span><span><span>置き換えられるんだ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>作られたファイル名は</span></span><span><span>どうやって知るのかな？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>作成されたファイル名は</span></span><span><span>標準出力に出力されるんだ</span></span><span><span>なのでコマンド置換 </span><code>$( ... <wbr>)</code><span> と</span></span><span><span>一緒に使うといいよ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>mktemp</code><span> で</span></span><span><span>一時ファイルを作る例を</span></span><span><span>見てみよう！</span></span></div></article><article class="code"><pre><code class="bash">#!/bin/bash

<span class="silver"># <wbr>一時ファイル作成</span>
TEMP_FILE=&quot;$(mktemp <wbr>&quot;/tmp/${0##*/}.XXXXXXXX&quot;)&quot;

<span class="silver"># <wbr>一時ファイルを使う処理</span>
...

<span class="silver"># <wbr>一時ファイル削除</span>
rm <wbr>&quot;$TEMP_FILE&quot;
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>このスクリプトでは</span></span><span><code>/tmp/スクリプト名.ランダムな8文字</code></span><span><span>という名前の一時ファイルを作るよ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>偶然名前がかぶってしまった場合</span></span><span><span>ランダムな文字列を</span></span><span><span>かぶらなくなるまで</span></span><span><span>選び直してくれるんだ</span></span></div></article><article class="talk"><div><img src="img/midori-smile.svg" alt="若木 みどり(笑顔)" /></div><div><span><span>この方法なら</span></span><span><span>名前のかぶりは</span></span><span><span>気にならなくなるね！</span></span></div></article><article class="header2"><span>まとめ</span></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>今回は一時ファイルの</span></span><span><span>作り方を学んだよ！</span></span><span><span>固定された名前は</span></span><span><span>かぶる可能性があるので</span></span><span><code>$</code><span> 変数の値を名前に含めたり</span></span><span><code>mktemp</code><span> を使うんだ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>スクリプト実行中に</span></span><span><span>一時ファイルを作る場合は</span></span><span><span>これらを活用しよう！</span></span><span><span><wbr>「一時ファイル」<wbr>を</span></span><span><span><wbr>「一時ディレクトリ」<wbr>に</span></span><span><span>置き換えても使えるよ</span></span></div></article></section></main><footer><div class="relation"><div><div>前</div><div>3章24話</div><div><a href="3/24/">setコマンド</a></div></div><div><div>今</div><div>3章25話 一時ファイル作成</div><div><a href=".">もくじ</a></div></div><div><div>次</div><div>3章26話</div><div><a href="3/26/">シグナル処理</a></div></div></div></footer><script src="js/jquery.js"></script><script src="js/common.js"></script></body></html>
