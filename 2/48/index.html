<html lang="ja">
<head>
<title>Lから始まるLinux - 2章48話 同一ファイルへの入出力</title>
<base href="../..">
<meta charset="utf-8">
<meta name="author" content="Hironobu Nagaya">
<meta name="robots" content="all">
<meta name="keywords" content="Lから始まるLinux,Linux starts with L,linux">
<meta name="description" content="兄妹の対話を通してLinuxへの理解を深めていくお話です">
<meta name="viewport" content="width=device-width, initial-scale=0.5" />
<meta name="format-detection" content="telephone=no, email=no, address=no" />
<link rel="prev" href="2/47/" />
<link rel="next" href="2/49/" />
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link rel="stylesheet" href="css/normalize.css" type="text/css">
<link rel="stylesheet" href="css/common.css" type="text/css">
<link rel="stylesheet" href="css/story.css" type="text/css">
</head>
<body>
<header>
<h1>Lから始まるLinux</h1>
<div class="relation">
<div>
<div>前</div>
<div>2章47話</div>
<div><a href="2/47/">グルーピング</a></div>
</div>
<div>
<div>今</div>
<div>2章48話 同一ファイルへの入出力</div>
<div><a href=".">もくじ</a></div>
</div>
<div>
<div>次</div>
<div>2章49話</div>
<div><a href="2/49/">ハッシュ(基本)</a></div>
</div>
</div>
</header>
<main>
<section>
<article class="header1"><span>同一ファイルへの入出力</span></article>
<article class="talk">
<div><img src="img/midori.svg" alt="若木 みどり" /></div>
<div>
<span><span>お兄ちゃん！</span></span>
<span><span>入力リダイレクト </span><code>&lt;</code><span> と</span></span>
<span><span>出力リダイレクト </span><code>&gt;</code><span> を</span></span>
<span><span>同じファイルで</span></span>
<span><span>同時に使おうとすると</span></span>
<span><span>おかしなことになるんだ！</span></span>
</div>
</article>
<article class="talk">
<div><img src="img/midori.svg" alt="若木 みどり" /></div>
<div>
<span><span>まずは</span></span>
<span><span>以下のコマンドで</span></span>
<span><span>ファイルを作ったよ</span></span>
</div>
</article>
<article class="code"><pre><code class="bash">cat <wbr>&gt; <wbr>list <wbr>&lt;&lt; <wbr>EOF
1
2
3
4
5
EOF
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>この内容の各行を</span></span><span><span>シャッフルしようとして</span></span><span><span>以下を実行したんだ</span></span></div></article><article class="code"><pre><code class="bash">shuf <wbr>&lt; <wbr>list <wbr>&gt; <wbr>list
</code></pre></article><article class="talk"><div><img src="img/midori-surprised.svg" alt="若木 みどり(驚き)" /></div><div><span><span>そうしたら</span></span><span><code>list</code><span> ファイルの中身が</span></span><span><span>空になっちゃったんだよ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>これは Linux を操作していると</span></span><span><span>時々やってしまうことだね</span></span><span><span>今回はこの挙動の原因の理解と</span></span><span><span>それを解消する方法を学ぼう！</span></span></div></article><article class="header2"><span>原因</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>ファイルの中身が</span></span><span><span>空になった原因は</span></span><span><span>出力リダイレクト </span><code>&gt;</code><span> だよ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>ファイルの中身を上書きする</span></span><span><span>出力リダイレクトだよね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>出力リダイレクト </span><code>&gt;</code><span> が使われると</span></span><span><span>最初にファイルの中身が空にされるんだ</span></span><span><span>リダイレクトの順序に関係なく</span></span><span><span>出力リダイレクト先のファイルが</span></span><span><span>真っ先に空にされるよ</span></span></div></article><article class="talk"><div><img src="img/midori-surprised.svg" alt="若木 みどり(驚き)" /></div><div><span><span>なるほど！</span></span><span><span>入力リダイレクト </span><code>&lt;</code><span> で</span></span><span><code>list</code><span> ファイルの内容を</span></span><span><span>読み込んでいるけど</span></span><span><span>この時点ですでに</span></span><span><span>内容が空だったんだね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>そういうことだね</span></span><span><span>空の内容をシャッフルしても</span></span><span><span>その結果は空のままだよね</span></span><span><span>その空の内容を書き出したので</span></span><span><span>最終的に </span><code>list</code><span> の中身は</span></span><span><span>空というわけなんだ</span></span></div></article><article class="header2"><span>解決法</span></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>この問題はどうやって</span></span><span><span>解消したらいいんだろうね？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>入力と出力リダイレクトで</span></span><span><span>同じファイルを指定しなければ</span></span><span><span>この問題を解消できるよ</span></span><span><span>いくつか方法があるので</span></span><span><span>見てみよう！</span></span></div></article><article class="header2"><span>一時ファイルを作る</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>コマンドを分割して</span></span><span><span>入力と出力リダイレクトを</span></span><span><span>同時に使わないようにすれば</span></span><span><span>期待どおりに動作するよ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>以下のようにしてみよう</span></span></div></article><article class="code"><pre><code class="bash">shuf <wbr>&lt; <wbr>list <wbr>&gt; <wbr>list.output
mv <wbr>list{.output,}
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>入力リダイレクトの対象は </span><code>list</code><span> で</span></span><span><span>出力リダイレクトの対象は </span><code>list.output</code><span> だね</span></span><span><span>入出力リダイレクトで</span></span><span><span>それぞれ別のファイルを指定することで</span></span><span><span>問題を回避しているんだ！</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>その後 </span><code>mv</code><span> で</span></span><span><code>list.output</code><span> を </span><code>list</code><span> に</span></span><span><span>移動して上書きしているね</span></span><span><span>操作を二段階に分けて</span></span><span><span>やりたいことを</span></span><span><span>実現しているんだ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>Linux に慣れていないなら</span></span><span><span>この方法がわかりやすくて</span></span><span><span>おすすめだよ</span></span></div></article><article class="header2"><code>tee</code><span> を使う</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>tee</code><span> は</span></span><span><span>標準出力とファイルの</span></span><span><span>二つへ出力を書き込むよ</span></span><span><span>T字路の分岐みたいだから</span></span><span><span>この名前なんだ</span></span></div></article><article class="code"><pre><code class="bash">tee <wbr>[オプション]... <wbr>[ファイル]...
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>画面にもファイルにも出力…</span></span><span><span>欲張りさんなコマンドだね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>動作を確かめるために</span></span><span><span>以下のコマンドを</span></span><span><span>実行してみよう！</span></span></div></article><article class="code"><pre><code class="bash">tee <wbr>~/tee-outout <wbr>&lt;&lt;&lt; <wbr>hello
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>まずは画面に</span></span><span><code>hello</code><span> が</span></span><span><span>出るはずだよね？</span></span></div></article><article class="code"><pre><code class="console">hello
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>よし！</span></span><span><span>画面出力は</span></span><span><span>確認できたね！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>もう一つの</span></span><span><span>出力先も見てみよう</span></span><span><span>引数で指定した</span></span><span><code>~/tee-outout</code><span> ファイルだね</span></span></div></article><article class="code"><pre><code class="bash">cat <wbr>~/tee-outout
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>こっちにも同じ内容が</span></span><span><span>書かれていると思うよ！</span></span></div></article><article class="code"><pre><code class="console">hello
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>この </span><code>tee</code><span> を</span></span><span><span>出力リダイレクトの</span></span><span><span>代わりに使うことで</span></span><span><span>問題を解決できるよ</span></span></div></article><article class="code"><pre><code class="bash">shuf <wbr>&lt; <wbr>list <wbr>| <wbr>tee <wbr>list
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>なるほど！</span></span><span><span>出力リダイレクトを使わず</span></span><span><span>代わりに </span><code>tee</code><span> を使うことで</span></span><span><span>出力リダイレクト先が</span></span><span><span>空になるという挙動を</span></span><span><span>回避しているんだね！</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>期待どおりに動いたけど</span></span><span><span>ファイル内容が</span></span><span><span>標準出力にも</span></span><span><span>表示されちゃうね</span></span><span><span>ちょっと気になるかも</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>確かにそう感じるよね</span></span><span><span>でも画面に内容が</span></span><span><span>表示されても害はないし</span></span><span><span>簡単に対処できる方法なんだ</span></span></div></article><article class="talk"><div><img src="img/shigeru-smile.svg" alt="若木 しげる(笑顔)" /></div><div><span><span>どうしても気になるなら</span></span><span><span>画面出力を </span><code>/dev/null</code><span> へ</span></span><span><span>リダイレクトしよう！</span></span></div></article><article class="header2"><span>グルーピングを使う</span></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>最後はグルーピングを使う方法だよ</span></span></div></article><article class="code"><pre><code class="bash">{
  <wbr>rm <wbr>list
  <wbr>cat <wbr>| <wbr>shuf <wbr>&gt; <wbr>list
} <wbr>&lt; <wbr>list
</code></pre></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>先に言っておくけど</span></span><span><span>複雑で難しいので</span></span><span><span>無理に使う必要はないよ</span></span></div></article><article class="talk"><div><img src="img/midori-surprised.svg" alt="若木 みどり(驚き)" /></div><div><span><span>な…</span></span><span><span>何が何だか</span></span><span><span>わからないよ！</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>とりあえずわかりそうな</span></span><span><span>所から見ていくね</span></span><span><span>グルーピング </span><code>{ ... <wbr>}</code><span> の中で</span></span><span><code>rm</code><span> を使っているけど</span></span><span><span>どうしてファイルを</span></span><span><span>削除しているのかな？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>ファイルを削除することで</span></span><span><span>その後の出力リダイレクト</span></span><span><code>shuf &gt; list</code><span> が</span></span><span><span><wbr>「新しいファイル </span><code>list</code><span> に書き出す」<wbr></span></span><span><span>という動作になるんだ</span></span><span><span>入力リダイレクト </span><code>&lt; list</code><span> と</span></span><span><span>ファイル名は同じだけど</span></span><span><span>入出力リダイレクトで</span></span><span><span>別ファイルを指定しているという</span></span><span><span>動作をさせるために使っているよ</span></span></div></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><code>cat</code><span> を引数なしで</span></span><span><span>使っているみたいだけど</span></span><span><span>これはどういう</span></span><span><span>動きをするのかな？</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><code>cat</code><span> を引数なしで実行すると</span></span><span><span>読み込む内容を</span></span><span><span>標準入力から受け付けるよ</span></span><span><span>グルーピング </span><code>{ ... <wbr>}</code><span> の外の</span></span><span><span>入力リダイレクト </span><code>&lt; list</code></span><span><span>から入力を読み込み</span></span><span><span>パイプで次のコマンドに</span></span><span><span>その内容を渡しているんだ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>かなりトリッキーな方法なので</span></span><span><span>理屈はわからなくて大丈夫だよ</span></span><span><span>この方法を使うつもりなら</span></span><span><span>書き方で覚えてしまおう！</span></span></div></article><article class="header2"><span>まとめ</span></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>今回は</span></span><span><span>入力と出力リダイレクトを</span></span><span><span>同時に使うときに</span></span><span><span>同じファイルを指定すると</span></span><span><span>期待通りに動かないことを学んだよ</span></span><span><span>この問題を避けるには</span></span><span><span>いくつか方法があるんだ！</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span><wbr>「入力」<wbr>と<wbr>「出力リダイレクト」<wbr>で</span></span><span><span>同じファイルを指定していれば</span></span><span><span>この問題は発生するよ</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>例えば以下の例でも</span></span><span><span>同じことが起こるんだ</span></span></div></article><article class="code"><pre><code class="bash">cat <wbr>list <wbr>&gt; <wbr>list
</code></pre></article><article class="talk"><div><img src="img/midori.svg" alt="若木 みどり" /></div><div><span><span>結構簡単に起こってしまうんだね…</span></span><span><span>知らないうちにやってしまいそう</span></span></div></article><article class="talk"><div><img src="img/shigeru.svg" alt="若木 しげる" /></div><div><span><span>コマンド実行で</span></span><span><span>目的のファイルが</span></span><span><span>空ファイルになっていたら</span></span><span><span>今回の挙動を疑ってみよう！</span></span></div></article></section></main><footer><div class="relation"><div><div>前</div><div>2章47話</div><div><a href="2/47/">グルーピング</a></div></div><div><div>今</div><div>2章48話 同一ファイルへの入出力</div><div><a href=".">もくじ</a></div></div><div><div>次</div><div>2章49話</div><div><a href="2/49/">ハッシュ(基本)</a></div></div></div></footer><script src="js/jquery.js"></script><script src="js/common.js"></script></body></html>
